<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix = "fn" uri = "http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<style>

/* .search_bar {
box-shadow: 0px 3px 8px 0px #00483e63;
    background: #ffffff00;
    padding: 10px 20px;
    border-radius: 50px;
    display: flex
;
    gap: 30px;
    align-items: center;
    width: 80%;
} */
.search_drpdwn{
position: relative;

}
.search_drpdwn:after{
    position: absolute;
    content: "";
    height: 22px;
    width: 1px;
    top: 3px;
    right: -15px;
    background: #00483e;
}
.search_drpdwn .form-select {
    background-color: #ffffff00;
    border: none;
    background-size: 40px 15px;
    padding: 0.375rem 1.25rem 0.375rem 0.75rem;
}
.btn_applied{
	color: #fff;
    background-color: #009688;
    border-color: #009688;
}
.btn_apply{
	color: #fff;
    background-color: #f35e0a;
    border-color: #f35e0a;
}

.hover-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.hover-card:hover {
  transform: translateY(-5px);
  box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.15);
}
.heading-underline {
  position: relative;
  display: inline-block;
  padding-bottom: 6px;
}
.heading-underline::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: 0;
  height: 3px;
  width: 50%;
  background-color: #0d6efd; /* Bootstrap primary */
  border-radius: 2px;
}
.college-name {
    font-weight: bold;
    font-size: 1.2em;
    color: #2c3e50;
}

.college-type {
    font-style: italic;
    color: #6c757d;
    font-size: 0.95em;
}
.note {
    color: red;
    display: flex;
    gap: 10px;
    font-size: 12px;
    justify-content: end;
}    
.card {
    color: #000;
    background: #ffffffb8;
    border-radius: 20px;
    padding: 10px 30px;
    box-shadow: 2px 2px 0px 1px #ad4a20, 0px 2px 5px 0px #0000008c;
}
.card .card-header {
    position: relative;
    background: transparent;
    padding-left: 6px;
    border-bottom: none !important;
}
.card .card-body {
    padding: 5px 10px;
}
.section-names-style-1 {
  font-size: 1.6rem;
  font-weight: 600;
  color: #333;
  margin-bottom: 10px;
}
.vacancyList .card .card-title {
    font-size: 18px;
    letter-spacing: 1px;
    white-space: nowrap;
    width: 330px;
    overflow: hidden;
    text-overflow: ellipsis;
    position: absolute;
    transition: all 0.5s !important;
}
.vacancyList .card .card-title:hover {
    overflow: visible;
    white-space: inherit;
}
.vacancyList .card {
    padding: 15px 15px;
    border: 1px solid #e2680073 !important;
    box-shadow: 0 0 10px 0 #f7a186 inset !important;
    background: #fefefe !important;
}
.vacancyList .card .card-body table th {
    padding-top: 5px !important;
    padding-bottom: 0px !important;
    font-weight: 600 !important;
    background-color: transparent !important;
    color: #000 !important;
}
.bootbox-close-button.close{
	display: none;
}
</style>

<c:set var="contextPath" value="${pageContext.request.contextPath}"/>
 <%@ include file="/WEB-INF/views/message.jsp"%>
<section class="candidate-corner-section">
  <div class="container">
     <div class="row mt-4 mb-4">
     	<div class="col-md-12">
	     	<div class="card">
	     		<div class="card-header">
	     			<h2 class="section-names-style-1 text-left"> Apply<span> Section</span></h2>
	     		</div>
	     		<div class="card-body">
		         <form class="row" action="${contextPath}/filterCollegeWiseVacancyList" method="get" id="filterVacancyFormId">
		        	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
	        		<div class="col-md-3">
						 <select id="collegeId" name="collegeId" class="form-select form-select-sm shadow-sm border-primary">
								          <option value="">- Select College -</option>
								          <c:forEach var="college" items="${collegeList}">
								            <option value="${college.collegeId}">${college.collegeName}</option>
								          </c:forEach>
								        </select>
					</div>
					<div class="col-md-3">
						<div class="d-flex gap-1">
							<div class="search_bar" style="width: 220px;">
								<select id="subId" name="subId" class="form-select form-select-sm shadow-sm border-primary" >
						          <option value="">- Select Subject -</option>
						        </select>
					     	</div>
							<button type="button" class="input-group-text search_icon btn-primary" onclick="filterVacancyAjax()"><i class="fa-solid fa-magnifying-glass"></i></button>
						</div>
					</div>
					<div class="col-md-6">
						<div class="note">
							  <p>
							    <strong>* Note :</strong>
							   </p>
							   <p style="font-style: italic;letter-spacing: 1px;">
							    <span style="display: inline-block; width: 12px; height: 12px; background-color: green; margin-right: 5px; border-radius: 2px;"></span>
							    <strong>Government</strong> colleges<br>
							    <span style="display: inline-block; width: 12px; height: 12px; background-color: blue; margin-right: 5px; border-radius: 2px;"></span>
							    <strong>Non-Government</strong> colleges.
							  </p>
						</div>
					</div>
				</form>
	     		<div class="tab-content-inr-style">
	          		<div class="row mt-3">
	          			<div class="row vacancyList" id="vacancyList">
	     					<c:forEach var="vac" items="${vacancyList}">
							    <div class="col-md-4 mb-4 vacancy-card" data-college-id="${vac.collegeId}" data-subject-name="${vac.subjectName}">
							        <div class="card shadow-lg border-0 rounded-3">
							            <div class="card-body fs-6">
							                <!-- College name + ID -->
							                <h5 class="card-title fw-bold mb-2">
											  <c:choose>
											    <c:when test="${vac.collegeType eq 'GOV'}">
											      <span class="text-success">${vac.collegName}</span>
											    </c:when>
											    <c:otherwise>
											      <span class="text-primary">${vac.collegName}</span>
											    </c:otherwise>
											  </c:choose>
											</h5>
											<div class="row" style="margin-top: 32px;">
												<table>
													<tr>
														<th style="width:20px;"><i class="fa-solid fa-book me-2 text-secondary"></i></th>
														<th style="width:130px;">Department</th>
														<th style="width:20px;">:</th>
														<td>${vac.subjectName}</td>
													</tr>
													<tr>
														<th><i class="fa-solid fa-briefcase me-2 text-secondary"></i></th>
														<th>Advertisement No.</th>
														<th>:</th>
														<td>${vac.applicationNo}</td>
													</tr>
													<tr>
														<th><i class="fa-solid fa-briefcase me-2 text-secondary"></i></th>
														<th>Post</th>
														<th>:</th>
														<td>${vac.postName}</td>
													</tr>
													<tr>
														<th><i class="fa-solid fa-user-tie me-2 text-secondary"></i></th>
														<th>Availability</th>
														<th>:</th>
														<td>${vac.totalVacancyDetail}</td>
													</tr>
													<tr>
														<th><i class="fa-solid fa-calendar-days me-2 text-secondary"></i></th>
														<th>Start</th>
														<th>:</th>
														<td><fmt:formatDate value="${vac.startDate}" pattern="dd/MM/yyyy" /></td>
													</tr>
													<tr>
														<th><i class="fa-solid fa-calendar-days me-2 text-secondary"></i></th>
														<th>End</th>
														<th>:</th>
														<td><fmt:formatDate value="${vac.endDate}" pattern="dd/MM/yyyy" /></td>
													</tr>
													<tr>
														<th><i class="fa-solid fa-file-pdf me-2 text-danger"></i></th>
														<th colspan="3" class="text-center"><a
													href="${vac.pdfUrl}" target="_blank"
													class=" text-decoration-none">View Document</a></th>
													</tr>
												</table>
							                <!-- Subject & Post -->
										                <%-- <p class="mb-2"><i class="fa-solid fa-book me-2 text-secondary"></i><strong>Subject :</strong> ${vac.subjectName}</p>
										                <p class="mb-2"><i class="fa-solid fa-briefcase me-2 text-secondary"></i><strong>Advertisement No. :</strong> ${vac.applicationNo}</p>
										                <p class="mb-2"><i class="fa-solid fa-briefcase me-2 text-secondary"></i><strong>Post :</strong> ${vac.postName}</p>
										
										                <!-- Vacancies -->
										                <p class="mb-2"><i class="fa-solid fa-user-tie me-2 text-secondary"></i><strong>Availability :</strong> ${vac.totalVacancyDetail}</p>
										
										                <!-- Dates -->
										                <p class="mb-2"><i class="fa-regular fa-calendar-days me-2 text-secondary"></i><strong>Start :</strong> <fmt:formatDate value="${vac.startDate}" pattern="dd/MM/yyyy"/></p>
										                <p class="mb-2"><i class="fa-regular fa-calendar-days me-2 text-secondary"></i><strong>End :</strong> <fmt:formatDate value="${vac.endDate}" pattern="dd/MM/yyyy"/></p>
										
										                <!-- PDF -->
										                <p class="mb-3">
										                  <i class="fa-solid fa-file-pdf me-2 text-danger"></i>
										                  <a href="${vac.pdfUrl}" target="_blank" class="fw-semibold text-decoration-none">View Document</a>
										                </p> --%>
												
								                <!-- Apply Button -->
								                     <div class="mt-2">
												        <c:choose>
														    <c:when test="${vac.statusChecked eq true}">
														        <button class="btn btn-secondary w-100 fw-semibold rounded-pill shadow-sm disabled"
														         onclick="checkEligibilityAndRetirement('${vac.collegeType}','${vac.advDetailsId}','${vac.appliedStatus}');">
														            Applied <i class="fa fa-check ms-2"></i>
														        </button>
														    </c:when>
														    <c:otherwise>
														        <button class="btn btn-success w-100 fw-semibold rounded-pill shadow-sm"
														               onclick="checkEligibilityAndRetirement('${vac.collegeType}','${vac.advDetailsId}','${vac.appliedStatus}');">
														                <%-- onclick="callApplyMethod('${vac.advDetailsId}');" --%>
														            Apply Now <i class="fa fa-arrow-right ms-2"></i>
														        </button>
														    </c:otherwise>
														</c:choose>
														</div>
										            </div>
									        	</div>
									    	</div>
						          		</div>
						        	</c:forEach>
								</div>
							</div>
						</div>
					</div> 
				</div>
			</div>
		</div>
	</div>
</section>

	<form action="${contextPath}/applyVac/apply-for-vacancy" method="post" id="viewForm">
		 <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
		 <input type="hidden" name="advDetailsId" id="vacIdEdit" />
		 <input type="hidden" name="collegeType" id="collegeTypeId" />
	</form>

	<form action="${contextPath}/apply-section" method="get" id="viewVacancyFrm">
		 <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
		 <input type="hidden" name="frmUnvName" id="frmUnvName" />
		 <input type="hidden" name="frmSubName" id="frmSubName" />
		 <input type="hidden" name="frmPostName" id="frmPostName" />
	</form>
	
		<script>
		
		 $(document).on('click', '.toggle-title', function() {
			 $(this).parent().toggleClass('toggled-on').toggleClass('toggled-off');
			 }); 
		 
		function hide() {
		 var allPast = true;
		 $(".deadLineDate").each(function() {
		 var deadLineDt = $(this).data("deadline");
		 var currentDt = new Date();
		 var deadlineDate = new Date(deadLineDt);
		 if (deadlineDate >= currentDt) {
		 allPast = false;
		 }
		 });

		 var page = $("#aplId");
		 if (allPast) {
		 page.addClass("hidden");
		 } else {
		 page.removeClass("hidden");
		 }
		}

		$(document).ready(function() {
		 hide();
		});
	
		 </script>
		 <script>
		 
		  function loadColleges() {
			    $.ajax({
			        url: "${contextPath}/guest/getCollegeList",
			        type: "GET",
			        success: function(response) {
			            var $dropdown = $("#collegeId");
			            $dropdown.empty();
			            $dropdown.append('<option value="">- Select College -</option>');

			            if (response && response.outcome && response.data && response.data.length > 0) {
			                $.each(response.data, function(index, item) {
			                    $dropdown.append('<option value="' + item.collegeId + '">' + item.collegeName + '</option>');
			                });
			            } else {
			                $dropdown.append('<option value="">No colleges available</option>');
			            }
			        },
			        error: function(xhr, status, error) {
			            console.error(" Error fetching college details:", error);
			            alert("Failed to load colleges. Please try again.");
			        }
			    });
			}

			function loadSubjects(collegeId) {
             debugger
			    if (!collegeId) {
			        $('#subId').html('<option value="">- Select Subject -</option>');
			        return;
			    }
			    $.ajax({
			        url: '${contextPath}/apply/get-subjects-by-college',
			        type: 'GET',
			        data: { collegeId: collegeId },
			        dataType: 'json',
			        success: function(response) {
			            const subjectDropdown = $('#subId');
			            subjectDropdown.empty().append('<option value="">- Select Subject -</option>');
			            
			            if (response.outcome && response.data && response.data.length > 0) {
			                response.data.forEach(function(subject) {
			                    subjectDropdown.append(
			                        $('<option>', {
			                            value: subject.subjectName,    
			                            text: subject.subjectName  
			                        })
			                    );
			                });
			            } else {
			                subjectDropdown.append(
			                    $('<option>', {
			                        value: '',
			                        text: 'No subjects available',
			                        disabled: true
			                    })
			                );
			            }
			        },
			        error: function() {
			            $('#subId').html('<option value="">Error loading subjects</option>');
			        }
			    });
			}

			$('#collegeId').on('change', function() {
			    loadSubjects($(this).val());
			});
			
	/* 		function filterVacancies() {
			    let selectedCollegeId = document.getElementById("collegeId").value;
			    let selectedSubjectName = document.getElementById("subId").value;

			    // Check if both College and Subject are selected
			    if (!selectedCollegeId) {
			        alert("Please select a college before searching.");
			        return false; // stop further execution
			    }

			    if (!selectedSubjectName) {
			        alert("Please select a subject before searching.");
			        return false; // stop further execution
			    }
			    let vacancyCards = document.querySelectorAll(".vacancy-card");
			    vacancyCards.forEach(card => {
			        let cardCollegeId = card.getAttribute("data-college-id");
			        let cardSubjectName = card.getAttribute("data-subject-name");

			        if (cardCollegeId === selectedCollegeId && cardSubjectName === selectedSubjectName) {
			            card.style.display = "block"; 
			        } else {
			            card.style.display = "none";  
			        }
			    });
			}
		 */
			function checkEligibilityAndRetirement(collegeId, vacancyDtlsId, status) {
			    if (!collegeId || collegeId.trim() === "") {
			        alert("College type not selected.");
			        return false;
			    }

			    $.ajax({
			        url: "${contextPath}/apply/getCollageTypeDetails",
			        type: "GET",
			        data: { collegeId: collegeId },
			        success: function(result) {
			            if (!result.outcome) {

			                // Personal details missing -> redirect to profile
			                if (result.message === "Please complete your personal details to proceed further.") {
			                    bootbox.dialog({
			                        message: result.message,
			                        closeButton: true,
			                        buttons: {
			                            ok: {
			                                label: "OK",
			                                className: "btn-primary",
			                                callback: function () {
			                                    window.location.href = "${contextPath}/my-profile";
			                                }
			                            }
			                        }
			                    });
			                } 
			                // EDUCATIONAL details missing -> redirect to EDUCATIONAL tab
			                else if (result.message === "Please enter your Post Graduation details to proceed." || 
			                         result.message === "Please enter your qualification details.") {
			                    bootbox.dialog({
			                        message: result.message,
			                        closeButton: true,
			                        buttons: {
			                            ok: {
			                                label: "OK",
			                                className: "btn-primary",
			                                callback: function () {
			                                    window.location.href = "${contextPath}/my-profile?tabCodee=EDUCATIONAL";
			                                }
			                            }
			                        }
			                    });
			                } 
			              
			                else {
			                    bootbox.alert({
			                        message: result.message,
			                        closeButton: true
			                    });
			                }

			                return false; // stop further execution
			            } else {
			                callApplyMethod(vacancyDtlsId, status, collegeId);
			            }
			        },
			        error: function() {
			            bootbox.alert("Error checking eligibility. Please try again.");
			        }
			    });
			}

			function callApplyMethod(vacancyDtlsId, status, collegeId) {
		    var user = "${userExit}";
		    
		    if (user === "true") {
		        bootbox.alert("You have already applied for this post.");
		        return false;
		    }
		
		    // Ask for confirmation before applying
		    bootbox.confirm({
		        message: "Are you sure you want to apply for this position?",
		        buttons: {
		            confirm: {
		                label: 'Yes',
		                className: 'btn-success'
		            },
		            cancel: {
		                label: 'No',
		                className: 'btn-danger'
		            }
		        },
		        callback: function(result) {
		            if(result) { // If user clicks 'Yes'
		                $("#vacIdEdit").val(vacancyDtlsId);
		                $("#collegeTypeId").val(collegeId);
		                $("#viewForm").submit();
		            }
		        }
		    });
		}

			function callApplyMethod(vacancyDtlsId, status, collegeId) {
			    var user = "${userExit}";
			    
			    if (user === "true") {
			        bootbox.alert("You have already applied for this post.");
			        return false;
			    }
			
			    // Ask for confirmation before applying
			    bootbox.confirm({
			        message: "Are you sure you want to apply for this position?",
			        buttons: {
			            confirm: {
			                label: 'Yes',
			                className: 'btn-success'
			            },
			            cancel: {
			                label: 'No',
			                className: 'btn-danger'
			            }
			        },
			        callback: function(result) {
			            if(result) { // If user clicks 'Yes'
			                $("#vacIdEdit").val(vacancyDtlsId);
			                $("#collegeTypeId").val(collegeId);
			                $("#viewForm").submit();
			            }
			        }
			    });
			}
			
			var contextPath = "${pageContext.request.contextPath}";

			function filterVacancyAjax() {
			    let collegeId = document.getElementById("collegeId").value; 
			    let subjectName = document.getElementById("subId").value; 

			    let vacancyDiv = document.getElementById("vacancyList");
			    vacancyDiv.innerHTML = "";

			    
			    let requestData = {};
			    if (collegeId) requestData.collegeId = collegeId;
			    if (subjectName) requestData.subjectName = subjectName;

			    $.ajax({
			        url: contextPath + "/public/filterCollegeWiseVacancyList",
			        type: "GET",
			        data: requestData, // send only selected filters
			        success: function(response) {
			            if (!Array.isArray(response)) {
			                console.error("Expected array but got:", response);
			                vacancyDiv.innerHTML = "<p>Error fetching vacancies.</p>";
			                return;
			            }

			            if (response.length === 0) {
			                vacancyDiv.innerHTML = "<p class='text-center text-muted'>No vacancies available.</p>";
			                return;
			            }

			            let cardsHTML = "";
			            response.forEach(function(vacancy) {
			                let startDate = vacancy.startDate ? new Date(vacancy.startDate).toLocaleDateString('en-GB') : '';
			                let endDate = vacancy.endDate ? new Date(vacancy.endDate).toLocaleDateString('en-GB') : '';

			                let collegeNameHTML = vacancy.collegeType === 'GOV'
			                    ? '<span class="text-success">' + (vacancy.collegName || '') + '</span>'
			                    : '<span class="text-primary">' + (vacancy.collegName || '') + '</span>';

			                let buttonHTML = (vacancy.statusChecked === "true" || vacancy.statusChecked === true)
			                    ? '<button class="btn btn-secondary w-100 fw-semibold rounded-pill shadow-sm" onclick="checkEligibilityAndRetirement(\'' + vacancy.collegeType + '\',\'' + vacancy.advDetailsId + '\',\'' + vacancy.appliedStatus + '\');">Applied <i class="fa fa-check ms-2"></i></button>'
			                    : '<button class="btn btn-success w-100 fw-semibold rounded-pill shadow-sm" onclick="checkEligibilityAndRetirement(\'' + vacancy.collegeType + '\',\'' + vacancy.advDetailsId + '\',\'' + vacancy.appliedStatus + '\');">Apply Now <i class="fa fa-arrow-right ms-2"></i></button>';

			                cardsHTML += 
		                        '<div class="col-md-4 mb-4 vacancy-card" data-college-id="' + (vacancy.collegeId || '') + '" data-subject-name="' + (vacancy.subjectName || '') + '">' +
		                            '<div class="card shadow-lg border-0 rounded-3">' +
		                                '<div class="card-body">' +
		                                    '<h5 class="card-title text-primary fw-bold mb-2">' +
		                                        (vacancy.collegeType === 'GOV' ? 
		                                            '<span class="text-success">' + (vacancy.collegName || '') + '</span>' :
		                                            '<span class="text-primary">' + (vacancy.collegName || '') + '</span>') +
		                                    '</h5>' +
		                                    '<div class="row" style="margin-top: 32px;">' +
		                                        '<table>' +
		                                            '<tr><th><i class="fa-solid fa-book me-2 text-secondary"></i></th><th>Subject</th><th>:</th><td>' + (vacancy.subjectName || '') + '</td></tr>' +
		                                            '<tr><th><i class="fa-solid fa-briefcase me-2 text-secondary"></i></th><th>Advertisement No.</th><th>:</th><td>' +  (vacancy.applicationNo || '')+ '</td></tr>' + 
		                                            '<tr><th><i class="fa-solid fa-briefcase me-2 text-secondary"></i></th><th>Post</th><th>:</th><td>' + (vacancy.postName || '') + '</td></tr>' +
		                                            '<tr><th><i class="fa-solid fa-user-tie me-2 text-secondary"></i></th><th>Availability</th><th>:</th><td>' + (vacancy.totalVacancyDetail || '') + '</td></tr>' +
		                                            '<tr><th><i class="fa-solid fa-calendar-days me-2 text-secondary"></i></th><th>Start</th><th>:</th><td>' + startDate + '</td></tr>' +
		                                            '<tr><th><i class="fa-solid fa-calendar-days me-2 text-secondary"></i></th><th>End</th><th>:</th><td>' + endDate + '</td></tr>' +
		                                            '<tr><th><i class="fa-solid fa-file-pdf me-2 text-danger"></i></th><th colspan="3" class="text-center"><a href="' + (vacancy.pdfUrl || '#') + '" target="_blank" class=" text-decoration-none">View Document</a></th></tr>' +
		                                        '</table>' +
		                                    '</div>' +
		                                    '<div class="mt-2 text-end">' +
		                                    buttonHTML +
		                                    '</div>' +
		                                '</div>' +
		                            '</div>' +
		                        '</div>';
		                });
			            vacancyDiv.innerHTML = '<div class="row">' + cardsHTML + '</div>';
			        },
			        error: function(xhr, status, error) {
			            console.error("Error fetching vacancies:", error);
			            vacancyDiv.innerHTML = "<p class='text-center text-danger'>Error fetching vacancies.</p>";
			        }
			    });
			}

			

			function checkEligibilityAndRetirement(collegeId, vacancyDtlsId, status) {
			    if (!collegeId || collegeId.trim() === "") {
			        alert("College type not selected.");
			        return false;
			    }

			    $.ajax({
			        url: "${contextPath}/apply/getCollageTypeDetails",
			        type: "GET",
			        data: { collegeId: collegeId },
			        success: function(result) {
			            if (!result.outcome) {

			                // Personal details missing -> redirect to profile
			                if (result.message === "Please complete your personal details to proceed further.") {
			                    bootbox.dialog({
			                        message: result.message,
			                        closeButton: true,
			                        buttons: {
			                            ok: {
			                                label: "OK",
			                                className: "btn-primary",
			                                callback: function () {
			                                    window.location.href = "${contextPath}/my-profile";
			                                }
			                            }
			                        }
			                    });
			                } 
			                // EDUCATIONAL details missing -> redirect to EDUCATIONAL tab
			                else if (result.message === "Please enter your Post Graduation details to proceed." || 
			                         result.message === "Please enter your qualification details.") {
			                    bootbox.dialog({
			                        message: result.message,
			                        closeButton: true,
			                        buttons: {
			                            ok: {
			                                label: "OK",
			                                className: "btn-primary",
			                                callback: function () {
			                                    window.location.href = "${contextPath}/my-profile?tabCodee=EDUCATIONAL";
			                                }
			                            }
			                        }
			                    });
			                } 
			              
			                else {
			                    bootbox.alert({
			                        message: result.message,
			                        closeButton: true
			                    });
			                }

			                return false; // stop further execution
			            } else {
			                callApplyMethod(vacancyDtlsId, status, collegeId);
			            }
			        },
			        error: function() {
			            bootbox.alert("Error checking eligibility. Please try again.");
			        }
			    });
			}

			function callApplyMethod(vacancyDtlsId, status, collegeId) {
		    var user = "${userExit}";
		    
		    if (user === "true") {
		        bootbox.alert("You have already applied for this post.");
		        return false;
		    }
		
		    // Ask for confirmation before applying
		    bootbox.confirm({
		        message: "Are you sure you want to apply for this position?",
		        buttons: {
		            confirm: {
		                label: 'Yes',
		                className: 'btn-success'
		            },
		            cancel: {
		                label: 'No',
		                className: 'btn-danger'
		            }
		        },
		        callback: function(result) {
		            if(result) { // If user clicks 'Yes'
		                $("#vacIdEdit").val(vacancyDtlsId);
		                $("#collegeTypeId").val(collegeId);
		                $("#viewForm").submit();
		            }
		        }
		    });
		}

</script>

<c:if test="${not empty errorMessage}">
    <script type="text/javascript">
        if (confirm("${errorMessage}")) {
            window.location.href = "${redirectUrl}";
        }
    </script>
</c:if>