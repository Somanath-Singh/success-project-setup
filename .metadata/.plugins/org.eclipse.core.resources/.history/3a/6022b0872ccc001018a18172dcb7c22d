<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />

<div class="breadcrumb_conatiner">
	<div class="col-md-6">
		<h4 class="change-color">Sub Category</h4>
	</div>
	<div class="col-md-6">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="${contextPath}/home"><i class="fa-solid fa-house"></i></a></li>
				<li class="breadcrumb-item"><a href="#">Procurement</a></li>
				<li class="breadcrumb-item active" aria-current="page">Sub
					Category</li>
			</ol>
		</nav>
	</div>
</div>

<div class="row">
	<div class="col-md-12">

		<div class="card">
			<div class="card-header">
				<h5 class="card-title">Sub Category</h5>
			</div>
			<div class="card-body">
				<form method="POST"
					action="${contextPath}/assetflow/master/subcategory/save"
					id="addSubCategoryFrm">
					<input type="hidden" name="${_csrf.parameterName}"
						value="${_csrf.token}" /> <input type="hidden" id="subCategoryId"
						name="subCategoryId" value="${subCat.subCategoryId }"> <input
						type="hidden" class="" id="encodedDataaddSubCategoryFrm"
						name="encodedDataFrm" value="" />
					<div class="row">
						<div class="col-md-12">
							<div class="row">
								<div class="form-group col-md-3">
									<label for="inputEmail4" class="required">Category
										Name:</label> <select class="form-select"
										aria-label="Default select example " id="categoryName"
										name="categoryId">
										<option value="" >-Select-</option>
										<c:forEach items="${catList}" var="cat">
											<option value="${cat.categoryId}"
												${cat.categoryId eq subCat.category.categoryId ? 'selected' :''}>${cat.categoryName}</option>
										</c:forEach>
									</select>
								</div>
								<div class="form-group col-md-3">
									<label class="col-md-12 required" for="text">Sub
										Category Name:</label> <input class="form-control form-control-sm"
										type="text" id="subCategoryName" name="subCategoryName"
										placeholder="Enter Sub Category name"
										value="${subCat.subCategoryName}" maxlength="30">
								</div>
								<div class="form-group col-md-3">
									<label class="col-md-12" for="text">Sub Category Code:</label>
									<input class="form-control form-control-sm" type="text"
										name="subCategoryCode" id="subCategoryCode"
										placeholder="Sub Category code"
										value="${subCat.subCategoryCode}" maxlength="30" readonly>
								</div>

								<c:if test="${not empty subCat.subCategoryId }">
									<div class="form-group col-md-2 mt-4 toggleTrueFalse"
										data-label-on="True" data-label-off="False"
										data-toggle-width="90" style="">
										<input type="checkbox" value="${subCat.isActive}"
											class="toggleCheckBox"
											${subCat.isActive == 'true' ? 'checked' : ''}
											id="parametros_MOSTRAPEDIDOS" name="isActive" /> <label
											class="clickToggle" for="parametros_MOSTRAPEDIDOS"></label>
									</div>
								</c:if>


								<div class="col-md-12 btn-div d-flex align-items-center gap-2">
									<input type="button" class="btn btn-success" value="${not empty subCat.subCategoryId  ? 'Update' : 'Save' }" onclick="validateForms()">
										<a type="button" class="btn btn-danger" onclick="backToModule()">Cancel</a>
									<c:if test="${not empty subCat.subCategoryId  }">
										<a type="button"
											href="${contextPath}/assetflow/master/subcategory/add"
											class="btn btn-submit">Add New</a>
									</c:if>
								</div>



							</div>
						</div>
					</div>
				</form>

			</div>
		</div>



		<div class="col-md-12 mt-3">
			<div class="card">
				<div class="card-header">
					<h5 class="card-title">Sub Category List</h5>
				</div>
				<div class="card-body">
					<div class="table-responsive">
						<table
							class="datatable table table-striped table-bordered exportbtn mt-3">
							<thead>
								<tr>
									<th>Sl No</th>
									<th>Sub Category Name</th>
									<th>Category Name</th>
									<th>Sub Category Code</th>
									<th>Active/InActive</th>
									<th>Action</th>
								</tr>
							</thead>
							<tbody>
								<c:forEach items="${subCatList}" var="subcatgory"
									varStatus="status">
									<tr>
										<td>${status.count}</td>
										<td>${subcatgory.subCategoryName}</td>
										<td>${subcatgory.category.categoryName}</td>
										<td>${subcatgory.subCategoryCode}</td>
										<td>
											<div class="toggleTrueFalse" data-label-on="True"
												data-label-off="False" data-toggle-width="90">
												<input type="checkbox" value="${subcatgory.isActive}"
													class="toggleCheckBox"
													${subcatgory.isActive == 'true' ? 'checked' : ''}
													id="parametros_MOSTRAPEDIDOS${status.count}"
													name="parametros_MOSTRAPEDIDOS${status.count}"
													disabled="disabled" /> <label class="clickToggle"
													for="parametros_MOSTRAPEDIDOS${status.count}"></label>
											</div>
										</td>
										<td><a href="#"
											onclick="edit(${subcatgory.subCategoryId})"
											class="btn btn-primary" data-toggle="tooltip"
											title="Edit Sub Category"><i class='fa fa-pencil'></i></a></td>
									</tr>
								</c:forEach>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<form method="get"
	action="${contextPath}/assetflow/master/subcategory/add" id="edit">
	<input type="hidden" id="subcategoryIddd" name="subcategoryId" value="">
	<input type="hidden" class="" id="encodedDataedit"
		name="encodedDataedit" value="" />
</form>
<form method="post"
	action="${contextPath}/assetflow/master/subcategory/delete"
	id="deleteSubCategory">
	<input type="hidden" name="${_csrf.parameterName}"
		value="${_csrf.token}" /> <input type="hidden" id="subcategoryIdd"
		name="subcategoryId" value="">
</form>
<script>
function backToModule(){
       let currentModuleCode =  localStorage.getItem('currentModuleCode');
       $('#moduleId').val(enc_password(currentModuleCode));
       $('#moduleForm').submit();
    }
    function edit(id){
        $("#subcategoryIddd").val(id);
        encryptFormData("edit", tableOrTbodyIDS, tableOrTbodyKeys);
        $("#edit").submit();
    }
	function validateForms(){
		var subcName=$("#subCategoryName").val().trim();
		var cName=$("#categoryName").val();
		if(cName == ''){
			displayErrorMsg("categoryName", "Please select category");
			return false;
		}else{
			clearError("categoryName");
		}

		if(subcName == ""){
			displayErrorMsg("subCategoryName", "Please enter sub category");
			return false;
		}else{
			clearError("subCategoryName");
		}
		var msg="Are you sure you want to "+${not empty subCat.subCategoryId  ? '"Update"' : '"Save"' }+"?"
		bootbox.confirm({
			message: msg,
			buttons: {
				confirm: {
					label: 'Yes',
					className: 'btn-success'
				},
				cancel: {
					label: 'No',
					className: 'btn-danger'
				}
			},
			callback: function (result) {
				if(result){
				    encryptFormData("addSubCategoryFrm", tableOrTbodyIDS, tableOrTbodyKeys);
					$("#addSubCategoryFrm").submit();
				}
			}
		});
	}
	function deleteSubCategory(id){
		$("#subcategoryIdd").val(id);
		$("#deleteSubCategory").submit();
	}
</script>