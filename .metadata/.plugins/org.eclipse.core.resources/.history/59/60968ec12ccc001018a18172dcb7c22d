<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<div class="content">
	<div class="panel-header bg-primary-gradient">
		<div class="page-inner">
			<div
				class="d-flex align-items-left align-items-md-center flex-column flex-md-row">
				<div>
					<h2 class="text-white mt-2 fw-bold">Add & Manage EntityType</h2>
				</div>
				<div class="ml-md-auto py-2 py-md-0">
					<a href="${contextPath}/"
						class="btn btn-white btn-border btn-round mr-2"><i
						class="fa fa-home"></i></a> <a href="#"
						class="btn btn-white btn-border btn-round"> Manage EntityType</a>
				</div>
			</div>
		</div>
	</div>
	<div class="page-inner">
		<div class="row mt-2">
			
			<div class="col-md-12">
				<div class="card full-height">
					<div class="card-header">
						<c:choose>
							<c:when test="${not empty entityType.valueId}">
								<h4 class="card-title">Update Entity Type</h4>
							</c:when>
							<c:otherwise>
								<h4 class="card-title">Add Entity Type</h4>
							</c:otherwise>
						</c:choose>
					</div>
					<div class="card-body">
						
							<form action="${contextPath}/admin/master/entityType/save" id="addEntityFrm"
								method="post">
								<input type="hidden" name="${_csrf.parameterName}"
									value="${_csrf.token}" /> <input type="hidden" name="valueId"
									value="${entityType.valueId}" id="valueId" />
								<div class="row">	
								<div class="col-md-3">
										<div class="form-group">
											<label class="col-md-12 required" for="stateId">Entity Level </label>
											<div class="col-md-12">
												<select name="entityLevel.valueId" id="valueIId"
													class="form-control form-control-sm" required="required">
													<option value="">Select</option>
													<c:forEach items="${entityList}" var="entity">
													<c:if test="${entity.valueCode eq 'INSTITUTE'}">
														<option value="${entity.valueId}" ${entity.valueId eq entityType.entityLevel.valueId?'selected':''}>${entity.valueEn}</option>
													</c:if>
													</c:forEach>
												</select>
											</div>
										</div>
									</div>
									<div class="col-md-3">
										<div class="form-group">
											<label class="col-md-12 required" for="valueEn">Entity Type
												Name</label>
											<div class="col-md-12">
												<input type="text"
													class="form-control form-control-sm AlphaNumericWithLimitedSpecialChars"
													id="valueEn" name="valueEn"
													value="${entityType.valueEn}" required="required"
													maxlength="100">
											</div>
										</div>
									</div>		
									<div class="col-md-3">
										<div class="form-group">
											<label class="col-md-12 required" for="valueCode">Entity Type Code</label>
											<div class="col-md-12">
												<input type="text"
													class="form-control form-control-sm AlphaNumericWithLimitedSpecialChars"
													id="valueCode" name="valueCode" onblur="checkDuplicateCode()"
													value="${entityType.valueCode}" required="required"
													maxlength="100"  ${not empty entityType.valueCode ? 'readonly':'' }>
											</div>
										</div>
									</div>									
								
									<div class="text-center" style="margin-top: 20px;">
										<c:choose>
											<c:when test="${not empty entityType}">
												<input type="button" name="add&ManageApplicationScheme"
													value="Update" id="add&ManageApplicationSchemes"
													class="btn btn-success btn-sm" onclick="submitUpdateFormData()">&nbsp;&nbsp;
														<a href="${contextPath}/admin/master/entity/list" type="button"
													class="btn btn-warning btn-sm">Back</a>
											</c:when>
											<c:otherwise>
												<input type="button" name="add&ManageApplicationScheme"
													value="Submit" id="add&ManageApplicationSchemes"
													class="btn btn-success btn-sm" onclick="submitFormData()">&nbsp;&nbsp;
														<a href="${contextPath}/home" type="button"
													class="btn btn-warning btn-sm">Back</a>
											</c:otherwise>
										</c:choose>

									</div>
								</div>
							</form>
						
					</div>
				</div>
			</div>

		</div>
		<div class="row mt-2">
			<div class="col-md-12">
				<div class="card full-height">
					<div class="card-header">
						<h4 class="card-title">Entity List</h4>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table id="basic-datatables"
								class="display table table-bordered table-hover DataTable">
								<thead>
									<tr>
										<th>Sl.No</th>
										<!--<th>Entity Level</th>-->
										<th>Entity Type Name</th>
										<th>Entity Type Code</th>
										<th>Status</th>
										<th>Action</th>
									</tr>
								</thead>
								<tbody id="tbd">
									<c:forEach items="${entityTypeList}" var="entityType" varStatus="count">
									
										<tr>
											<td>${count.count}</td>
											<!--<td>${entityType.entityLevel.valueEn}</td>-->
											<td>${entityType.valueEn}</td>
											<td>${entityType.valueCode}</td>
											<c:if test="${entityType.isActive eq true }">
												<td>Active</td>
											</c:if>
											<c:if test="${entityType.isActive eq false }">
												<td>InActive</td>
											</c:if>
											<td>
											<c:if test="${entityType.isActive eq true}">
											    <button class="btn btn-warning btn-sm"
													onclick="editEntityTypeById('${entityType.valueId}')">
													<i class="fas fa-edit"></i>
												</button>
												<button class="btn btn-danger btn-sm"
														onclick="activeInactiveEntity('INACTIVE', '${entityType.valueId}')"
														title="Deactivate Fund Type ">
														<i class="fa fa-lock" aria-hidden="true"></i>
													</button>
											</c:if>
											 <c:if test="${entityType.isActive eq false}">
													<button class="btn btn-success btn-sm"
															onclick="activeInactiveEntity('ACTIVE', '${entityType.valueId}')"
															title="Activate Fund Type ">
													<i class="fa fa-unlock-alt" aria-hidden="true"></i>
													</button>
											</c:if>
												
											</td>
										</tr>
									</c:forEach>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<form method="GET" id="formId"></form>

<form action="${contextPath}/admin/master/entity/changeEntityStatus.htm"
	id="changeEntityStatus" method="post">
	<input type="hidden" name="${_csrf.parameterName}"
		value="${_csrf.token}" /> <input type="hidden" name="actionType"
		id="actionType" /> <input type="hidden" name="valueId" id="entityvalueId" />
</form>
<script type="text/javascript">


function editEntityTypeById(id) {
	$("#formId").attr('action',
			'${contextPath}/admin/master/entity/edit/' + id + '');
	$("#formId").submit();
}
	
	function submitFormData(){	
		var valueCode = $("#valueCode").val();
		var valueEn= $("#valueEn").val();
		var valueId= $("#valueIId").val();
		
		if($("#valueIId").val()==""){
			bootbox.alert("Select Entity Level Name ");
			return false;
		}
		if($("#valueEn").val()==""){
			bootbox.alert("Please Enter Type  Name");
			return false;
		}
		if($("#valueCode").val()==""){
			bootbox.alert("Enter Entity Code");
			return false;
		}
		else{	
		$.ajax({
			type : "GET",
			url : "${contextPath}/admin/master/entity/validateEntitytCode",
			data : {
				"valueCode" :valueCode,
			}, 
			success : function(response) {
				if (response.isDuplicate == 'true') {
					bootbox.alert("Duplicate Entity Type Code Not Allowed"); 
					$("#valueCode").val("");
				}else{					
					var flag = window.confirm("Do you want to continue ?");
			  		if (flag == true) {
			  			$("#addEntityFrm").submit();				
				} 
			
	}
		}
			
		});
		}
		
	}		
		
			
	            //  $("#addEntityFrm").submit();												
	
	
	function submitUpdateFormData(){
		if($("#valueIId").val()==""){
			bootbox.alert("Select Entity Level Name ");
			return false;
		}
		if($("#valueEn").val()==""){
			bootbox.alert("Please Enter Type  Name");
			return false;
		}
		if($("#valueCode").val()==""){
			bootbox.alert("Enter Entity Code");
			return false;
		}else{
			$("#addEntityFrm").submit();
		}
		
	}
	function activeInactiveEntity(actionType, valueId) {
		$("#actionType").val(actionType); 
		$("#entityvalueId").val(valueId); 
		if(actionType == 'INACTIVE') {
			bootbox.confirm({
			    message: "Do you want to deactivate the Entity Type?",
			    buttons: {
			        confirm: {
			            label: 'Yes',
			            className: 'btn-success'
			        },
			        cancel: {
			            label: 'No',
			            className: 'btn-danger'
			        }
			    },
			    callback: function (result) {
			    	if(result == true) {
			    		$("#changeEntityStatus").submit();  
			    	} 
			    }
			}); 
		}
		if(actionType == 'ACTIVE') {
			bootbox.confirm({
			    message: "Do you want to activate the Entity Type?",
			    buttons: {
			        confirm: {
			            label: 'Yes',
			            className: 'btn-success'
			        },
			        cancel: {
			            label: 'No',
			            className: 'btn-danger'
			        }
			    },
			    callback: function (result) {
			    	if(result == true) {
			    		$("#changeEntityStatus").submit();  
			    	} 
			    }
			}); 
		}
	}
	
// 	$('#valueEn').keypress(function (e) {
//         var regex = new RegExp(/^[a-zA-Z0\s]+$/); 
//         var str = String.fromCharCode(!e.charCode ? e.which : e.charCode);
//         if (regex.test(str)) {
//             return true;
//         }
//         else
//         {
//         e.preventDefault();
//        bootbox.alert('Special Chataters are not allowed');
//         return false;
//         }
//     });
	
	
	

	
	</script>