<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
	pageEncoding="ISO-8859-1"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet"
	href="${contextPath}/assets/js/plugin/jquery_autocomplete/jquery.autocomplete.css" />
<script src="${contextPath}/assets/js/plugin/jquery.autocomplete.min.js"></script>
<script src="resources/javascripts/common.js"></script>
<script src="${contextPath}/assets/appJs/validation/party-master.js"></script>
<script src="${contextPath}/assets/appJs/validation/invoice.js"></script>
<script src="${contextPath}/assets/js/ipmsJs/ipms.js"></script>
<style>
.table, .dataTables_wrapper {
    background: transparent !important;
}
</style>

<div class="breadcrumb_conatiner">
    <div class="col-md-6">
        <h4 class="change-color">BOQ Project</h4>
    </div>
    <div class="col-md-6">
        <nav aria-label="breadcrumb">
	        <ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="${contextPath}/home" title="Home"><i class="fa fa-home"></i></a></li>
				<li class="breadcrumb-item active" aria-current="page">BOQ Project</li>
			</ol>
        </nav>
     </div>
</div>
<div class="card">
    <div class="card-header">
        <h6 class="card-title">BOQ Project</h6>
    </div>
    <div class="card-body">
        <div class="container-fluid">
        	<form action="${contextPath}/boq/boq-list" method="POST" id="boqListForm" autocomplete="off" enctype="multipart/form-data">
        	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
        		<div class="row">
        		<%@ include file="/WEB-INF/views/entityIdAndUserLevelListDrp.jsp"%>
        		
        			<div class="col-md-2 col-sm-3">
        				<div class="form-group">
        					<label for="estimationNo" class="required">Project</label>
        					<div class="col-md-12">
        						<select class="form-control require " name="projectId"
        							id="projectId"
        							onchange="featchWorkOrdersByProject(this.value,0,'workOrder')">
        							<option value="">
        								<spring:message code="COMMON.LABEL.DROPDOWN.SELECT" />
        							</option>
        							<c:forEach items="${projectList}" var="project">
        								<option value="${project.projectId}"
        									${(project.projectId eq mainData.projectId || project.projectId eq selctdProjectId) ? 'selected' : ''}>
        									${project.projectCode} | ${project.projectName}</option>
        							</c:forEach>
        						</select>
        					</div>
        				</div>
        			</div>
        			<div class="col-md-2 col-sm-3">
        					<div class="form-group">
        						<label for="workOrder" class="required">Workorder:</label>
        						<div class="col-md-12">
        							<select class="form-control" name="workorderId" id="workOrder" onchange="getBoqDataByWorkorderNo()">
        								<option value=""><spring:message code="COMMON.LABEL.DROPDOWN.SELECT" /></option>
        								<c:forEach items="${workList}" var="workorder">
        									<option value="${workorder.workOrderId}" ${workorder.workOrderId eq mainData.workorderId ? 'selected' : ''}>${workorder.workOrderNo}</option>
        								</c:forEach>
        							</select>
        						</div>
        					</div>
        				</div>
        				<!-- <div class="col-md-2 col-sm-3">
        					<div class="form-group">
        						<label for="boqDoc" class="required form-label">Upload BOQ:</label>
        						<div class="col-md-12">
        							<input type="file" class="form-control" name="boqDoc" id="boqDoc">
        						</div>
        					</div>
        				</div> -->
        				<div class="col-md-2 col-sm-3">
        					<div class="form-group">
        						<div class="col-md-12">
        							<input type="button" class="btn btn-success" style="margin-top:19px;" onclick="filter()" value="Filter" />
        						</div>
        					</div>
        				</div>
        		</div>
        		<h5>BOQ List</h5>
        		<div class="table-responsive">
        			<table id="boq-table" class="table DataTable table-bordered">

        				<thead>
        					<tr>
        						<th>Sl. No.</th>
        						<th>BOQ Code</th>
        						<th>BOQ Date</th>
        						<th>Workorder Code</th>
        						<th>Action</th>
        					</tr>
        				</thead>

        				<tbody id="tbd" class="appendBox">
        					<c:forEach items="${boqList}" var="boq" varStatus="count">
        						<tr>
        							<td>${count.count}</td>
        							<td>${boq.boqCode}</td>
        							<td><fmt:formatDate pattern="dd/MM/yyyy" value="${boq.boqDate}"/></td>
        							<td>${boq.workorderId.workOrderNo}</td>
        							<td><button type="button" class="btn btn-success" onclick="getBoqData('${boq.boqMstId}', '${boq.workorderId.workOrderId}');" title"View"><i class="fa-regular fa-eye"></i></button></td>
        						</tr>
        					</c:forEach>
        				</tbody>


        			</table>
        		</div>
        	</form>
        </div>
    </div>
</div>



<form action="${contextPath}/boq/manage-boq" method="POST" id="boqForm" autocomplete="off" enctype="multipart/form-data">
	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
	<input type="hidden" name="actionCode" id="actionCode" value="EDIT1"/>
	<input type="hidden" name="boqMstId" id="boqMstId"/>
	<input type="hidden" name="workorderId" id="hdnWorkorderId"/>
	<input type="hidden" id="cipherText" name="cipherText">
</form>

<script>
$( document ).ready(function() {
	
	var selctdProjectId ='${selctdProjectId}';
	var selctdWorkorderId = '${selctdWorkorderId}';
	
	if(selctdProjectId!='' &&  selctdWorkorderId!=''){
		featchWorkOrdersByProject(selctdProjectId,selctdWorkorderId,'workOrder');
	}
	
});

function getBoqData(boqId, workorderId){
	$("#boqMstId").val(boqId);
	$("#hdnWorkorderId").val(workorderId);
//	showLoader();
// 	$("#cipherText").val(enc_password(JSON.stringify(convertFormToJSONArray($("#boqForm").serializeArray()))));
// 	$("#boqForm").submit();
	
	tableOrTbodyIDS=[''];
	tableOrTbodyKeys=[''];
	 if(encryptFormData('boqForm', tableOrTbodyIDS, tableOrTbodyKeys)){
			 confirmation('boqForm');
		 }
	
}

function filter() {
	if($("#projectId").val() == ''){
		bootbox.alert('Please select project.');
		return false;
	}
	else if($("#workOrder").val() == ''){
		bootbox.alert('Please select workorder.');
		return false;
	}
	else{
		$("#boqListForm").submit();
	}
}
</script>