<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script type="text/javascript" src="${contextPath}/assets/appJs/validation/common-utils.js"></script>
 
<div class="breadcrumb_conatiner">
	<div class="col-md-6">
		<h4 class="change-color">Get  Legacy Project Details</h4>
	</div>
	<div class="col-md-6">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="${contextPath}/home"><i class="fa fa-home"></i></a></li>
           	 	<li class="breadcrumb-item active" aria-current="page">Get Legacy Project Details</li>
			</ol>
		</nav>
	</div>
</div>

<div class="card">
	<div class="card-header">
        <h5 class="card-title"> Legacy Project Details</h5>
	</div>
	<div class="card-body">
		<div class="row">

			<div class="col-md-3">
				<label class="required">From Date : </label>
				<div class="datepicker-box">
					<input type="text" id="fromDate" name="fromDate"
						class="form-control form-control-sm datepicker "  value="${selectedFromDate}" required readonly>
				</div>
			</div>
			<div class="col-md-3">
				<label class="required"> To Date : </label>
				<div class="datepicker-box">
					<input type="text" id="toDate" name="toDate"
						class="form-control form-control-sm datepicker "  value="${selectedToDate}" required readonly>
				</div>
			</div>
			
			<%-- <div class="col-md-3">
				<div class="form-group">
					<label for="projectId">Select Project :</label>
					<select id="projectId" name="projectId" class="form-control form-control-sm form-select" required>
						<option value="0">- Select -</option>
						<c:forEach items="${projectList}" var="project">
							<option value="${project.projectId}">${project.projectName}</option>
						</c:forEach>
					</select>
				</div>
			</div>

			<div class="col-md-3">
				<div class="form-group">
					<label class="col-md-12 required" for="is GeoTagged">Is
						GeoTagged :</label>
					<div class="col-md-12">
						<select class="form-select form-select-sm" id="isGeoTagged"
							name="isGeoTagged" required>
							<option value="">-- Select --</option>
							<option value="true">Yes</option>
							<option value="false">No</option>
						</select>
					</div>
				</div>
			</div> --%>

			<div class="col-md-3">
				<div class="form-group">
					<label for="projectId">Select Building :</label> <select
						id="projectId" name="projectId"
						class="form-control form-control-sm form-select select2" required>
						<option value="">- Select -</option>
						<c:forEach items="${projectList}" var="project">
							<option value="${project.projectId}"
								<c:if test="${selectedProjectId != null && selectedProjectId == project.projectId}">
                        selected
                    </c:if>>
								${project.projectName}</option>
						</c:forEach>
					</select>
				</div>
			</div>

			<div class="col-md-3">
				<div class="form-group">
					<label class="col-md-12 required" for="isGeoTagged">Is
						GeoTagged :</label>
					<div class="col-md-12">
						<select class="form-select form-select-sm" id="isGeoTagged"
							name="isGeoTagged" required>
							<option value="">-- Select --</option>
							<option value="true"
								<c:if test="${selectedIsGeoTagged == 'true'}">selected</c:if>>Yes</option>
							<option value="false"
								<c:if test="${selectedIsGeoTagged == 'false'}">selected</c:if>>No</option>
						</select>
					</div>
				</div>
			</div>



		</div>
	    <div class="row mt-4">
			<div class="col-md-12 text-center">
				<button type="button" class="btn btn-success" onclick="filterData()">Filter</button>
				<a href="${contextPath}/home" type="button" class="btn btn-warning btn-sm">Back</a>
			</div>
		</div>
   	</div>
  </div>
  
  
  <div class="card mt-4" id="project-report">
    <div class="card-header">
        <h5 class="card-title">Legacy Project Details</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered table-striped exportbtn" id="projectTable">
			    <thead>
                    <tr>
                    <tr>
                        <th>SL No.</th>
                        <th>Financial Year</th>
                        <th>District</th>
                        <th>Project Name</th>
                        <th>Project Type</th>
                        <th>Estimated Cost</th>
                        <th>Final Cost</th>
                        <th>Completion Date</th>
                    </tr>
                </thead>
			    <tbody id="projectTableBody">
			        <c:choose>
                        <c:when test="${not empty legacyProjectList}">
                            <c:forEach items="${legacyProjectList}" var="project" varStatus="status">
                                <tr>
                                    <td>${status.index + 1}</td>
                                    <td>${project.financialYear}</td>
                                    <td>${project.districtName}</td>
                                    <td>${project.projectName}</td>
                                    <td>${project.projectType}</td>
                                    <td class="text-end">${project.estimatedCost}</td>
                                    <td class="text-end">${project.finalCost}</td>
                                    <td>${project.completionDate}</td>
                                </tr>
                            </c:forEach>
                        </c:when>
                        <c:otherwise>
                            <tr><td colspan="8" class="text-center text-muted">No records found for the selected criteria.</td></tr>
                        </c:otherwise>
                    </c:choose>
			    </tbody>
			</table>
        </div>
    </div>
</div>

<form id="filterLegacyForm" action="${contextPath}/report/getlegacyProjectReport" method="GET">
	 <input type="hidden" name="cipherText" id="hiddenCipherText">
	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
	<input type="hidden" id="fromDatehn" name="fromDate">
	<input type="hidden" id="toDatehn" name="toDate">
	<input type="hidden" id="projectIdhn" name="projectId">
    <input type="hidden" id="isGeoTaggedhn" name="isGeoTagged">
</form>

<script>


function filterData() {
	debugger;
	const fromDate = $("#fromDate").val();
    const toDate = $("#toDate").val();
    const projectId = $("#projectId").val();
    const geoTagType = $("#isGeoTagged").val(); 
    $('#fromDatehn').val(fromDate);
    $('#toDatehn').val(toDate);
    $('#projectIdhn').val(projectId);
    $('#isGeoTaggedhn').val(geoTagType);
    var bizContent = $("#filterLegacyForm").serializeArray();
    $("#hiddenCipherText").val(enc_password(JSON.stringify(convertFormToJSONArray(bizContent))));
    $("#filterLegacyForm").submit();
  
}

function showLoader() {
    $(".loader-div").css("display", "flex");
}

function hideLoader() {
    $(".loader-div").css("display", "none");
}


$(document).ready(function () {
	var today = new Date();
    var oneMonthAgo = new Date();
    oneMonthAgo.setMonth(today.getMonth() - 1);
	$(".datepicker").datepick({
		dateFormat: "dd-mm-yyyy",                
	    onShow: $.datepick.monthOnly,
	    yearRange: "c-20:c+10",
	    showOnFocus: true,
	    showTrigger: '<button type="button" class="trigger"><i class="fa fa-calendar"></i></button>',
	});
	if (!$("#fromDate").val()) {
        $('#fromDate').datepick('setDate', oneMonthAgo);
    }
    if (!$("#toDate").val()) {
        $('#toDate').datepick('setDate', today);
    }

	    var $table = $("#projectTable");

	    if ($table.find("tbody tr td").hasClass("text-muted")) {
	        $table.removeClass("exportbtn");
	    } else {
	        $table.addClass("exportbtn");
	    }
	   
});
	


</script>   