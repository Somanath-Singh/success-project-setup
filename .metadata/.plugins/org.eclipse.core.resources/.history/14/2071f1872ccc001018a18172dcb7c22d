<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>

<c:set var="contextPath" value="${pageContext.request.contextPath}" />

<script src="${contextPath}/assets/applicationSpecific/encrypt/aes.js"></script>
<script src="${contextPath}/assets/applicationSpecific/encrypt/AesUtil.js"></script>
<script src="${contextPath}/assets/applicationSpecific/encrypt/lbase.js"></script>
<script src="${contextPath}/assets/applicationSpecific/encrypt/pbkdf2.js"></script>
<script src="${contextPath}/assets/appJs/validation/common-utils.js"></script>
<script src="${contextPath}/assets/appJs/validation/commonMaster.js"></script>
<script src="${contextPath}/assets/js/moment.js"></script>

<style>
  .status-button {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    font-size: 14px;
    font-weight: bold;
    border-radius: 5px;
    border: none;
    text-align: center;
    cursor: pointer;
  }
  .status-button.approved { background: #d4edda; color: #155724; }
  .status-button.rejected { background: #f8d7da; color: #721c24; }
  .status-button.pending  { background: #fff3cd; color: #856404; border: 1px solid #ffbf88; }
  .btn-submit {
    border-bottom: none;
  }


</style>
<div class="breadcrumb_conatiner">
    <div class="col-md-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="${contextPath}/home">Home</a>
                </li>
                 <li class="breadcrumb-item">
                    <a href="#">Recruitment</a>
                </li>
                <li class="breadcrumb-item active">Candidate Registration List</li>
            </ol>
        </nav>
    </div>
</div>
<div class="row">
	<div class="col-md-12">
	  <div class="card">
	    <div class="card-header"><h5>Candidate Registration List :</h5></div>
	
	    <div class="card-body">
	    <%@ include file="/WEB-INF/views/message.jsp"%>
	      <ul class="nav nav-tabs" id="candidateTabs" role="tablist">
	        <li class="nav-item">
	          <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">Pending</button>
	        </li>
	        <li class="nav-item">
	          <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab">Approved</button>
	        </li>
	        <li class="nav-item">
	          <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button" role="tab">Rejected</button>
	        </li>
	      </ul>
	      <div class="tab-content" id="candidateTabsContent">
	        <!-- Pending Tab -->
	        <div class="tab-pane fade show active" id="pending" role="tabpanel">
	        	<div class="table-responsive">
			          <table class="datatable table table-striped table-bordered exportbtn">
			            <thead>
			              <tr>
			                <th class="text-center" style="width:60px;">Sl. No</th>
			                <th style="width:150px;">Registration Code</th>
			                <th>First Name</th>
			                <th style="min-width:100px;">Last Name</th>
			                <th style="width:100px;">D.O.B</th>
			                <th>Gender</th>
			                <th>Mobile</th>
			                <th>Email</th>
			                <th class="text-center">Status</th>
			                <th class="text-center">Action</th>
			              </tr>
			            </thead>
			            <tbody>
			              <c:set var="i" value="0" />
			              <c:forEach var="candidate" items="${registrationList.regFormList}">
			                <c:if test="${candidate.status ne 'APPROVED' and candidate.status ne 'REJECTED'}">
			                  <c:set var="i" value="${i + 1}" />
			                  <tr>
			                    <td class="text-center">${i}</td>
			                    <td>${candidate.registrationCode}</td>
			                    <td>${candidate.firstName}</td>
			                    <td>${candidate.lastName}</td>
			                    <td><fmt:formatDate value="${candidate.dob}" pattern="dd-MM-yyyy" /></td>
			                    <td>${candidate.genderId.genderNameEN}</td>
			                    <td>${candidate.contact}</td>
			                    <td>${candidate.email}</td>
			                    <td class="text-center">
			                      <button class="status-button btn btn-warning" title="Pending"><i class="fa-solid fa-hourglass-end"></i></button>
			                    </td>
			                    <td class="text-center">
			                      <button class="btn btn-sm btn-primary" onclick="selection('${candidate.registrationId}')" title="View/Action">
			                        <i class="fas fa-eye"></i>
			                      </button>
			                    </td>
			                  </tr>
			                </c:if>
			              </c:forEach>
			            </tbody>
			          </table>
			       </div>
	        </div>
	        <!-- Approved Tab -->
	        <div class="tab-pane fade" id="approved" role="tabpanel">
	        	<div class="table-responsive">
			          <table class="table table-bordered table-striped exportbtn">
			            <thead>
			              <tr>
			                <th class="text-center" style="width:60px;">Sl. No</th>
			                <th>Registration Code</th>
			                <th>First Name</th>
			                <th>Last Name</th>
			                <th>D.O.B</th>
			                <th>Gender</th>
			                <th>Mobile</th>
			                <th>Email</th>
			                <th style="text-align: center;">Status</th>
			              </tr>
			            </thead>
			            <tbody>
			              <c:set var="i" value="0" />
			              <c:forEach var="candidate" items="${registrationList.regFormList}">
			                <c:if test="${candidate.status == 'APPROVED'}">
			                  <c:set var="i" value="${i + 1}" />
			                  <tr>
			                    <td class="text-center">${i}</td>
			                    <td>${candidate.registrationCode}</td>
			                    <td>${candidate.firstName}</td>
			                    <td>${candidate.lastName}</td>
			                    <td><fmt:formatDate value="${candidate.dob}" pattern="dd-MM-yyyy" /></td>
			                    <td>${candidate.genderId.genderNameEN}</td>
			                    <td>${candidate.contact}</td>
			                    <td>${candidate.email}</td>
			                    <td class="text-center">
			                      <button class="btn btn-approved" title="Approved"><i class="fa fa-check"></i></button>
			                    </td>
			                  </tr>
			                </c:if>
			              </c:forEach>
			            </tbody>
			          </table>
			      </div>
	        </div>
	        <!-- Rejected Tab -->
	        <div class="tab-pane fade" id="rejected" role="tabpanel">
	        	<div class="table-responsive">
			          <table class="table table-bordered table-striped exportbtn">
			            <thead>
			              <tr>
			                <th class="text-center" style="width:60px;">Sl. No</th>
			                <th>Registration Code</th>
			                <th>First Name</th>
			                <th>Last Name</th>
			                <th>D.O.B</th>
			                <th>Gender</th>
			                <th>Mobile</th>
			                <th>Email</th>
			                <th style="text-align: center;">Status</th>
			              </tr>
			            </thead>
			            <tbody>
			              <c:set var="i" value="0" />
			              <c:forEach var="candidate" items="${registrationList.regFormList}">
			                <c:if test="${candidate.status eq 'REJECTED'}">
			                  <c:set var="i" value="${i + 1}" />
			                  <tr>
			                    <td class="text-center">${i}</td>
			                    <td>${candidate.registrationCode}</td>
			                    <td>${candidate.firstName}</td>
			                    <td>${candidate.lastName}</td>
			                    <td><fmt:formatDate value="${candidate.dob}" pattern="dd-MM-yyyy" /></td>
			                    <td>${candidate.genderId.genderNameEN}</td>
			                    <td>${candidate.contact}</td>
			                    <td>${candidate.email}</td>
			                    <td class="text-center">
			                      <button class="btn btn-danger" title="Rejected"><i class="fa-solid fa-xmark"></i></button>
			                    </td>
			                  </tr>
			                </c:if>
			              </c:forEach>
			            </tbody>
			          </table>
			       </div>
	        </div>
	      </div>
	      <div class="col-md-12" style="margin-top: 20px; display: flex; justify-content: center; align-items: center;">
	        <a href="${contextPath}/public/getRegistrationList" type="button" class="btn btn-back">
	          <spring:message code="site.common.back" />
	        </a>
	      </div>
	    </div>
	  </div>
	 </div>
</div>

<form action="${contextPath}/public/checkStatus" method="GET" id="statusId">
  <input type="hidden" name="registrationId" id="registrationStatusId" />
  <input type="hidden" id="statusCipherText" name="cipherText" />
  <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
</form>

<script>
  function selection(id) {
    $("#registrationStatusId").val(id);
    var bizContent = $("#statusId").serializeArray();
    console.log("Form Data:", bizContent);
    try {
      var encrypted = enc_password(JSON.stringify(bizContent));
      $("#statusCipherText").val(encrypted);
      console.log("Encrypted:", encrypted);
    } catch (e) {
      console.error("Encryption error:", e);
    }
    showLoader();
    $("#statusId").submit();
  }
</script>
