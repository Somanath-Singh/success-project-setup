
class subWiseVacancyPiechart{
	constructor(apiPath, contextPath)
	{
		this.apiPath =  apiPath;
		this.worker = null;
		this.contextPath = contextPath;
		this.data = null;
		this.context = "STATE";
		this.chart=null;
	}

	doFetch() {
    		if (this.worker == null )
		{
			this.worker = new Worker(this.contextPath + '/assets/appJs/CommonWorker.js');
			this.worker.addEventListener('message', (e) => this.processData(e));
		}
		
		var filterVal = $("#subjectId").val();
		let url = this.contextPath + this.apiPath + "subWiseVacancyPieChartData" ;
		url = url + "?chartCall=SUB_WISE_VACANY&subject="+filterVal;

		window.loadCounter++;
		this.worker.postMessage({
			"method" : "GET" ,
			"url" : url ,
			"payload" : null,
			//subject: filterVal
		});

	}
processData(e) {
    if (e.data != null && e.data.data) {
        this.data = e.data.data;  // Assuming the API returns an object with a 'data' property

        let applied = 0;
        let published = 0;
        let vacancy = 0;

        this.data.forEach((item) => {
            applied += item.total_applied || 0;
            published += item.total_published || 0;
            vacancy += item.total_vacancies || 0;
        });

        if (applied === 0 && published === 0 && vacancy === 0) {
            applied = published = vacancy = 0;
        }

        var options = {
            series: [applied, published, vacancy],
            chart: {
                type: 'pie',  // Pie chart type
                width: 300
            },
            labels: ['Applied', 'Result Published', 'Total Vacancy'],
            dataLabels: {
                enabled: true,  
            },
            legend: {
                position: 'right', 
            },
			colors: ['#e67e22', '#006666c2', '#56C3C3'], 
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val;  
                    }
                }
            }
        };

        if (this.chart) {
            this.chart.destroy();
        }

        this.chart = new ApexCharts(document.querySelector("#difficulty2"), options);
        this.chart.render();
    } else {
        document.querySelector("#difficulty2").innerHTML = "<p>No data available for the selected subject.</p>";
    }
}
}



	
