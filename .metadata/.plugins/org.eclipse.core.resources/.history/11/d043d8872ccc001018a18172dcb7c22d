<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix = "fn" uri = "http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib uri = "http://java.sun.com/jsp/jstl/functions" prefix = "fn" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>

<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<sec:authentication var="principal" property="principal" />
<c:set var="roleCode" value="${principal.primaryRole.roleCode}"/>
<c:set var="yourMap" value="${clgDeptmapList}" />

<%-- <c:set var="calendar" value="<%= Calendar.getInstance() %>" />
<c:set var="currentYear" value="${calendar.time.year + 1900}" />
<c:set var="currentDate" value="<%= new Date() %>" />
<c:set var="dateFormat" value="<%= new SimpleDateFormat(\"MMM\") %>" />
<c:set var="currentMonth" value="${dateFormat.format(currentDate).toUpperCase()}" />
<c:set var="currentDateForNum" value="<%= LocalDate.now() %>" />
<c:set var="currentMonthNumber" value="${currentDateForNum.monthValue}" />
 --%>
<style>
.customBtn {
    font-size: 14px !important;
    padding: 5px 8px !important;
    line-height: 17px !important;
    border-radius: 4px !important;
    width: auto;
}
.staff-list-hlink {
    color: #0d44d1;
	font-weight: 600;
    text-decoration: none;
    letter-spacing: -0.25px;
        font-size: 11px;
}
.staff-list-hlink:hover {
    text-decoration: underline;
}
table.dataTable tbody th, table.dataTable tbody td {
	padding: 6px 3px 6px 3px;
}
</style>

<c:set var="_DisplayName" value=""/>
<c:choose>
	<c:when test="${_PageType eq 'STAFFLIST'}"><c:set var="_DisplayName" value="Staff List"/></c:when>
	<c:when test="${_PageType eq 'PROMOTION'}"><c:set var="_DisplayName" value="Staff List For Promotion"/></c:when>
	<c:when test="${_PageType eq 'TRANSFER'}"><c:set var="_DisplayName" value="Staff List For Transfer"/></c:when>
	<c:when test="${_PageType eq 'SUSPENSION'}"><c:set var="_DisplayName" value="Staff List For Suspension"/></c:when>
	<c:when test="${_PageType eq 'PAYSLIP'}"><c:set var="_DisplayName" value="Staff List"/></c:when>
	<c:when test="${_PageType eq 'EOS'}"><c:set var="_DisplayName" value="Staff List"/></c:when>
	<c:otherwise><c:set var="_DisplayName" value="Staff List"/></c:otherwise>
</c:choose>



<section class="main-panel">
	<div class="content">
		<div class="breadcrumb_conatiner">
			<div class="col-md-6"><h4 class="change-color">${_DisplayName}</h4></div>
			
			<div class="col-md-6">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a href="${contextPath}/home"><i class="fa fa-home"></i></a></li>
						<li class="breadcrumb-item active" aria-current="page">${_DisplayName}</li>
					</ol>
				</nav>
			</div>
		</div>

		<div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-header">
						<h6 class="card-title">${_DisplayName}</h6>
						<a href="${contextPath}/staff/add" class="btn btn-primary customBtn" style="float: right;">Onboard A New Staff</a>
					</div>

					<div class="card-body">
					
						<div class="row mb-3">
								<div class="col-md-4">
								<div class="form-group">
   							        <label class="col-sm-12 required" for="grade0">Organization :</label>
   							        <div class="col-sm-12">
<%-- 									 <input type="hidden" value="${classObjectValue}" id="classObjectValueId" /> --%>
									<select name="employmentList[${status.index}].objectIdAndType"  class="form-control form-select form-control-sm" id="objectIdAndTypeId"  onchange="getLevelListByOrganization(this);fetchList()">
										<option value="0">Select Organization<%-- [${String.valueOf(departRole.objectId).concat('##').concat(departRole.userLevel)}] --%></option>
										<c:forEach items="${organizationList}" var="organization">
											<option value="${organization.combineTwo}" ${currentOrgLvl eq organization.combineTwo ? 'selected' : ''} <%--  <c:if test="${organization.combineTwo eq String.valueOf(departRole.objectId).concat('##').concat(departRole.objectType)}">selected</c:if> --%>>${organization.organizationName}</option>
										</c:forEach>
									</select>
									</div>
									</div>
								</div>
								<div class="col-md-4">
							<div class="form-group">
							<label class="col-sm-12 required" for="grade0">Level :</label>
    						<div class="col-sm-12">
<%-- 								<div class="col-sm-4" ${empeBasicDetails.staffCollegeDeptRoleMap.levelId ne null ? 'style="pointer-events:none;"' : ''}> --%>
									<select class="form-control form-select" name="employmentList[${status.index}].levelData" id="levelSelect" onchange="getActualLevelNameListByLevelCodeAndOrgId(this);fetchList()" data-plugin-selectTwo>
										<option value="0"><spring:message code="label.common.select"></spring:message></option>
										<c:forEach var="level" items="${levelList}">
											<option value="${level.organizationStructure.objectId}##${level.levelCode}##${level.organizationStructure.objectType}"  ${String.valueOf(level.organizationStructure.objectId).concat('##').concat(level.levelCode).concat('##').concat(level.organizationStructure.objectType) eq selLevel ? 'selected':''}>${level.levelCode}</option>
										</c:forEach>
									</select>
<!-- 								</div> -->
							</div>
							</div>
							</div>
							<div class="col-md-4">
							<div class="form-group">
							<label class="col-sm-12 required" for="grade0">Level Name :</label>
    						<div class="col-sm-12">
<%-- 								<input type="hidden" class="validId7" id="staffDeptMapId${status.index}" name="employmentList[${status.index}].staffDeptMapId" value="${departRole.staffDeptMapId}"> --%>
<%-- 								<div class="col-sm-4" ${empeBasicDetails.staffCollegeDeptRoleMap.departmentId.levelName ne null ? 'style="pointer-events:none;"' : ''}> --%>
									<select class="form-control form-select empcls" name="employmentList[${status.index}].actualLeveldata" id="levelNameSelect${status.index}" onchange="fetchList()" data-plugin-selectTwo>
										<option value="0"><spring:message code="label.common.select"></spring:message></option>
										<c:forEach var="actualLevel" items="${actualLevelList}">
											<option value="${actualLevel.combineTwo}" ${actualLevel.combineTwo eq selLevelName ? 'selected' : ''}>${actualLevel.organizationName}</option>
										</c:forEach>
									</select>
<!-- 								</div> -->
							</div>
						</div>
						</div>
						</div>
						<hr/>
						<div class="table-responsive">
							<%-- <table class="datatable table table-striped table-bordered staff-list-datatable exportbtn">
								<thead>
									<tr>
										<th style="width: 04%;text-align:center">Sl. No</th>
										<th style="width: 22%;">Staff Name &amp; Code</th>
										<th style="width: 15%;">Email Id</th>
										<th style="width: 07%;">Date of Joining</th>
										<!-- <th style="width: 21%;">College</th> -->
										<th style="width: 13%;">Department</th>
										<th style="width: 13%;">Designation</th>
										<th style="width: 08%;">Employment Type</th>
										<th style="width: 09%;">Staff Type</th>
										<th style="width: 09%; text-align: center;">Action</th>
									</tr>
								</thead>
								<tbody id="tbd">
									 <c:forEach items="${_CommonStaffList}" var="stfObj" varStatus="rec" >
										<tr>
											<td>${rec.count}</td>
											<td>${stfObj.staffName}  (${stfObj.staffCode})</td>
											<td style="word-break: break-all;">${stfObj.emailId}</td>
											<td>${stfObj.dateOfJoiningAsDdMmYyyy}</td>
											<td>${stfObj.collegeName}</td>
											<td>${stfObj.departmentName}</td>
											<td>${stfObj.designationName}</td>
											<td>${stfObj.emplmntTypeName}</td>
											<td>
												<c:if test="${stfObj.staffType eq 'NON-TEACHING'}">Non-Teaching</c:if>
												<c:if test="${stfObj.staffType eq 'TEACHING'}">Teaching</c:if>
											</td>
											<td style="text-align: center;">
												 <c:if test="${_PageType eq 'STAFFLIST'}">			 <!-- && stfObj.staffColgDeptRoleMapId ne 0 -->
													<button type="button" class="  btn btn-primary" onclick="submitForm('STAFFLIST','${stfObj.staffId}')" ><i class="far fa-eye"></i></button>
												</c:if>
												<c:if test="${_PageType eq 'PROMOTION' && ((stfObj.staffCategory eq 'GOV') || (stfObj.staffCategory eq 'NON_GOV' && stfObj.categoryCode eq 'AIDED' &&  stfObj.moduleMstCode eq 'PROMOTION'))}">
													<a href="#" class="staff-list-hlink" onclick="submitForm('PROMOTION','${stfObj.encryptedStaffId}')">Initiate Promotion</a>
												</c:if>
												<!-- <c:if test="${_PageType eq 'TRANSFER' && stfObj.staffColgDeptRoleMapId ne 0  && ((stfObj.giaApplicable eq 'YES' && stfObj.serviceApplicable eq true )  || stfObj.staffCategory eq 'GOV')}">
													<a href="#" class="staff-list-hlink" onclick="submitForm('TRANSFER','${stfObj.staffId}','OTHER')">Initiate Transfer</a>
												</c:if> -->
												<c:if test="${_PageType eq 'TRANSFER' && ((stfObj.staffCategory eq 'GOV') || (stfObj.staffCategory eq 'NON_GOV' && stfObj.categoryCode eq 'AIDED' &&  stfObj.moduleMstCode eq 'TRANSFER'))}">
													<a href="#" class="staff-list-hlink" onclick="submitForm('TRANSFER','${stfObj.staffId}','OTHER')">Initiate Transfer</a>
												</c:if>
												<c:if test="${_PageType eq 'SUSPENSION' && stfObj.staffColgDeptRoleMapId ne 0 && ((stfObj.giaApplicable eq 'YES' && stfObj.serviceApplicable eq true)  || stfObj.staffCategory eq 'GOV')}">
													<a href="#" class="staff-list-hlink" onclick="submitForm('SUSPENSION','${stfObj.staffId}')">Initiate Suspension</a>
												</c:if>
												<c:if test="${_PageType eq 'PAYSLIP' && stfObj.staffColgDeptRoleMapId ne 0 }">
													<label><a href="#" class="staff-list-hlink" data-bs-toggle="modal" data-bs-target="#generatePayslipModal" onclick="generatePayslip(${stfObj.staffId});getDates();">View Payslip</a></label>
												</c:if>
												<c:if test="${_PageType eq 'EOS'}">
													<c:choose>
														<c:when test="${empty stfObj.eosReasonCode}">
															<label>
																<a href="#" class="staff-list-hlink" onclick="setStaffIdAndShowModal(${stfObj.staffId}, '', '','SAVE');" style="color: #1d70ab; font-weight: 400;}">Initiate EOS</a>
															</label>
														</c:when>
														<c:otherwise> 
															<label>
																<a href="#" class="staff-list-hlink"  onclick="setStaffIdAndShowModal(${stfObj.staffId}, '${stfObj.eosReasonCode}','${stfObj.eosDate}','EDIT');">Edit EOS</a>
															</label>
														 </c:otherwise>
													</c:choose>
												</c:if>
											</td>
							   			</tr>
									 </c:forEach>
								</tbody>
							</table> --%>
							
							
							<table class="datatable table table-striped table-bordered exportbtn">
								<thead>
									<tr>
										<th style="width: 60px;text-align:center;">Sl.No.</th>
										<th style="min-width: 250px;">Staff Name &amp; Code</th>
										<th style="min-width: 250px;">Email Id</th>
										<th style="min-width: 150px;">Date of Joining</th>
										
										<th style="width: 150px;" class="text-center">Action</th>
									</tr>
								</thead>
								<tbody id="tbd">
									 <c:forEach items="${staffMemberList}" var="staff" varStatus="rec" >
										<tr>
											<td style="text-align:center;">${rec.count}</td>
											<td>${staff.staffName}  (${staff.staffCode})</td>
											<td style="word-break: break-all;">${staff.email}</td>
											<td><fmt:formatDate pattern="dd/MM/yyyy" value="${staff.dateOfJoing}"/></td>
											<td class="text-center">
												<strong><a href="javascript:void(0)" class="staff-list-hlink btn btn-primary btn-sm" title="View / Edit" onclick="editStaff('${staff.staffId}','EDIT');"><i class="fa-regular fa-pen-to-square"></i></a></strong>
											</td>
											
							   			</tr>
									 </c:forEach>
								</tbody>
							</table>
							
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<!-- ################  DIFFERENT FORMS BASED ON CONDITIONS OF CLICK IN STAFF-LIST PAGE  ################ -->    

<%-- <!-- ==========================  FORM SUBMIT FOR STAFF-MASTER-LIST  ========================== -->
<form action = "${contextPath}/staffOnboard/editStaffDetails" method="get" id="viewForm">
	<input type="hidden" id="cipherText" name="cipherText">
   <input type="hidden" name="staffId" id="staffId"/>
</form>

<!-- ==========================  FORM SUBMIT FOR STAFF-MASTER-LIST  ========================== -->
<form id="formStaffMst" action="${contextPath}/promotion/getStaffPromotion" method="post">
	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
	<input type="hidden" name="staffIdInStaffMaster" id="staffIdInStaffMaster" value="">
</form>

<!-- ==========================  FORM SUBMIT FOR STAFF-PROMOTION-LIST  ========================== -->

<form id="formStaffPromotion" action="${contextPath}/promotion/getStaffPromotion" method="post">
	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
	<input type="hidden" name="staffIdInStaffMaster" id="staffIdInStaffMaster" value="">
</form>

<form id="formStaffPromotion" action="${contextPath}/promotion/getStaffPromotion" method="get">
	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
	<input type="hidden" name="staffIdInPromotion" id="staffIdInStaffMasterhdnId" >
</form>

<!-- ==========================  FORM SUBMIT FOR STAFF-TRANSFER-LIST  ========================== -->
<form id="formStaffTransfer" action="${contextPath}/transfer/getStaffTransfer" method="get">
	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
	<input type="hidden" name="staffIdInTransfer" id="staffIdInTransfer" value="">
	<input type="hidden" name="transTypStatus" id="transTypStatus" value="">
</form>

<!-- ==========================  FORM SUBMIT FOR STAFF-SUSPENSION-LIST  ========================== -->
<form id="formStaffSuspension" action="${contextPath}/suspension/staffSuspension" method="post">
		<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" /> 
	<input type="hidden" name="staffIdInSuspnsn" id="staffIdInSuspnsn" >
</form>
<!-- ==========================  FORM SUBMIT FOR STAFF-REVOKE-LIST  ========================== -->

<!-- ################  END : DIFFERENT FORMS BASED ON CONDITIONS OF CLICK IN STAFF-LIST PAGE  ################ -->    



<!-- ===========================================  Generate Payslip Modal =========================================== -->
<div class="modal fade" id="generatePayslipModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content" style="top: -8em;">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Payslip Period</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form action="${contextPath}/generatePDF/payslip" method="POST" id="printPayslip" target="_blank">
					<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
					<input type="hidden" name="staffId" id="hdnStaffId" />

					<div class="row">
						<div class="col-md-3">
							<label for="payYear" class="form-label required">Pay Year :</label>
							<select class="form-control form-control-sm form-select" id="payYear" name="year" onchange="generatePaybillAndGetOtherDetailsBySalTypeColgIdMonthYearInPage(); //resetMonth()">
								<option value="0">- Select -</option>
								<c:forEach items="${yearList}" var="year">
									<option value="${year}" ${currentYear eq year ? 'selected' : ''}>${year}</option>
								</c:forEach>
							</select>
						</div>
						<div class="col-md-3">
							<label for="month" class="form-label required">Pay Month :</label>
							<select class="form-control form-control-sm form-select" id="month" name="month" onchange="generatePaybillAndGetOtherDetailsBySalTypeColgIdMonthYearInPage(); //populateDates(this.value)">
								<option value="0">- Select -</option>
								<c:forEach items="${monthMap}" var="month">
									<option value="${month.key}" ${currentMonthNumber eq month.key ? 'selected' : ''}>${month.value}</option>
								</c:forEach>
							</select>
						</div>

						<div class="col-md-6 text-center">
							<label for="fromDate" class="form-label">Paid for Duration :</label>
							<div class="col-md-12">
								<input type="text" class="form-control form-control-sm" readonly name="fromDate" id="fromDate" value="<fmt:formatDate pattern='dd/MM/yyyy' value='${payrollProcessVO.fromDate}' />" style="width: 40%; display: inline-block; background: none; border: none; color: #212529; text-align: right;">
								<label>&nbsp;TO&nbsp;</label>
								<input type="text" class="form-control form-control-sm" readonly name="toDate" id="toDate" value="<fmt:formatDate pattern='dd/MM/yyyy' value='${payrollProcessVO.toDate}' />" style="width: 40%; display: inline-block; background: none; border: none; color: #212529;">
							</div>
						</div>
					</div>


					<div class="row">
						<div class="col-md-6">
							<div class="mb-3">
								<label for="fromDate" class="form-label required">From Date :</label>
								<div class="col-md-12">
									<input type="text" class="form-control form-control-sm" readonly name="fromDate"  id="fromDate" value="<fmt:formatDate pattern='dd/MM/yyyy' value='${payrollProcessVO.fromDate}' />">
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="mb-3">
								<label for="toDate" class="form-label required">To Date :</label>
								<div class="col-md-12">
									<input type="text" class="form-control form-control-sm" readonly name="toDate" id="toDate" value="<fmt:formatDate pattern='dd/MM/yyyy' value='${payrollProcessVO.toDate}' />">
								</div>
							</div>
						</div>
					</div>


				</form>
			</div>
			<div class="modal-footer justify-content-center">
				<button type="submit" onclick="submitPayslipForm()" class="btn btn-primary">Generate</button>
			</div>
		</div>
	</div>
</div>


<!-- Initiate Eos Modal -->
<div class="modal fade" data-bs-backdrop="static" id="addEndOfServiceDetails" tabindex="-1" aria-labelledby="eosModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content p-4">
			<div class="modal-header">
				<h5 class="modal-title" id="eosModalLabel" style="font-size: 16px; color: #000;">End of Service Details</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form action="${contextPath}/staff/saveEosDetails" method="POST" id="saveEOSFrm">
					<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
					<input type="hidden" id="mdlstaffId" name="staffId" />

					<div class="row">
						<div class="col-md-6">
							<div class="mb-3">
								<label for="mdlEosReasonId" class="form-label required">EOS Reason :</label>
								<select class="form-control form-control-sm form-select" id="mdlEosReasonId" name="eosReasonCode">
									<option value="0">- Select -</option>
									<c:forEach items="${reasonList}" var="rsn">
										<option value="${rsn.statusCode}" ${staffDetails.eosReasonCode eq rsn.statusCode ? 'selected' : ''}>${rsn.serviceStatus}</option>
									</c:forEach>
								</select>
							</div>
						</div>
						<div class="col-md-6">
							<div class="mb-3">
								<label for="mdlEosDtId" class="form-label required">EOS Date :</label>
								<div class="col-md-12 datepicker-box">
									<input type="text" class="form-control form-control-sm datepicker1" name="eosDate" id="mdlEosDtId" />
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer justify-content-center">
				<button type="button" onclick="submitEOSDetails()" class="btn btn-primary" id="action">Save</button>
				<button type="button" class="btn btn-danger" onclick="cancelEosData()">Cancel</button>
			</div>
		</div>
	</div>
</div> --%>



<!-- ==========================               ##              ========================== -->
<form id="formStaffMst" action="${contextPath}/staff/editStaffMember" method="post">
	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
	<input type="hidden" name="staffId" id="staffIdd" value="">
	<input type="hidden" name="code" id="code" value="">
</form>

<form id="fetchList" action="${contextPath}/staff/staffMemberList">
	<input type="hidden" name="filterData" id="filterData" value="">
</form>

<%-- <script src="${contextPath}/assets/appJs/validation/common-utils.js"></script> --%>
<script src="${contextPath}/assets/appJs/validation/commonMaster.js"></script>





<script>

function editStaff(staffId,code){
	$("#staffIdd").val(staffId);
	$('#code').val(code);
	$('#formStaffMst').submit();
	
}

var arr = [];
function fetchList(){
	if($('#objectIdAndTypeId').val() != '0'){
		arr.push($('#objectIdAndTypeId').val());
		arr.push($('#levelSelect').val());
		arr.push($('#levelNameSelect').val());
		$('#filterData').val(btoa(arr.toString()));
		$('#fetchList').submit();
	}else {
		$('#levelSelect').val(0);
		$('#levelNameSelect').val(0);
	}
}

</script>


<script>

 $(document).ready(function() {
	$('.staff-list-datatable').DataTable({
		dom: 'lBfrtip',
		responsive: true,
		pageLength: 20,
		lengthMenu: [10,20,50,100],
		buttons: ["copy","excel","pdf"]
	});
}); 

/* $(document).ready(function() {
    // Initialize DataTable with custom configurations
    var dataTable = $('.staff-list-datatable').DataTable({
        dom: 'lBfrtip',
        responsive: true,
        pageLength: 20,
        lengthMenu: [10, 20, 50, 100],
        buttons: [
            {
                extend: 'copy',
                text: 'Copy',
                filename: 'transferlist', // Set the filename for Excel download
                exportOptions: {
                    columns: ':not(:last-child)' // Exclude the last column from copy
                }
            },
            {
                extend: 'excel',
                text: 'Excel',
                filename: 'transferlist', // Set the filename for Excel download
                exportOptions: {
                    columns: ':not(:last-child)' // Exclude the last column from Excel export
                }
            },
            {
                extend: 'pdf',
                text: 'PDF',
                filename: 'transferlist', // Set the filename for Excel download
                exportOptions: {
                    columns: ':not(:last-child)' // Exclude the last column from PDF export
                }
            }
        ]
    });
}); */

/* ========================= */
function encodeStaffId(id) {
	return btoa(id);
}

function submitForm(eventType,staffId)
{
	showLoader();

	if(eventType.toUpperCase() == 'STAFFLIST')
	{
		//$('#staffId').val(staffId);
		//window.location.href = "${contextPath}/staffOnboard/editStaffDetails?staffId=" +staffId;
		//$('#staffMstform').submit();
		$('#staffId').val(staffId);
	    //var bizContent = $("#viewForm").serialize();
	    //$("#cipherText").val(enc_password(staffId));
		showLoader();
		$("#viewForm").submit();
	}
	else if(eventType.toUpperCase() == 'PROMOTION')
	{
		$("#staffIdInStaffMasterhdnId").val(staffId);
		$('#formStaffPromotion').submit();
	}
	else if(eventType.toUpperCase() == 'TRANSFER')
	{
		$('#transTypStatus').val('OTHER');
  		$('#staffIdInTransfer').val(staffId);
		$('#formStaffTransfer').submit();
	}
	else if(eventType.toUpperCase() == 'SUSPENSION')
	{
		$('#staffIdInSuspnsn').val(staffId);
		$('#formStaffSuspension').submit();
	}
	else
	{
		hideLoader();
	}
}


function submitPayslipForm(){
	if($("#payYear").val() == 0){
		bootbox.alert("Please select the pay year.");
		return false;
	} else if($("#month").val() == 0){
		bootbox.alert("Please select the pay month.");
		return false;
	} else {
		$("#printPayslip").submit();
// 		$('#printPayslip')[0].reset();
// 		$('#generatePayslipModal').modal('hide');
	}
}

function generatePayslip(staffId)
{
	$("#payYear").val(${currentYear});
	$("#month").val(${currentMonthNumber});
	$("#hdnStaffId").val(staffId);
	generatePaybillAndGetOtherDetailsBySalTypeColgIdMonthYearInPage();
}

function resetMonth()
{
	$("#month").val("0");
	$("#fromDate").val("");
	$("#toDate").val("");
}
/* function getDates()
{
	if(${currentMonthNumber} != '' && !isNaN(${currentMonthNumber}) && ${currentMonthNumber} != 'undefined')
	{
		$("#payYear").val(${currentYear});
		$("#month").val(${currentMonthNumber});
// 		populateDates(${currentMonthNumber});
	}
} */

<%-- function generatePaybillAndGetOtherDetailsBySalTypeColgIdMonthYearInPage()
{
	var salaryType = '<%=PayrollSalaryConstantEnums.REGULAR%>';
	var collegeId = -1;
	var monthNum = $("#month").val();
	var yearNum = $("#payYear").val();
	var emplmntTypeId = -1;
	
	var ajaxResultObj = AJAX_generatePaybillAndGetOtherDetailsBySalTypeColgIdMonthYear(salaryType, collegeId, monthNum, yearNum, emplmntTypeId);
	if(ajaxResultObj != "")
	{
		$("#fromDate").val(ajaxResultObj.startDateAsDdMmYyyy);
		$("#toDate").val(ajaxResultObj.endDateAsDdMmYyyy);
	}
} --%>

<!-- For EOS -->
$(function() {
	$('.datepicker1').datepick({
		onShow: $.datepick.monthOnly,dateFormat: 'dd/mm/yyyy', yearRange: 'c-20:c+10', showOnFocus: true,
        maxDate: new Date(),
		showTrigger: '<button type="button" class="trigger"><i class="fa fa-calendar"></i></button>'
	});
});

function submitEOSDetails() {
    var staffId = $("#mdlstaffId").val();
    var action = $("#action").text();
    var eosDtId = $("#mdlEosDtId").val();
    var eosReasonId = $("#mdlEosReasonId").val();

    if (eosReasonId === null || eosReasonId === "" || eosReasonId == 0) {
        bootbox.alert("Please select EOS Reason");
        return false;
    } else if (eosDtId === null || eosDtId === "") {
        bootbox.alert("Please select EOS Date");
        return false;
    } else {
        bootbox.confirm("Do you want to " + action + "?", function(result) {
            if (result) {
                showLoader();
                $("#mdlstaffId").val(staffId);
                $("#saveEOSFrm").submit();
            }
        });
    }
}


function setStaffIdAndShowModal(staffIdVal, eosReasonId, eosDtId, action) 
{
	$('#mdlstaffId').val(staffIdVal);

	if(eosReasonId != null && eosReasonId != ''){
		$('#mdlEosReasonId').val(eosReasonId);
	}else{	
		$('#mdlEosReasonId').val(0);
	}

	if(action == 'EDIT')
	{
		var eosDt = new Date(eosDtId);
		eosDtId = eosDt.getDate() + '/' + (eosDt.getMonth() + 1) + '/' + eosDt.getFullYear();
		$('#mdlEosDtId').val(eosDtId);
	}
	else
	{
		$('#mdlEosDtId').val('');
	}
	$('#action').text(action === 'SAVE' ? 'Save' : 'Update');
	$('#addEndOfServiceDetails').modal('show');
}

function cancelEosData()
{
	$('#mdlEosReasonId').val(0);
	$('#mdlEosDtId').val('');
}

function getLevelListByOrganization(that){
    if(that.value != 0){
    	$.ajax({
            url: "${contextPath}/api/allow/getLevelListByOrganization",
            method: "GET",
            data: { orgData: that.value },
            success: function(response) {
            	var data = JSON.parse(response);
            	var html = '<option value="0">- Select -</option>';
                $.each(data, function(index, value){
                	html += '<option value="'+value.orgIdNlevelCode+'">'+value.levelCode+'</option>';
                });
                $('#levelSelect').empty().append(html);
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Something Went Wrong: " + errorThrown);
            }
        });
    } else {
    	$('#levelSelect').empty().append('<option value="0">- Select -</option>');
    	$('#levelNameSelect').empty().append('<option value="0">- Select -</option>');
    }
}

function getActualLevelNameListByLevelCodeAndOrgId(that){
    if(that.value != 0){
    	$.ajax({
            url: "${contextPath}/api/allow/getActualLevelNameListByLevelCodeAndOrgId",
            method: "GET",
            data: { levelData: that.value },
            success: function(response) {
            	var data = JSON.parse(response);
            	var html = '<option value="0">- Select -</option>';
                $.each(data, function(index, value){
                	html += '<option value="'+value.entityIdNEntityName+'">'+value.entityName+'</option>';
                });
                $('#levelNameSelect').empty().append(html);
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Something Went Wrong: " + errorThrown);
            }
        });
    } else {
    	$('#levelNameSelect').empty().append('<option value="0">- Select -</option>');
    }
}

</script>
