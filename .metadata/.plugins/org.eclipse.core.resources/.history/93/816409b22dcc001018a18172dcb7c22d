<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script src="${contextPath}/assets/appJs/validation/common-utils.js"></script>
<script src="${contextPath}/assets/appJs/validation/commonMaster.js"></script>
<script src="${contextPath}/assets/js/moment.js"></script>



<style>
body {
	overflow: auto;
}

svg.svg-inline--fa.fa-calendar {
	color: #fff;
}

.carousel-inner>.item>img, .carousel-inner>.item>a>img {
	display: block;
	height: auto;
	max-width: 100%;
	line-height: 1;
	width: 100%;
}

.copyright-sec {
	position: fixed;
	bottom: 0;
	left: 0;
	width: 100%;
	z-index: 9;
	background: #1f1d1d;
	padding: 8px 0;
	color: #fff;
	text-align: center;
}

.copyright-sec p {
	margin-bottom: 0;
	font-size: 12px;
}

.copyright-sec p a {
	color: #f53400;
}

.copyright-sec p:hover a {
	text-decoration: none;
}

.copyright-sec p {
	display: flex;
	flex-wrap: wrap;
	justify-content: space-between;
}

.container-wa .floating-button {
	position: fixed;
	bottom: 10px;
	left: 12px;
	width: 60px;
	height: 60px;
	background-color: #fa592d;
	color: white;
	border-radius: 50px;
	text-align: center;
	font-size: 35px;
	cursor: pointer;
	box-shadow: 0px 2px 5px #666;
	z-index: 1000;
}

.container-wa .floating-button:hover {
	background-color: #1fad53;
}

.container-wa .floating-button .icon {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	line-height: 60px;
	text-align: center;
	transition: all 0.3s;
}

.container-wa .floating-button .icon.wa {
	animation: wa-out 0.3s;
}

.container-wa .floating-button .icon.close {
	opacity: 0;
	margin: auto;
	transform: rotateZ(-70deg);
	animation: close-out 0.3s;
}

.container-wa .card {
	font-family: 'Quicksand', sans-serif;
	position: absolute;
	width: 280px;
	height: auto;
	background-color: white;
	border-radius: 5px;
	left: 40px;
	bottom: 88px;
	display: none;
	border: 1px solid rgba(0, 0, 0, 0.15);
	z-index: 10000;
}

.container-wa .card .banner-header {
	background-image:
		url("../../investio.com.br/images/banner/bg-chat-whatsapp.jpg");
	background-size: cover;
	color: white;
	padding: 20px;
	padding-bottom: 40px;
	background-color: #075e54;
}

.container-wa .card .banner-body {
	flex-grow: 1;
	background-color: #eaeaea;
	padding: 15px;
}

.container-wa .card .banner-body .card-atendente {
	margin-top: -50px;
	background-color: white;
	padding: 15px;
	display: flex;
	flex-direction: column;
	border-radius: 15px;
}

.container-wa .card .banner-body .card-atendente .dados-atendente {
	display: flex;
}

.container-wa .card .banner-body .card-atendente .dados-atendente .avatar
	{
	padding: 15px;
}

.container-wa .card .banner-body .card-atendente .dados-atendente .avatar img
	{
	border-radius: 50%;
}

.container-wa .card .banner-body .card-atendente .dados-atendente .informacoes
	{
	padding: 15px;
}

.container-wa .card .banner-body .card-atendente .botao-atendente {
	display: flex;
}

.container-wa .card .banner-body .card-atendente .botao-atendente .btn {
	color: white;
	background-color: #d3b924;
	border-radius: 15px;
	width: 100%;
	padding: 10px;
	text-align: center;
	text-decoration: none;
}

.container-wa.is-opened .icon.wa {
	animation: wa-in 0.15s linear;
	animation-fill-mode: forwards;
}

.container-wa.is-opened .icon.close {
	animation: close-in 0.2s;
	animation-delay: 0.1s;
	animation-fill-mode: forwards;
}

.container-wa.is-opened .card {
	display: flex;
	flex-direction: column;
	position: fixed;
}

.container-wa.is-opened .icon.wa {
	animation: wa-in 0.15s linear;
	animation-fill-mode: forwards;
}

.container-wa.is-opened .icon.close {
	animation: close-in 0.2s;
	animation-delay: 0.1s;
	animation-fill-mode: forwards;
}

@
keyframes close-in {from { opacity:0;
	transform: rotateZ(-70deg);
}

to {
	opacity: 1;
	transform: rotateZ(0deg);
}

}
@
keyframes close-out {from { opacity:1;
	transform: rotateZ(0deg);
}

to {
	opacity: 0;
	transform: rotateZ(-70deg);
}

}
@
keyframes wa-in {from { opacity:1;
	transform: rotateZ(0deg);
}

to {
	opacity: 0;
	transform: rotateZ(180deg);
}

}
@
keyframes wa-out {from { opacity:0;
	transform: rotateZ(180deg);
}

to {
	opacity: 1;
	transform: rotateZ(0deg);
}

}
.card ul {
	padding: 0 15px;
	margin: 0;
	text-align: left;
}

.card ul li {
	color: rgb(0, 0, 0);
	text-decoration: none;
	list-style: none;
	padding: 10px 0;
	border-bottom: 1px solid rgba(145, 143, 143, 0.336);
}

.card ul li:nth-child(1) {
	text-align: left;
}

.container-wa .card .card-head p {
	text-align: center;
	text-decoration: underline;
	font-size: 20px;
	font-weight: 600;
	color: #000;
}

.container-wa .card .card-head {
	display: flex;
	align-items: center;
	justify-content: center;
}

.otp-field {
	display: inline-block;
	width: 2.1rem;
	height: 2rem;
	background-color: #fdfafa;
	border: 1px solid #9daab8;
	border-radius: 0.25rem;
	text-align: center;
}

.otp-field:focus {
	border-bottom-color: var(- -bs-dark);
}

.hidden {
	display: none;
}

.bootbox .modal-content {
	border-radius: 6px !important;
}
</style>
<!-- <div class="registration">
              <div class="container">
                <div class="row align-items-center">
                    <h3 class="instruction-heading text-center">
                      <i class="fa-solid fa-user-pen text-primary"></i>
                      Create an Account
                    </h3>
                </div>

              </div>
            </div> -->


<div class="new-registration">
	<div class="container">
		<%@ include file="/WEB-INF/views/message.jsp"%>
		<div
			style="max-width: 900px; margin: 0 auto; background: #f2e1d2; padding: 20px 40px; border-radius: 8px;">
			<form class="form-row" action="${contextPath}/public/save-reg"
				id="registrationFrmId" enctype="multipart/form-data" method="post"
				onsubmit="return validateSubmit();">
				<input type="hidden" name="${_csrf.parameterName}"
					value="${_csrf.token}" />
				<div class="row align-items-center">
					<h3 class="instruction-heading text-center">
						<i class="fa-solid fa-user-pen text-primary"></i> Create an
						Account
					</h3>
				</div>
				<div class="row mt-5">
					<div class="progress px-1" style="height: 3px">
						<div class="progress-bar" role="progressbar"
							style="width: 0%; background-color: blue;" aria-valuenow="0"
							aria-valuemin="0" aria-valuemax="100"></div>
					</div>
					<div class="step-container d-flex justify-content-between p-0 m-0">
						<div class="step-circle" onclick="displayStep('1')">1</div>
						<div class="step-circle" onclick="validateTab('TAB1')">2</div>
						<div class="step-circle" onclick="validateTab('TAB2')">3</div>
					</div>

					<!-- Step 1 form fields here -->
					<div class="step step-1" style="display: block;">
						<div class="d-flex align-items-center justify-content-center mb-4">
							<%-- <div>
	                          <img src="${contextPath}/assets/images/Personal-Information-icon.png" alt="" style="height: 36px; margin-right: 10px" />
	                        </div> --%>
							<div class="text-center" style="width: 100%;">
								<h3 class="instruction-heading mb-1 text-center"
									style="font-size: 18px; color: #01267F;">Personal
									Information</h3>
								<p class="span-text text-center">(As recorded in
									Matriculation (10th class) Certificate/Marks Sheet)</p>
							</div>
						</div>
						<div class="row">
							<div class="col-md-3">
								<div class="form-group mb-3">
									<label>First Name <span class="red">*</span></label> <input
										class="form-control" type="text" maxlength="50"
										autocomplete="off" name="firstName" id="fstNmId"
										placeholder="Enter your First Name " />
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group mb-3">
									<label>Last Name <span class="red">*</span>
									</label> <input class="form-control" type="text" name="lastName"
										autocomplete="off" maxlength="30" id="lstNmId"
										placeholder="Enter your Last Name" />
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group mb-3">
									<label>Date Of Birth <span class="red">*</span></label>
									<div class="dp-input datepicker-box">
										<input type="text" class="form-control datepicker" readOnly
											placeholder="DD/MM/YYYY" id="dobId" name="dob" />
									</div>
								</div>
							</div>

							<!-- 						<div class="form-group col-md-3"> -->
							<!-- 							<label class="required">Date Of Birth:</label> -->
							<!-- 							<div class="col-md-12 datepicker-box"> -->
							<!-- 								<input type="text" class="form-control form-control-sm datepicker" readonly name="dob" id="dobId" /> -->
							<!-- 							</div> -->
							<!-- 						</div> -->
							<div class="col-md-3">
								<div class="form-group mb-3">
									<label>Gender <span class="red">*</span></label> <select
										class="form-select" aria-label="Default select example"
										id="genderId" name="gender">
										<option value='0'>-- Select--</option>
										<c:forEach items="${genderList}" var="gen">
											<option value="${gen.typeId}">${gen.typeName}</option>
										</c:forEach>
									</select>
								</div>
							</div>
							<!-- <div class="col-md-3">
	                          <div class="form-group mb-3">
	                            <label>Father’s Name <span class="red">*</span></label>
	                            <input class="form-control alphabetsOnly" type="text" name="fatherName" placeholder=" Father’s Name" id="fathNmId" />
	                          </div>
	                        </div>
	                        <div class="col-md-3">
	                          <div class="form-group mb-3">
	                            <label>Mother’s Name <span class="red">*</span></label>
	                            <input class="form-control alphabetsOnly" type="text" name="motherName" placeholder=" Mother’s Name" id="mothNmId" />
	                          </div>
	                        </div> -->
							<div class="col-md-12 text-center mt-3">
								<button type="button" class="btn btn-primary" id="n-btn1"
									onclick="validateTab('TAB1')">Next</button>
							</div>
						</div>
					</div>

					<!-- Step 2 form fields here -->
					<div class="step step-2" style="display: none;">
						<div class="d-flex align-items-center justify-content-center mb-4">
							<!--  <div>
	                          <img src="assets/images/Communication-Information.png" alt="" style="height: 36px; margin-right: 10px" />
	                        </div> -->
							<div>
								<h3 class="instruction-heading mb-1 text-center"
									style="font-size: 18px; color: #01267F;">Contact Details</h3>
								<p class="span-text">(Enter your valid Mobile No. & Email
									Address)</p>
							</div>
						</div>
						<div id="messageDiv"></div>
						<div class="row">


							<!--    <div class="col-md-2">
	                          <div class="form-group mb-3">
	                            <label for="exampleInputEmail1" class="form-label">Email OTP <span class="red">*</span></label>
	                            <div class="test d-flex align-items-center gap-2">
	                              <input numberonly="" autocomplete="one-time-code" class="form-control" type="tel" placeholder="">
	                              <input numberonly="" autocomplete="one-time-code" class="form-control" type="tel" placeholder="">
	                              <input numberonly="" autocomplete="one-time-code" class="form-control" type="tel" placeholder="">
	                              <input numberonly="" autocomplete="one-time-code" class="form-control" type="tel" placeholder="">
	                            </div>
	                          </div>
	                        </div>  -->

							<div class="col-md-3">
								<div class="form-group mb-3">
									<label class="form-label">Mobile No. <span class="red">*</span></label>
									<input type="text" class="form-control"
										placeholder="Mobile Number" maxlength="10" id="mobId"
										autocomplete="off" oninput="onlyNumbers(this)" name="contact">
								</div>
							</div>
							<div class="col-md-3 hidden" id="emailDivId">
								<div class="form-group mb-3">
									<label for="exampleInputEmail1" class="form-label" id="emailId">Email
										address :<span class="red">*</span>
									</label> <input type="email" class="form-control"
										id="exampleInputEmail1" placeholder="Email address"
										aria-describedby="emailHelp" name="email">
								</div>
							</div>
							<div class="col-md-2 ">
								<button type="button" id="getOTP" value="MOB" title=""
									style="line-height: 19px; margin-top: 20px"
									class="btn btn-lg btn-success">Get OTP</button>
							</div>
							<div class="col-md-4 hidden" id="otp">
								<div class="form-group mb-3">
									<label class="form-label"> OTP :<span class="red">*</span></label>
									<div class="test d-flex align-items-center gap-2">
										<input class="otp-field" type="text" name="opt-field[]"
											maxlength=1> <input class="otp-field" type="text"
											name="opt-field[]" maxlength=1> <input
											class="otp-field" type="text" name="opt-field[]" maxlength=1>
										<input class="otp-field" type="text" name="opt-field[]"
											maxlength=1> <input class="otp-field" type="text"
											name="opt-field[]" maxlength=1> <input
											class="otp-field" type="text" name="opt-field[]" maxlength=1>
									</div>
								</div>
								<!--  <div class="col-md-2 " >
	                          <button type="button" id="getVerifyOTP" onclick="collectOtpAndVerify()" value="MOB" title="" style="line-height: 19px; margin-top: 20px" class="btn btn-lg btn-success">Verify</button>
	                          </div> -->
							</div>

							<div class="col-md-12 text-center mt-3">
								<button type="button" class="btn btn-back"
									onclick="displayStep(1)">Previous</button>
								<button type="button" class="btn btn-primary" id="nextBnt"
									onclick="validateTab('TAB2')">Next</button>
							</div>
						</div>
					</div>

					<!-- Step 3 form fields here -->
					<div class="step step-3" style="display: none;">
						<div class="d-flex align-items-center justify-content-center mb-4">
							<!-- <div>
	                          <img src="assets/images/Security-Information-icon.png" alt="" style="height: 36px; margin-right: 10px" />
	                        </div> -->
							<div>
								<h3 class="instruction-heading mb-1 text-center"
									style="font-size: 18px; color: #01267F;">Create Your
									Password</h3>
								<p class="span-text">(Password should be a combination of
									capital letters, small letters, special characters, and
									numbers)</p>
							</div>
						</div>

						<div class="row">
							<div class="col-md-3">
								<div class="form-group mb-3">
									<label class="required">New Password: </label>
									<div class="col-md-12">
										<input type="password" class="form-control" name="password"
											id="txtPass" maxlength="15"
											onchange="ensureStrongPassword(this);" required="required">
									</div>
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group mb-3">
									<label class="required">Confirm Password: </label>
									<div class="col-md-12">
										<input type="password" class="form-control" name="txtRePass"
											id="txtRePass" maxlength="15" onblur="clearData();">
										<span id="consms" style="font-size: 14px; font-style: italic;"></span>
									</div>
								</div>
							</div>

							<!-- <div class="col-md-6">
	                          <div class="form-group mb-3">
	                            <label class="form-label">Enter Captcha Code <span class="red">*</span></label>
	                            <div class="row">
	                              <div class="col-md-6">
	                                <div class="captcha">
	                                  <img src="assets/images/download.png" alt="">
	                                  <div class="captcha-icon px-3">
	                                    <i class="fa-solid fa-arrows-rotate"></i>
	                                  </div>
	                                </div>
	                              </div>
	            
	                              <div class="col-md-6">
	                                <div class="captcha-cancel position-relative">
	                                  <input type="text" class="form-control" placeholder="Captcha">
	                                  <div class="captcha-cancel-icon px-3">
	                                    <i class="fa-solid fa-xmark"></i>
	                                  </div>
	                                </div>
	                              </div>
	                            </div>
	                          </div>
	                        </div> -->
							<div class="row">
								<div class="col-md-12" style="margin-top: 10px;">
									<div class="alert alert-info" id="lblPass"
										style="text-align: left;">
										Password must be between 8 - 15 characters <br /> - Must have
										one lower case alphabet. <br /> - Must have one upper case
										alphabet. <br /> - Must have one number. <br /> - Must have
										one special sign (@/*/#)
									</div>
								</div>
							</div>
							<div class="col-md-12 text-center mt-3">
								<button type="button" class="btn btn-back"
									onclick="displayStep(2)">Previous</button>
								<button type="button" class="btn btn-success"
									onclick="validateTab('TAB3')">Save and continue</button>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>




<script
	src="${pageContext.request.contextPath}/assets/applicationSpecific/encrypt/AesUtil.js"></script>
<script
	src="${pageContext.request.contextPath}/assets/applicationSpecific/encrypt/aes.js"></script>
<script
	src="${pageContext.request.contextPath}/assets/applicationSpecific/encrypt/pbkdf2.js"></script>
<script
	src="${pageContext.request.contextPath}/assets/applicationSpecific/encrypt/lbase.js"></script>
<script src="${contextPath}/assets/appJs/validation/commonMaster.js"></script>


<script>
 
 function collectOtpAndVerify() {
	  // Collect all OTP field values
	  let otp = '';
	  document.querySelectorAll('.otp-field').forEach(input => {
	    otp += input.value;
	  });

	  // Check if OTP is complete (6 digits)
	  if (otp.length < 6) {
	    alert("Please enter all 6 digits of the OTP.");
	    return;
	  }

	  // Call verifyOtp() with the OTP value
	  verifyOtp(otp);
	}
 
 
 
 
 
 
 
 
          var currentStep = 1;
          function displayStep(stepNumber) {
            if (stepNumber >= 1 && stepNumber <= 3) {
              $(".step").hide();
              $(".step-" + stepNumber).show();
              currentStep = stepNumber;
              updateProgressBar();
              updateStepCircle();
            }
          }

          function updateProgressBar() {
            var progressPercentage = ((currentStep - 1) / 2) * 100;
            $(".progress-bar").css("width", progressPercentage + "%");


            $(".progress-bar").css("background-color", "#002C56");
          }

          function updateStepCircle() {

            $(".step-circle").css("background-color", "#ddd");
            $(".step-circle").css("color", "black");

            $(".step-circle").each(function (index) {
              if (index < currentStep) {
                $(this).css("background-color", "#002C56");
                $(this).css("color", "white");
              } else {
                $(this).css("background-color", "#ddd");
                $(this).css("color", "black");
              }
            });
          }

          $(document).ready(function () {

            $(".step").hide();
            $(".step-1").show();


            // $(".step-circle").click(function () {
            //   var stepNumber = $(this).text();
            //   displayStep(parseInt(stepNumber));
            // });
          });

          
          function validateTab(tabNo) {
            if (tabNo == 'TAB1') {
              var fstNm = $("#fstNmId").val();
              var lstNm = $("#lstNmId").val();
              var dob = $("#dobId").val();
              var gen = $("#genderId").val();
             /*  var fathNm = $("#fathNmId").val();
              var mothNm = $("#mothNmId").val(); */
              if (fstNm == "") {
                bootbox.alert("Please enter First Name");
                return false;
              }
              else if (lstNm == "") {
                bootbox.alert("Please enter Last Name");
                return false;
              }
              else  if (dob == "") {
                bootbox.alert("Please enter Date of Birth");
                return false;
              }
              else if (!/^\d{2}\/\d{2}\/\d{4}$/.test(dob)) {
                bootbox.alert("Please enter valid Date of Birth");
                return false;
              }
              else if (gen == 0) {
                bootbox.alert("Please select gender");
              }
              else {
                displayStep(2);
              }
            }
            else if (tabNo == 'TAB2') {
             var email = $("#exampleInputEmail1").val();
              var mob = $("#mobId").val(); 
                if(mob == "") {
                  bootbox.alert("Please enter Mobile Number");
                  return false;
                }
                else if (email == "") {
                  bootbox.alert("Please enter Email");
                  return false;
                }
                else {
            	//$("#nextBnt").prop("disabled", false);
                displayStep(3);
               } 
            }else if(tabNo == 'TAB3'){
              var pass = $("#txtPass").val();
              var cpass = $("#txtRePass").val();
              if (pass == "") {
                bootbox.alert("Please enter Password");
                return false;
              }
              else if (cpass == "") {
                bootbox.alert("Please enter Confirm Password");
                return false;
              }else if(pass != cpass){
                bootbox.alert("Password and Confirm Password should be same");
                return false;
              }
              else {
                $("#registrationFrmId").submit();
              }
            }
          }

          function onlyNumbers(input) {
              // Ensure only numbers are entered
              input.value = input.value.replace(/[^0-9]/g, '');
          }

        </script>
<script>
$(document).ready(function () {
	$(".otp-field *:input[type!=hidden]:first").focus();
	let otp_fields = $(".otp-field"),
		otp_value_field = $("#textPassword");
	otp_fields
		.on("input", function (e) {
			$(this).val(
				$(this)
					.val()
					.replace(/[^0-9]/g, "")
			);
			let opt_value = "";
			otp_fields.each(function () {
				let field_value = $(this).val();
				if (field_value != "") opt_value += field_value;
			});
			//alert("val::"+opt_value);
			otp_value_field.val(opt_value);
			
			if (opt_value.length == 6) {
				  verifyOtp(opt_value);
			  }
		})
		.on("keyup", function (e) {
			let key = e.keyCode || e.charCode;
			if (key == 8 || key == 46 || key == 37 || key == 40) {
				// Backspace or Delete or Left Arrow or Down Arrow
				$(this).prev().focus();
			} else if (key == 38 || key == 39 || $(this).val() != "") {
				// Right Arrow or Top Arrow or Value not empty
				$(this).next().focus();
			}
		})
		.on("paste", function (e) {
			let paste_data = e.originalEvent.clipboardData.getData("text");
			let paste_data_splitted = paste_data.split("");
			$.each(paste_data_splitted, function (index, value) {
				otp_fields.eq(index).val(value);
			});
		});
});


$("#getOTP").click(function(){
    var mobileNo = "";
    var emailId = "";

    if (this.value == 'MOB') {
        if ($("#mobId").val() == "") {
            bootbox.alert("Please enter mobile No");
            return false;
        }
        mobileNo = $("#mobId").val(); 
    }
    if (this.value == 'EMAILID') {
        if ($("#exampleInputEmail1").val() == "") {
            bootbox.alert("Please enter email Id");
            return false;
        }
        emailId = $("#exampleInputEmail1").val();
    }

    if (mobileNo != "" || emailId != "") {
        $('#getOTP').prop('disabled', true);
        $.ajax({
            type: "GET",
            url: "${contextPath}/public/getOtp",
            data: {
                "mobileNo": mobileNo,
                "emailId": emailId,
            }, 
            success: function(response) {
                if (response.outcome) {
                    $("#loginType").val("OTP");
                    $("#otp").removeClass("hidden");

                    // Show success message with tick mark 
                    var dialog = bootbox.dialog({
                        message: '<i class="fa fa-check-circle" style="color: green; font-size: 24px;"></i> <b>OTP Sent Successfully!</b>',
                        closeButton: true
                    });

                    // Automatically close after 15 seconds
                    setTimeout(function() {
                        dialog.modal('hide');
                    }, 4000);

                    // Show timer
                    updateTimer();
                    sessionStorage.setItem("OTPSENT", "userName");
                    $(".otp-field").val("");
                } else {
                    showMessage(response.message);
                    $('#getOTP').prop('disabled', false);
                }
            },

            error: function(error) {
                bootbox.alert("Failed to send OTP. Please try again.");
                $('#getOTP').prop('disabled', false);
            }
        });
    } else {
        showMessage("Please enter user name");
        return false;
    }
});  

/*  $("#getOTP").click(function () {
    var mobileNo = "";
    var emailId = "";

    // Determine input type
    var inputType = $(this).val(); // e.g., "MOB" or "EMAILID"

    if (inputType === "MOB") {
        mobileNo = $("#mobId").val().trim();
        if (mobileNo === "") {
            bootbox.alert("Please enter mobile No");
            return false;
        }
    } else if (inputType === "EMAILID") {
        emailId = $("#exampleInputEmail1").val().trim();
        if (emailId === "") {
            bootbox.alert("Please enter email Id");
            return false;
        }
    } else {
        bootbox.alert("Please enter user name");
        return false;
    }

    // CSRF and Nonce setup
    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");
    var nonce = generateNonce();

    // Prepare and encrypt data
    var paramsData = {
        mobileNo: mobileNo,
        emailId: emailId,
        nonce: nonce
    };

    var encryptedData = enc_password(JSON.stringify(paramsData));

    $('#getOTP').prop('disabled', true);

    $.ajax({
        type: "POST",
       //url: window.contextPath + "/public/getOtp",
    url: window.contextPath + "/generateOtp.htm",

        data: {
            cipherText: encryptedData
        },
        beforeSend: function (xhr) {
            xhr.setRequestHeader(header, token);
        },
        success: function (response) {
            var data = response[0]; 
            if (data.outcome === true || data.outcome === "success") {
                $("#loginType").val("OTP");
                $("#otp").removeClass("hidden");

                var dialog = bootbox.dialog({
                    message: '<i class="fa fa-check-circle" style="color: green; font-size: 24px;"></i> <b>OTP Sent Successfully!</b>',
                    closeButton: true
                });

                setTimeout(function () {
                    dialog.modal('hide');
                }, 4000);

                updateTimer();
                sessionStorage.setItem("OTPSENT", "userName");
                $(".otp-field").val("");
            } else {
                bootbox.alert("Failed to send OTP: " + data.message);
                $('#getOTP').prop('disabled', false);
            }
        },
        error: function (xhr, status, error) {
            console.error("Error during AJAX request:", error);
            bootbox.alert("Error: " + xhr.responseText);
            $('#getOTP').prop('disabled', false);
        }
    });
});
  */
// Generate secure nonce
function generateNonce() {
    return (new Date().getTime() + Math.floor(Math.random() * 1000)).toString(36);
}



function showMessage(message){
	$("#messageDiv").empty().append('<div class="alert alert-warning alert-dismissible fade show" role="alert">'+message+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
}

var fadeOutTime = 120000;
var currentTime = fadeOutTime / 1000; 
var timerId; 

function updateTimer() {
  $("#getOTP").text(currentTime);
  currentTime--;
  if (currentTime <= 0) {
	  $("#getOTP").text("Re-Send OTP");
	  $('#getOTP').prop('disabled', false);
    //clean up otp field
    $(".otp-field").val("");

	  // resetOTP();
  } else {
	  timerId = setTimeout(updateTimer, 1000); 
  }
}

// $( document ).ready(function() {
// 	resetOTP();
// });
	
	function resetOTP(){
		const userName = sessionStorage.getItem("OTPSENT");
		if(userName != null){
			$.ajax({
				type : "GET",
				url : "${contextPath}/public/resetOTP",
				data : {
					"userName" : userName,
				}, 
				success : function(response) {
					if(response!='ERROR'){
						sessionStorage.removeItem("OTPSENT");	
					}
				}, 
				error : function(error) {
					bootbox.alert("Failure"); 
				}
			});
		}
		
	}
	
	async function verifyOtp(otp) {
		
    if (otp.length !== 6 || !/^\d+$/.test(otp)) {
        bootbox.alert("Please enter a valid 6-digit OTP.");
        return;
    }

    try {
        const response = await fetch(`${contextPath}/public/verify-otp`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                "X-OTP": otp, 
            },
        });

        const data = await response.json(); // Parse JSON response

        if (response.ok && data.success) {
            $("#otp").addClass("hidden");

            if ($("#getOTP").val() === 'MOB') {
                $("#getOTP").val('EMAILID');
                clearTimeout(timerId);
                $("#getOTP").empty().append('Get OTP');
                $("#emailDivId").removeClass("hidden");
                $('#getOTP').prop('disabled', false);

            } else if ($("#getOTP").val() === 'EMAILID') {
                clearTimeout(timerId);
                $("#getOTP").val('SHOWTAB3');
                 $('#nextBnt').prop('disabled', false);
                $("#getOTP").empty().append('<i class="fa-solid fa-check" style="margin-left: 5px; color: green;"></i>'); 
            }

            // Show success message with tick mark 
        /*     bootbox.dialog({
                message: '<i class="fa fa-check-circle" style="color: green; font-size: 24px;"></i> <b>OTP Verified Successfully!</b>',
                closeButton: true
            }); */
            var dialog = bootbox.dialog({
                message: '<i class="fa fa-check-circle" style="color: green; font-size: 24px;"></i> <b>OTP Verified Successfully!</b>',
                closeButton: true
            });
            //reset timer
            setTimeout(function() {
                dialog.modal('hide');
               if( $("#getOTP").val() === 'SHOWTAB3'){
            	   showStep3();
               }
            }, 2000);

        } else {
            bootbox.alert(data.message || "Invalid OTP. Please try again.");
            $("#otp").val(""); 
            
        }
    } catch (error) {
        console.error("Error:", error);
        bootbox.alert("Something went wrong. Please try again.");
    }
}

	
	function showStep3() {
	    // Hide previous step (Step 2)
	    $("#nextBnt").prop("disabled", false);
	    document.querySelector('.step.step-2').style.display = 'none';
	    // Show Step 3
	    document.querySelector('.step.step-3').style.display = 'block';
	    displayStep(3);
	}
	
	
</script>
<script>
	var count = 0;
	$("#txtRePass").keyup(function() {
		var pass = $("#txtPass").val();
		var rePass = $("#txtRePass").val();
		if ((rePass == null || rePass == "")) {
			$("#consms").text(" ");
			$("#consms").css("color", "black");
		} else {
			if (pass == rePass) {
				$("#consms").text(" ");
				$("#consms").css("color", "green");
				count = 1;
			} else {
				$("#consms").text("Password not match..!!!");
				$("#consms").css("color", "red");
				count = 0;
			}
		}
	});

	$('#txtPass').keyup(function() {
		var pass = ensureStrongPassword(this);
		/* 	console.log (pass); */
		if (pass !== true) {
			$('#lblPass').removeClass('alert-info');
			$('#lblPass').addClass('alert-danger');
		} else {
			$('#lblPass').removeClass('alert-danger');
			$('#lblPass').addClass('alert-info');
		}
	});

	function clearData() {
		if (count == 0) {
			$("#txtRePass").val("");
		}
	}
	function ensureStrongPassword(element) {
		var re = /^([a-zA-Z0-9@*#]{8,15})$/;
		var sc = /[-!$%^&*()_+|~=`{}[:;<>?,.@#\]]/g;
		var letters = element.value;
		var uperCaseFlag = false;
		var lowerCaseFlag = false;
		var numberFlag = false;
		var spCharFlag = false;
		var lengthFlag = false;

		for (var i = 0; i < letters.length; i++) {
			if (letters[i] === letters[i].toUpperCase()) {
				uperCaseFlag = true;
			}
			if (letters[i] === letters[i].toLowerCase()) {
				lowerCaseFlag = true;
			}
			var matches = letters[i].match(/\d+/g);
			if (matches != null) {
				numberFlag = true;
			}
			if (letters[i].match(sc)) {
				spCharFlag = true;
			}
			if (letters.match(re)) {
				lengthFlag = true;
			}
		}
		if (uperCaseFlag == true && lowerCaseFlag == true && numberFlag == true
				&& spCharFlag == true && lengthFlag == true) {
			return true;
		} else {
			return false;
		}
	}

	function validateSubmit() {
		let txtP = $('#txtPass').val();
		var currPass= $("#currPass").val();
		if(currPass == ""){
			bootbox.alert('Please Enter your current password');
			return false;
		}	
		if (txtP != '') {
			let txtRP = $("#txtRePass").val();
			if (txtP !== txtRP) {
				bootbox.alert('Passwords do not match');
				return false;
			}
			var elem = document.getElementById('txtPass');
			var ok = ensureStrongPassword(elem);
			if (!ok) {
				bootbox.alert('Password does not match Password Criteria.');
				return false;
			}
			return ok;
		}
	}



  function submitUserForm() { 
  	var username = $("#username").val();
  	var password = $("#textPassword").val();
  	var generateCaptcha=$("#captcha").val();
  	if (username == "") {
  		bootbox.alert("Username Can't Be Empty");
  		return false;
  	}
  	if (password == "") {
  		bootbox.alert("Password Can't Be Empty");
  		return false;
  	}
  	if (generateCaptcha == "") {
	    bootbox.alert("Please enter the CAPTCHA"); 
	    return false;
	}
  	/* var inputCaptcha=$("#txtCaptcha").val();
	    if (inputCaptcha != "") {
		    if(inputCaptcha.localeCompare(generateCaptcha)) {
		    	bootbox.alert("Captcha Did Not Match");
				$("#txtCaptcha").val(""); 
				refreshCaptcha(); 
				return false;
			}
	    }
	    else {
	    	event.preventDefault(); 
	    	bootbox.alert("Please Complete The reCAPTCHA Step");  
	    	return false; 
	    } */
	    /* if (inputCaptcha != "") {
  		$('#txtCaptcha').val(enc_inputCaptcha(inputCaptcha)); 
	    	$('#Captcha').val(enc_generatedCaptcha(generateCaptcha)); 
  	} */
  	
	  	if(username != "") {
	  		//$('#textUserName').val(enc_password(username)); 
	  		$('#textUserName').val(username); 
	  	}
	    if(password != "") {
  		     $('#password').val(enc_password(password)); 
  		return true;
  	}  
  };  


  function validateDateOfBirth() {
      var dob = $("#dobId").val();

      if (!dob) {
          alert("Please enter a valid date of birth.");
          return;
      }

      // Split the input date string into day, month, and year
      var parts = dob.split('/');
      if (parts.length !== 3) {
          alert("Invalid date format. Please use dd/mm/yyyy.");
          return;
      }

      var day = parseInt(parts[0], 10);
      var month = parseInt(parts[1], 10) - 1; // Months are zero-based in JavaScript's Date object
      var year = parseInt(parts[2], 10);

      // Create a Date object from the parsed values
      var dobDate = new Date(year, month, day);

      // Check if the constructed date is valid
      if (dobDate.getFullYear() !== year || dobDate.getMonth() !== month || dobDate.getDate() !== day) {
          bootbox.alert("Invalid date. Please enter a valid date of birth.");
          return;
      }

      var today = new Date();
      var age = today.getFullYear() - dobDate.getFullYear();
      var monthDifference = today.getMonth() - dobDate.getMonth();
      var dayDifference = today.getDate() - dobDate.getDate();

      // Adjust age if the birthday hasn't occurred yet this year
      if (monthDifference < 0 || (monthDifference === 0 && dayDifference < 0)) {
          age--;
      }

      if (age < 18) {
          bootbox.alert("You must be at least 18 years old to register.");
          $("#dobId").val(""); // Clear the input field
      }else if (age > 60) {
          bootbox.alert("You must be below 60 years old to register.");
          $("#dobId").val(""); // Clear the input field
      }
  }


$(function () {
    $('.datepicker').datepick({
        onShow: $.datepick.monthOnly,
        dateFormat: 'dd/mm/yyyy',
        yearRange: 'c-100:c+5',
        showOnFocus: true,
        minDate: null, // No restriction on past dates
        maxDate: 0, // Restrict to today or earlier
        showTrigger: '<button type="button" class="trigger">' +
            '<i class="fa fa-calendar"></i></button>',
        onSelect: function(dateText) {
            // Call your function here
            validateDateOfBirth();
        }
    });
});

//Restrict Copy paste in entire form
$(document).ready(function () {
    $('form').bind("cut copy paste", function (e) {
        e.preventDefault();
    });
});

// function getLoginModal() {
//     window.location.href = "${contextPath}/home";
// 	$('#exampleModal').modal('show');
	
// }

$(document).ready(function () {
document.querySelectorAll('.otp-field').forEach((input, index, inputs) => {

  // Stop paste, copy, cut, right-click
  input.addEventListener('paste', e => e.preventDefault());
  input.addEventListener('copy', e => e.preventDefault());
  input.addEventListener('cut', e => e.preventDefault());
  input.addEventListener('contextmenu', e => e.preventDefault());

  // Allow only numbers
  input.addEventListener('input', e => {
    const value = e.target.value.replace(/[^0-9]/g, ''); // digits only
    e.target.value = value;
    if (value && index < inputs.length - 1) {
      inputs[index + 1].focus();
    }
  });

  // Move to previous field on backspace
  input.addEventListener('keydown', e => {
    if (e.key === 'Backspace' && !input.value && index > 0) {
      inputs[index - 1].focus();
    }
  });
});
});
</script>
