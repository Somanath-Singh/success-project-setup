/** @ Subhadarsini
 *  Category and Department wise Vacancy chart
 *  Dt- 10/06/2025
 */
 class categoryWiseVacancyChart{
	constructor(apiPath, contextPath)
	{
		this.apiPath =  apiPath;
		this.worker = null;
		this.contextPath = contextPath;
		this.data = null;
		this.context = "STATE";
		this.chart=null;
	}
	doFetch() {
    		if (this.worker == null )
		{
			this.worker = new Worker(this.contextPath + '/assets/appJs/CommonWorker.js');
			this.worker.addEventListener('message', (e) => this.processData(e));
		}

		var filterSubVal = $("#subjectId1").val();
		let url = this.contextPath + this.apiPath + "categoryWise-Vacancy-ChartData" ;
		url = url + "?chartCall=STAFF_CTG_WISE&subjectId="+filterSubVal;
		
		window.loadCounter++;
		this.worker.postMessage({
			"method" : "GET" ,
			"url" : url ,
			"payload" : null,
			//subject: filterVal
		});

	}
	 processData(e) {
    if (e.data != null) {
        this.data = e.data;
		var count=0;
        let tchUrData = [];
        let tchUrWomanData = [];
        let tchScData = [];
        let tchscWomanData = [];
        let tchStData = [];
        let tchStWomanData = [];
        let tchSebcData = [];
        let tchSebcWomanData = [];
        let tchPwdData = [];
        let ntchUrData = [];
        let ntchUrWomanData = [];
        let  ntchScData = [];
        let  ntchScWomanData = [];
        let  ntchStData = [];
        let  ntchStWomanData = [];
        let  ntchSebcData = [];
        let  ntchSebcWomanData = [];
        let  ntchpwdData = [];
        let categories = [];
		this.data.data.forEach((item) => {
				categories.push(item.stfCategory??0);
                tchUrData.push(item.total_ur??0 ); 
                tchUrWomanData.push(item.total_urWoman??0 ); 
                tchScData.push(item.total_sc??0 ); 
                tchscWomanData.push(item.total_scWoman??0 ); 
                tchStData.push(item.total_st??0 ); 
                tchStWomanData.push(item.total_stWoman??0 ); 
                tchSebcData.push(item.total_sebc??0 ); 
                tchSebcWomanData.push(item.total_sebcWoman??0 ); 
                tchPwdData.push(item.total_pwd??0 ); 
                ntchUrData.push(item.non_teaching_ur ??0); 
                ntchUrWomanData.push(item.non_teaching_urWoman ??0); 
                ntchScData.push(item.non_teaching_sc ??0); 
                ntchScWomanData.push(item.non_teaching_scWoman ??0); 
                ntchStData.push(item.non_teaching_st ??0); 
                ntchStWomanData.push(item.non_teaching_stWoman ??0); 
                ntchSebcData.push(item.non_teaching_sebc ??0); 
                ntchSebcWomanData.push(item.non_teaching_sebcWoman ??0); 
                ntchpwdData.push(item.non_teaching_pwd ??0); 
                count++;
            });
            
	if(count==0){
		categories.push($("#categoryId option:selected").text());
		tchUrData.push(0);
		tchUrWomanData.push(0);
		tchScData.push(0);
		ntchScWomanData.push(0);
		tchStData.push(0);
		tchStWomanData.push(0);
		tchSebcData.push(0);
		tchSebcWomanData.push(0);
		tchPwdData.push(0);
		ntchUrData.push(0);
		ntchUrWomanData.push(0);
		ntchScData.push(0);
		ntchScWomanData.push(0);
		ntchStData.push(0);
		ntchStWomanData.push(0);
		ntchSebcData.push(0);
		ntchSebcWomanData.push(0);
		ntchpwdData.push(0);
	
		}
 
            
        var options = {
            series: [
                 { name: 'Teaching UR', data: tchUrData },
                 { name: 'Teaching UR Woman', data: tchUrWomanData },
                 { name: 'Teaching SC ', data: tchScData },
                 { name: 'Teaching SC Woman', data: tchscWomanData },
                 { name: 'Teaching ST ', data: tchStData },
                 { name: 'Teaching ST Woman', data: tchStWomanData },
                 { name: 'Teaching SEBC ', data: tchSebcData },
                 { name: 'Teaching SEBC Woman', data: tchSebcWomanData },
                 { name: 'Teaching PWD', data: tchPwdData },
                 { name: 'Non Teaching UR ', data: ntchUrData },
                 { name: 'Non Teaching UR Woman', data: ntchUrWomanData },
                 { name: 'Non Teaching SC', data: ntchScData },
                 { name: 'Non Teaching SC Woman ', data: ntchScWomanData },
                 { name: 'Non Teaching ST', data: ntchStData },
                 { name: 'Non Teaching ST Woman ', data: ntchStWomanData },
                 { name: 'Non Teaching SEBC', data: ntchSebcData },
                 { name: 'Non Teaching SEBC Woman', data: ntchSebcWomanData },
                 { name: 'Non Teaching PWD', data: ntchpwdData }
              
            ],
            chart: {
                type: 'bar',
                height: 180
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '50%',
                    endingShape: 'rounded'
                    
                   
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 3,
                colors: ['transparent']
            },
            xaxis: {
                categories: categories, 
            },
        yaxis: {
	        title: {
	           
	        },
	        min: 0, 
	        max: 20, 
	        tickAmount: 5, 
	        labels: {
	            formatter: function (value) {
	                return value; 
	            }
	        }
	    },
            fill: {
                opacity: 1
            },
            colors: ['#FFAE1A', '#FE6A49', '#cc0000', '#0099cc', '#ff3300', '#56C3C3', '#006666c2','#A52A2A'],
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val ;
                    }
                }
            }
        };

//
//        if (this.chart) {
//            this.chart.destroy();
//        }
      if (this.chart) {
            this.chart.destroy();
        }    
	        this.chart = new ApexCharts(document.querySelector("#categoryWiseId"), options);
	        this.chart.render();
		}
  		else{
		 document.querySelector("#categoryWiseId").innerHTML = "<p>No data available for the selected subject.</p>";
		 }
	 }
}