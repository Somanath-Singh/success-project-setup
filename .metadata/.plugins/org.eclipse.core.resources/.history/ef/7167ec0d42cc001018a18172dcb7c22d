class postWisePiechart{
	constructor(apiPath, contextPath)
	{
		this.apiPath =  apiPath;
		this.worker = null;
		this.contextPath = contextPath;
		this.data = null;
		this.context = "STATE";
		this.chart=null;
	}

	doFetch() {
    		if (this.worker == null )
		{
			this.worker = new Worker(this.contextPath + '/assets/appJs/CommonWorker.js');
			this.worker.addEventListener('message', (e) => this.processData(e));
		}
		
		var filterVal = $("#roleId").val();
		let url = this.contextPath + this.apiPath + "postWisePieChartData" ;
		url = url + "?chartCall=POST_WISE_PIE_DATA&designation="+filterVal;

		window.loadCounter++;
		this.worker.postMessage({
			"method" : "GET" ,
			"url" : url ,
			"payload" : null,
		});

	}


processData(e) {
    if (e.data != null) {
        this.data = e.data;

        let applied = 0;
        let published = 0;
        let vacancy = 0;

        this.data.data.forEach((item) => {
            console.log("Processing item:", item); 
            applied += item.total_applied || 0;     
            published += item.total_published || 0; 
            vacancy += item.total_vacancies || 0;  
        });

        if (applied === 0 && published === 0 && vacancy === 0) {
            applied = published = vacancy = 0;  
        }

        var options = {
            series: [applied, published, vacancy],  
            chart: {
                type: 'pie',  
                width: 300
            },
              labels: ['Applied', 'Result Published', 'Total Vacancy'],
            dataLabels: {
                enabled: true,  
            },
            legend: {
                position: 'right', 
            },
            colors: ['#e67e22', '#006666c2', '#56C3C3'], 
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val;  
                    }
                }
            }
        };

       this.destroyChartById('difficulty');

        this.chart = new ApexCharts(document.querySelector("#difficulty"), options);
        this.chart.render();
    	}
    	else {
        // If no data is found, clear the chart and handle empty state
        if (this.chart) {
            this.chart.destroy(); // Destroy the previous chart instance
        }

        // Optionally, display a message to indicate that no data is available
        const emptyMessage = document.querySelector("#difficulty");
        emptyMessage.innerHTML = "<p>No data available for the selected subject.</p>";
    }
	}
	

	destroyChartById(elementId) {
	  const chartElement = document.querySelector(`#${elementId}`);
	  if (chartElement && chartElement.children.length > 0) {
	    while (chartElement.firstChild) {
	      chartElement.removeChild(chartElement.firstChild);
	    }
	  }
	}
}