<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>

<c:set var="contextPath" value="${pageContext.request.contextPath}" />

<!-- NOTE: CSS & JS should be in <head> or Tiles <put-attribute name="js"> -->
<!-- Remove <link> and <script> from here â€” move to Tiles layout or header -->

<!-- Breadcrumb -->
<%-- <div class="breadcrumb_conatiner">
    <div class="col-md-6">
        <h4 class="change-color">Add Fund Distribution </h4>
    </div>
    <div class="col-md-6">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="${contextPath}/home"><i class="fa fa-home"></i> Home</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Add Fund Distribution</li>
            </ol>
        </nav>
    </div>
</div> --%>

<%@ include file="/WEB-INF/views/BAMS/filter-building-page/building-common-filter.jsp"%>


<div class="card mt-3">
  <div class="card-header">
    <h5 class="card-title">Fund Distribution Report Details</h5>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered table-striped exportbtn" id="reportTable">
        <thead class="table-light">
          <tr>
           <th class="text-center" style="width: 60px;">Sl No.</th>
           <th>Building Name</th>
           <th>Building Type</th>
           <th>Last Updated Date</th>
           <th>Current Status</th>
           <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <c:choose>
            <c:when test="${not empty buildingFilterData.reportDataList}">
              <c:forEach items="${buildingFilterData.reportDataList}" var="item" varStatus="loop">
                <tr>
                  <td class="text-center">${loop.index + 1}</td>
                  <td>${item.planningDTO.buildingName}</td>
	              <td>${item.planningDTO.buildingType}</td>
	              <td>
                    <c:choose>
                        <c:when test="${not empty item.buildingDTO.lastUpdatedOn}">
                           <fmt:parseDate value="${item.buildingDTO.lastUpdatedOn}" 
               pattern="yyyy-MM-dd HH:mm:ss.SSS" 
               var="parsedDate" />

				<fmt:formatDate value="${parsedDate}" pattern="yyyy-MM-dd" />

                        </c:when>
                        <c:otherwise>N/A</c:otherwise>
                    </c:choose>
                 </td>
	             <td>
	             	<c:choose>
                        <c:when test="${not empty item.buildingDTO.currentStatus}">
                            ${item.buildingDTO.currentStatus}
                        </c:when>
                        <c:otherwise>N/A</c:otherwise>
                    </c:choose>
                  <td>
                    <button 
					  id="editBuildingBtn" class="btnnew btn btn-primary" title="Edit" type="button"
					  onclick="editBuildingDetails(${item.buildingDTO.buildingId})" data-bs-toggle="modal" data-bs-target="#editModal"><i class="fa fa-plus"></i></button>
                </td>
                </tr>
              </c:forEach>
            </c:when>
            <c:otherwise>
              <tr><td colspan="7" class="text-center text-muted">No records found for the selected criteria.</td></tr>
            </c:otherwise>
          </c:choose>
        </tbody>
      </table>
    </div>
  </div>
</div>

<form action="${contextPath}/fund/edit-distribution" method="Post" id="buildingIdForm">
 <input type="hidden" id="buildingCipherText" name="cipherText">
 <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
 <input type="hidden" name="buildngIdd" id="buildingId" />
</form>

<script>

$( document ).ready(function() {
    $('.datepicker_con>input').datepick({
      dateFormat: 'dd/mm/yyyy', 
          showOnFocus: true,
      showTrigger: '<button type="button" class="trigger">' +
      '<i class="fa fa-calendar"></i></button>',
  });
    
});
  
  
  function LoadBuildingCodeByBuildingType(buildingType) {
	  debugger;
	    $.ajax({
	        type: "GET",
	        url:"${contextPath}/get-building-loc-code",
	        data: { buildingType: buildingType },
	        success: function (response) {
	            let buildingDropdown = $("#buildingCodeDropdown");
	            let locationDropdown = $("#locationCodeDropdown");

	            buildingDropdown.empty().append('<option value="" disabled selected>--Select--</option>');
	            locationDropdown.empty().append('<option value="" disabled selected>--Select--</option>');

	            $.each(response, function (i, item) {
	                buildingDropdown.append('<option value="' + item.buildingCode + '">' + item.buildingCode + '</option>');
	                locationDropdown.append('<option value="' + item.locationCode + '">' + item.locationCode + '</option>');
	            });
	        },
	        error: function (xhr, status, error) {
	            console.error("Error fetching building/location codes:", error);
	        }
	    });
	}
  
  
  function editBuildingDetails(buildingId) {
	  $("#buildingId").val(buildingId);
	  var bizContent = $("#buildingIdForm").serializeArray();
	  $("#buildingCipherText").val(enc_password(JSON.stringify(convertFormToJSONArray(bizContent))));
	  bootbox.confirm("Do you want to continue ?",function(result){
		  if(result){
			  showLoader();
			  $("#buildingIdForm").submit();
		  }
	  })
}

  </script>

