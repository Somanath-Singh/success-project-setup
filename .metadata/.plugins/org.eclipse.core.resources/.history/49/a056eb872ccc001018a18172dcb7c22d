<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix = "fn" uri = "http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib uri = "http://java.sun.com/jsp/jstl/functions" prefix = "fn" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />

<script src="${contextPath}/assets/applicationSpecific/encrypt/aes.js"></script>
<script src="${contextPath}/assets/applicationSpecific/encrypt/AesUtil.js"></script>
<script src="${contextPath}/assets/applicationSpecific/encrypt/lbase.js"></script>
<script src="${contextPath}/assets/applicationSpecific/encrypt/pbkdf2.js"></script>
<script src="${contextPath}/assets/vendor/bootbox5/bootbox.min.js"></script>
<script src="${contextPath}/assets/appJs/validation/common-utils.js"></script>
<script src="${contextPath}/assets/appJs/validation/commonMaster.js"></script>


<style>
.card {
    color: #000;
    background: #ffffffb8;
    border-radius: 20px;
    padding: 10px 30px;
    box-shadow: 2px 2px 0px 1px #ad4a20, 0px 2px 5px 0px #0000008c;
}
.card .card-header {
    position: relative;
    background: transparent;
    padding-left: 6px;
    border-bottom: none !important;
}
.card .card-body {
    padding: 5px 10px;
}
.section-names-style-1 {
    font-size: 1.6rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 0px;
}
td .btn.btn-success{
	background: #00483e;
    border: none;
    color: #ffffff;
    border-radius: 5px !important;
    border-bottom: 3px solid #00241f !important;
    border-right: 3px solid #00241f !important;
    padding: 5px 8px !important;
    font-size: 14px !important;
    line-height: 10px !important;
}
td .btn.btn-danger {
    background: #cf1414;
    border-right: 3px solid #750404;
    border-bottom: 3px solid #750404 !important;
    border-radius: 5px !important;
    line-height: 10px !important;
}
.bootbox-close-button.close{
	display: none;
}
</style>
<%@ include file="/WEB-INF/views/message.jsp"%>
<section class="candidate-corner-section">
	<div class="container mt-3 mb-4">
		<div class="row">
			<div class="col-md-12 mt-3">
				<div class="card">
					<div class="card-header">
						<h2 class="section-names-style-1 text-left">
				        	My<span> Appointment</span>
				      	</h2>
					</div>
					<div class="card-body">
				    	<div class="accordion" id="accordionExample">
					        <!-- Accordion for Qualification Career Marking -->
				        	<div class="accordion-item">
				          		<div class="table-responsive">
			                    	<table class="datatable table table-striped table-bordered exportbtn mt-3" id="add_table">
						                <thead>
						                    <tr>
						                        <th style="text-align: center;width:60px;">Sl No.</th>
						                        <th>Applicant Name</th>
						                        <th>College Name</th>
						                        <th>Appointment Date</th>
						                        <th>Appointment Time</th>
						                        <th>Contract Months</th>
						                        <th>Location</th>
						                        <th>Contact Info</th>
						                        <th>Additional Notes</th>
						                        <th>Joining Date</th>
						                        <th style="text-align: center;">Action</th>
						                    </tr>
						                </thead>
						                <tbody>
							                <c:if test="${not empty appointmentsPendingList }">
						                    	<c:forEach var="appointment" items="${appointmentsPendingList}" varStatus="loop">
						                        	<tr>
							                            <td style="text-align: center;">${loop.count}</td>
							                            <td>${appointment.applicantName}</td>
							                             <td>${appointment.collegeName}</td>
							                            <td>
							                            <fmt:formatDate value="${appointment.joiningDate}" pattern="dd/MM/yyyy"/>
							                            </td>
							                            <td>${appointment.appointmentTime}</td>
							                            <td>${appointment.contractMonths}</td>
							                            <td>${appointment.location}</td>
							                            <td>${appointment.contactInfo}</td>
							                            <td>${appointment.additionalNotes}</td>
							                            <td><fmt:formatDate value="${appointment.joiningDate}" pattern="dd/MM/yyyy"/></td>
							                            <td style="text-align: center;">
															<c:choose>
															    <c:when test="${appointment.appointAccepted ne 'ACCEPTED'}">
															        <button type="button" 
															                class="btn btn-success btn-sm" 
															                onclick="acceptedAppointment('${appointment.appointmentId}', 'ACCEPTED')"
															                aria-label="Accept Appointment" title="Click to accept the appointment">
															            <i class="fa-solid fa-check"></i>
															        </button>
															    </c:when>
															    <c:otherwise>
															        <button type="button" 
															                class="btn btn-danger btn-sm"
															                onclick="acceptedAppointment('${appointment.appointmentId}', 'NOT ACCEPTED')"
															                aria-label="Accept Appointment" title="Click to accept the appointment">
															            <i class="fa-solid fa-xmark"></i>
															        </button>
															    </c:otherwise>
															</c:choose>
							
														</td>
						                        	</tr>
						                    	</c:forEach>
						                  	</c:if>  
						                   	<c:if test="${empty appointmentsPendingList }">
						                    	<tr>
							                    	<td colspan="100%" style="text-align:center; color:red; font-weight:bold;">
														No Record Found.
												    </td>
					                            </tr>
						                   	</c:if>
				                		</tbody>
				            		</table>
				            	</div>
			           		</div>
			   			</div>     
			   		</div>
				</div>
			</div>
		</div>
	</div>
</section>


<form id="acceptedOrnotAccepted" method="Post" action="${contextPath}/apply/acceptedOrnotAccepted">
	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
    <input type="hidden" name="appointment_Id" id="appointment_Id">
    <input type="hidden" name="acceptedOrnot" id="acceptedOrnot">
</form>

<!-- --------------------------------------------------Script-------------------------------------------------- -->

  <script>
  function acceptedAppointment(appointmentId, acceptedOrnot) {
	    let message = acceptedOrnot === 'ACCEPTED' 
	        ? "<b>Are you sure you want to accept this appointment?</b>" 
	        : "<b>Are you sure you want to reject this appointment?</b>";

	    bootbox.confirm({
	        message: message,
	        buttons: {
	            confirm: {
	                label: 'Yes',
	                className: 'btn-success'
	            },
	            cancel: {
	                label: 'No',
	                className: 'btn-danger'
	            }
	        },
	        callback: function (result) {
	            if (result) {
	                $("#appointment_Id").val(appointmentId);
	                $("#acceptedOrnot").val(acceptedOrnot);
	                $("#acceptedOrnotAccepted").submit();
	            }
	        }
	    });
	}



 </script>
