<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib prefix = "fn" uri = "http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib uri = "http://java.sun.com/jsp/jstl/functions" prefix = "fn" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />

<style>
	
	
	</style>


<%-- <div class="breadcrumb_conatiner">
              <div class="col-md-6">
                <h4 class="change-color">Category</h4>
              </div>
              <div class="col-md-6">
                <nav aria-label="breadcrumb">
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="${contextPath}/home"><i class="fa-solid fa-house"></i></a></li>
                 <!--    <li class="breadcrumb-item">
                      <a href="#">Procurement</a>
                    </li> -->
                    <li class="breadcrumb-item active" aria-current="page">Category</li>
                  </ol>
                </nav>
              </div>
            </div> --%>
<div class="row mt-3">
	<div class="col-md-12">
		<div class="card">
        	<div class="card-header">
            	<h5 class="card-title">Category</h5>
          	</div>
          	<div class="card-body">
				<form method="POST" action="${contextPath}/grievence/saveCategory" id="addCategoryFrm">
					<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" /> 
					<input type="hidden" id="categoryId" name="errorCategoryId" value="${cat.errorCategoryId }">
					<input type="hidden" class="" id="encodedDataaddCategoryFrm" name="encodedDataFrm" value="" />
					<div class="row">
						<div class="col-md-12">
							<div class="row">
								<div class="form-group col-md-3">
									<label class="inputEmail4 required" for="text">Category Name : </label>
									<input class="form-control form-control-sm" type="text" id="categoryName" name="categoryType" placeholder="enter category name" value="${cat.categoryType}" maxlength="30">
								</div>
								<div class="form-group col-md-3">
									<label class="inputEmail4 " for="text">Category Code :</label> 
									<input class="form-control form-control-sm" type="text" name="categoryCode" id="categoryCode" placeholder="" value="${cat.categoryCode}" maxlength="100" readonly>
								</div>
								<c:if test="${not empty cat.errorCategoryId }">
									<div class="form-group col-md-3 toggleTrueFalse" data-label-on="True" data-label-off="False" data-toggle-width="90" style="margin-top:26px !important">
										<input type="checkbox" value="${cat.isActive}" class="toggleCheckBox" ${cat.isActive == 'true' ? 'checked' : ''} id="parametros_MOSTRAPEDIDOS" name="isActive" />
										<label class="clickToggle" for="parametros_MOSTRAPEDIDOS"></label>
									</div>
								</c:if>

								<div class="col-md-12 text-end mt-3">
									<button type="button" class="btn btn-primary" onclick="validateForms()"><i class="fa fa-save"></i> ${not empty cat.errorCategoryId  ? 'Update' : 'Save'}</button>
									<a type="button" class="btn btn-warning" onclick="history.back()"><i class="fa-solid fa-rotate-left"></i> Back</a>
									<c:if test="${not empty cat.errorCategoryId }">
			                            <a type="button" href="${contextPath}/grievence/addCategory" class="btn btn-success"><i class="fa fa-plus"></i> Add New</a>
			                        </c:if>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<div class="col-md-12 mt-3">
		<div class="card">
        	<div class="card-header">
            	<h5 class="card-title">Category List</h5>
           	</div>
          	<div class="card-body">
				<div class="table-responsive">
					<table class="datatable table table-striped table-bordered exportbtn mt-3">
						<thead>
							<tr>
								<th class="text-center" style="width:60px;">Sl. No.</th>
								<th>Category Name</th>
								<th>Category Code</th>
								<th>Active/InActive</th>
								<th class="text-center">Action</th>
							</tr>
						</thead>
						<tbody>
							<c:forEach items="${catList}" var="catgory" varStatus="status">
								<tr>
									<td class="text-center">${status.count}</td>
									<td>${catgory.categoryType}</td>
									<td>${catgory.categoryCode}</td>
									<td>
										<div class="toggleTrueFalse" data-label-on="True" data-label-off="False" data-toggle-width="90">   
											<input type="checkbox" value="${catgory.isActive}" class="toggleCheckBox" ${catgory.isActive == 'true' ? 'checked' : ''} id="parametros_MOSTRAPEDIDOS${status.count}" name="parametros_MOSTRAPEDIDOS${status.count}" disabled="disabled"/>
										   <label class="clickToggle" for="parametros_MOSTRAPEDIDOS${status.count}"></label>
									   </div>
									</td>
									<td class="text-center">
										<a href="#" onclick="edit(${catgory.errorCategoryId})" class=" btn btn-primary btn-sm" data-toggle="tooltip" title="Edit Category"><i class="fas fa-edit"></i></a>
									</td>
								</tr>
							</c:forEach>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
<form  method="get" action="${contextPath}/grievence/addCategory" id="edit">
	<input type="hidden" id="categoryIddd" name="categoryId"  value="">
	<input type="hidden" class="" id="encodedDataedit" name="encodedDataedit" value="" />
</form>
<form  method="post" action="${contextPath}/mst/category/delete" id="deleteCategory">
	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
	<input type="hidden" id="categoryIdd" name="categoryId"  value="">
</form>
<script>
    function edit(id){
        $("#categoryIddd").val(id);
        encryptFormData("edit", tableOrTbodyIDS, tableOrTbodyKeys);
        $("#edit").submit();
    }
	function validateForms(){
		var cName=$("#categoryName").val().trim();
		if(cName == ""){
			displayErrorMsg("categoryName", "Please enter category name");
			return false;
		}else{
			clearError("categoryName");
		}
		var message="Are you sure you want to "+${not empty cat.errorCategoryId  ? '"Update"' : '"Save"'}+"?";
		bootbox.confirm({
			message: message,
			buttons: {
				confirm: {
					label: 'Yes',
					className: 'btn-success'
				},
				cancel: {
					label: 'No',
					className: 'btn-danger'
				}
			},
			callback: function (result) {
				if(result){
				    encryptFormData("addCategoryFrm", tableOrTbodyIDS, tableOrTbodyKeys);
					$("#addCategoryFrm").submit();
				}
			}
		});
		
	}
	function deleteCategory(id){
		$("#categoryIdd").val(id);
		$("#deleteCategory").submit();
	}
	

</script>