<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
	pageEncoding="ISO-8859-1"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet"
	href="${contextPath}/assets/js/plugin/jquery_autocomplete/jquery.autocomplete.css" />
<script src="${contextPath}/assets/js/plugin/jquery.autocomplete.min.js"></script>
<!-- <script src="resources/javascripts/common.js"></script> -->
<%-- <script src="${contextPath}/assets/appJs/validation/party-master.js"></script> --%>
<%-- <script src="${contextPath}/assets/appJs/validation/invoice.js"></script> --%>
<%@ page import="com.aashdit.fams.utils.ApplicationStringUtilsFams" %>
<style>
body {
	font-family: Arial, sans-serif;
	margin: 20px;
}

.product-list {
	margin-bottom: 20px;
}

.form-control {
	margin-right: 10px;
	margin-bottom: 10px;
}

.btn-add-product {
	margin-top: 10px;
	padding: 10px 20px;
	background-color: #007bff;
	color: #fff;
	border: none;
	cursor: pointer;
}

.btn-add-product:hover {
	background-color: #0056b3;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    border: 1px solid #ffffff1c;
}

tfoot td, tfoot th {
    border: none;
}

th, td {
    border: 1px solid #ffffff1c;
    padding: 8px;
}

th {
	background-color:  rgba(0, 0, 0, 0.1);
	text-align: left;
}

body {
	font-family: Arial, sans-serif;
	background-color: #2f3a38;
	margin: 0;
	padding: 0;
}

.container {
	max-width: 800px;
	margin: 50px auto;
	background: #fff;
	padding: 20px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

header {
	text-align: center;
	margin-bottom: 20px;
}

h1 {
	font-size: 24px;
	margin: 0;
}

.form-group {
	margin-bottom: 15px;
}

label {
	display: block;
	margin-bottom: 5px;
}

input[type="text"], input[type="date"], select {
	width: 100%;
	padding: 10px;
	border: 1px solid #ccc;
	border-radius: 5px;
}

.product-list {
	margin: 20px 0;
}

.product-item {
	display: flex;
	gap: 10px;
	margin-bottom: 10px;
}

.product-item input {
	flex: 1;
}

.totals {
	background: #f9f9f9;
	padding: 10px;
	margin: 20px 0;
}

.total-item {
	display: flex;
	justify-content: space-between;
	padding: 5px 0;
}

button[type="button"] {
	background: #007bff;
	color: #fff;
	border: none;
	padding: 10px 20px;
	border-radius: 5px;
	cursor: pointer;
}

button[type="submit"] {
	background: #28a745;
	color: #fff;
	border: none;
	padding: 10px 20px;
	border-radius: 5px;
	cursor: pointer;
	display: block;
	width: 100%;
	margin-top: 20px;
}

button:hover {
	opacity: 0.9;
}

.partyDtlsDiv {
    display: flex;
    justify-content: space-between;
/*     align-items: center; */
}
</style>

<script>
	$(function()
	{
		$('#datatable-default').dataTable({
	 		"bSort": false,
	 		"autoWidth": false
		});
	})
</script>



<!-- Start::row-1 -->
<div class="container-fluid">
    <div class="row">
        <div class="col-xl-12">
            <div class="card custom-card">
                <div class="top-left"></div>
                <div class="top-right"></div>
                <div class="bottom-left"></div>
                <div class="bottom-right"></div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12">
                            <section class="panel">
                                <div class="panel-body" id="partyDtlsInRequest">
                                    <div class="col-md-12">

                                        <form class="form-horizontal form-bordered" id="invoiceDetails" action="${contextPath}/ipms/invoice/save" method="POST">

                                            <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
                                            <input type="hidden" value="true" id="labelmsg" name="labelmsg">
                                            

                                            <input type="hidden" value="false" id="isCrDeNote" name="isCrDeNote">
                                            <input type="hidden" value="" id="crDeType" name="crDeType"><%-- ${loadData.pageCode eq 'CREDIT_NOTE'? 'CR':loadData.pageCode eq 'DEBIT_NOTE'?'DB':''} --%>

                                            <input type="hidden" id="invoiceId1" name="invoiceId1" value="${invoiceMaster.invoiceId}">
                                            <div class="row">
                                                <h5 class="panel-title"><span>Invoice</span></h5>
                                            </div>
                                            <div class="row">
                     <c:set var="ownFunctions" value="" />
                    <c:set var="functionList" value="getOrganizationDwonEHL(this)" />
					<c:set var="upperOrDown" value="down" />
					<c:set var="functionList2" value="${invoiceMaster.invoiceId eq null?'generateInvoiceNum();':''}"/>
					<%@ include file="/WEB-INF/views/entityIdAndUserLevelList.jsp"%>
                                                <div class="col-md-2 col-sm-3">
                                                    <div class="form-group">
                                                        <label for="FinancialYear" class="required">Financial Year</label>
                                                        <div class="col-md-12">
                                                            <select class="form-control require" name="finYearId" id="finYearId" onchange="generateInvoiceNum();" data-plugin-selectTwo>
                                                                <option value="">
                                                                    <spring:message code="COMMON.LABEL.DROPDOWN.SELECT" />
                                                                </option>
                                                                <c:forEach items="${loadData.finList}" var="fin">
                                                                    <option value="${fin.finyearId}" ${fin.finyearId eq invoiceMaster.finanicalYear.finyearId ? 'selected' : '' }>${fin.finYear}</option>
                                                                </c:forEach>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                <%-- <div class="col-md-2 col-sm-3">
                                                    <div class="form-group">
                                                        <label for="FinancialYear" class="required ">Office </label>
                                                        <div class="col-md-12">
                                                            <!-- onchange="gettingDepartmentList(this.value,0);"  -->
                                                            <select class="form-control require remove" name="officeMasterId" id="officeMasterId" onchange="generateInvoiceNum();">
                                                                <option value="">
                                                                    <spring:message code="COMMON.LABEL.DROPDOWN.SELECT" />
                                                                </option>
                                                                <c:forEach items="${loadData.officeMasterList}" var="off">
                                                                    <option value="${off.id}" ${off.id eq invoiceMaster.offMaster.id ? 'selected' : '' }>${off.name}</option>
                                                                </c:forEach>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div> --%>
                                               
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="invoice-id">Invoice Code</label>
                                                           <input type="text" id="invoiceCode" name="invoiceCode" class="form-control require disabled" value="${invoiceMaster.invoiceCode}">
                                                      

                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="date-issued">Date Issued</label>
                                                        <fmt:formatDate var="formattedDate" value="${invoiceMaster.dueIssueDate1}" pattern="yyyy-MM-dd" />
                                                        <input type="date" id="dateIssued" value="${formattedDate}" name="dateIssued" onchange="getOneMonthAfterDate(this.value)" class="form-control require">
                                                    </div>


                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="due-date">Due Date</label>
                                                        <fmt:formatDate var="formattedDate1" value="${invoiceMaster.dueDate1}" pattern="yyyy-MM-dd" />
                                                        <input type="Date" value="${formattedDate1}" id="due-date" name="dueDate" class="form-control require">

                                                    </div>
                                                </div>

                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="due-amount">Due Amount</label>
                                                        <input type="text" name="dueAmount" id="dueAmount" value="${invoiceMaster.dueAmount}" class="form-control require disabled" style="text-align:right">
                                                    </div>
                                                </div>

                                                <div class="col-md-12">
                                                    <h6 class="panel-title"><span>Billing Details</span></h6>

                                                    <div class="partyDtlsDiv" style=" margin-top: 10px;">
                                                        <!-- PARTY BILLING ADDRESS DIV -->
                                                        <div class="col-md-4 col-sm-4" style="padding:10px;">
                                                            <div class="partyAddrDtlsDiv">
                                                                <div class="form-group">
                                                                    <h6 class="text-start">BILLING FROM :</h6>
                                                                </div>
                                                            </div>

                                                            <div class="partyAddrDtlsDiv">
                                                                <div class="form-group">
                                                                    <label class="required" for="inputDefault">
                                                                        <spring:message code="LABEL.ACCOUNTS.INVOICE.PARTY.CODENAME" />
                                                                    </label>
                                                                    <input type="text" class="form-control require " name="billingFromPartyName" id="billingFromPartyName" value="${invoiceMaster.fromParty1.partyName}">
                                                                    <input type="hidden" class="form-control require" name="fromParty" id="partyId" value="${invoiceMaster.fromParty1.partyId}">
                                                                </div>
                                                            </div>

                                                            <div class="partyAddrDtlsDiv">
                                                                <div class="form-group">
                                                                    <label for="inputDefault">
                                                                        <spring:message code="LABEL.ACCOUNTS.INVOICE.PARTY.ADDRESS" />
                                                                    </label>
                                                                    <input type="text" class="form-control require" style="min-height:100px;" readonly id="partyAddress" value="${invoiceMaster.fromParty1.address}">
                                                                </div>
                                                            </div>

                                                            <div class="col-md-12 col-sm-12">
                                                                <div class="form-group">
                                                                    <label for="inputDefault">Mobile No.</label>
                                                                    <input type="text" class="form-control require" readonly id="partyMobileNo" value="${invoiceMaster.fromParty1.mobileNo}">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-12 col-sm-12">
                                                                <div class="form-group">
                                                                    <label for="inputDefault">Email Id</label>
                                                                    <input type="text" class="form-control require" readonly id="partyEmail" value="${invoiceMaster.fromParty1.emailId}">
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="form-group col-md-7">
                                                                    <label for="inputDefault">
                                                                        <spring:message code="LABEL.ACCOUNTS.INVOICE.PARTY.GSTIN" />
                                                                    </label>
                                                                    <input type="text" class="form-control require" readonly id="partyGst" value="${invoiceMaster.fromParty1.gstNo}">
                                                                </div>
                                                                <div class="form-group col-md-5">
                                                                    <label for="inputDefault">
                                                                        <spring:message code="LABEL.ACCOUNTS.INVOICE.PARTY.PAN" />
                                                                    </label>
                                                                    <input type="text" class="form-control require" readonly id="partyPan" value="${invoiceMaster.fromParty1.panNo}">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- END : PARTY BILLING ADDRESS DIV -->

                                                        <!-- PLACE OF SUPPLY DIV -->
                                                        <div class="col-md-4 col-sm-4" style="padding:10px;">
                                                            <div class="partyAddrDtlsDiv">
                                                                <div class="form-group">
                                                                    <h6 class="text-start">BILLING TO :</h6>
                                                                </div>
                                                            </div>

                                                            <div class="partyAddrDtlsDiv">
                                                                <div class="form-group">
                                                                    <label class="required" for="inputDefault">
                                                                        <spring:message code="LABEL.ACCOUNTS.INVOICE.PARTY.CODENAME" />
                                                                    </label>
                                                                    <input type="text" class="form-control require " id="billingToPartyName" name="billingToPartyName" value="${invoiceMaster.toParty1.partyName}">
                                                                    <input type="hidden" class="form-control require" name="toParty" id="billingToPartyId" value="${invoiceMaster.toParty1.partyId}">
                                                                </div>
                                                            </div>

                                                            <div class="partyAddrDtlsDiv">
                                                                <div class="form-group">
                                                                    <label for="inputDefault">
                                                                        <spring:message code="LABEL.ACCOUNTS.INVOICE.PARTY.ADDRESS" />
                                                                    </label>
                                                                    <input type="text" class="form-control require" style="min-height:100px;" readonly id="toAddress" value="${invoiceMaster.toParty1.address}">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-12 col-sm-12">
                                                                <div class="form-group">
                                                                    <label for="inputDefault">Mobile No.</label>
                                                                    <input type="text" class="form-control require" readonly id="toMobileNo" value="${invoiceMaster.toParty1.mobileNo}">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-12 col-sm-12">
                                                                <div class="form-group">
                                                                    <label for="inputDefault">Email Id</label>
                                                                    <input type="text" class="form-control require" readonly id="toEmail" value="${invoiceMaster.toParty1.emailId}">
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="form-group col-md-7">
                                                                    <label for="inputDefault">
                                                                        <spring:message code="LABEL.ACCOUNTS.INVOICE.PARTY.GSTIN" />
                                                                    </label>
                                                                    <input type="text" class="form-control require" readonly id="topartyGst" value="${invoiceMaster.toParty1.gstNo}">
                                                                </div>
                                                                <div class="form-group col-md-5">
                                                                    <label for="inputDefault">
                                                                        <spring:message code="LABEL.ACCOUNTS.INVOICE.PARTY.PAN" />
                                                                    </label>
                                                                    <input type="text" class="form-control require" readonly id="topartyPan" value="${invoiceMaster.toParty1.panNo}">
                                                                </div>
                                                            </div>
                                                        </div>
                                                       
                                                    </div>
                                                </div>

                                            </div> 



                                            <div class="row">
                                                <h6 class="panel-title"><span>Product Details</span></h6>
                                            </div>
                                            <div class="table-responsive">
												 <table id="product-table" class="table table-bordered">
												    <thead>
												        <tr>
												            <th>BoQ Item Name</th>
												            <th>Description</th>
												            <th>HSN Code</th>
												            <th>Discount Per</th>
												            <th>Particular Name</th>
												            <th>Quantity</th>
												            <th>Unit</th>
												            <th>Rate per Unit</th>
												            <th> Amount</th>
												            <th>Gst</th>
												            <th>Sgst</th>
															<th>Cgst</th>
															<th>Igst</th>
												            <th>Total Amount</th>
												            <!-- <th>Action</th> -->
												        </tr>
												    </thead>
												    <tbody id="tbd">
												    <!-- Declare and initialize the index variable -->
												    <c:if test="${empty productDetailsList}">
												    <c:set var="index" value="0" scope="page" />
												    <c:forEach var="boqItem" items="${measurement.measurementData}" varStatus="status">
												        <c:forEach var="particular" items="${boqItem.particulars}" varStatus="innerStatus">
												            <tr>
												                <!-- Hidden BoQ Item ID and Name for saving -->
												                <td>
												                    <input type="hidden" id="boqItemId${index}" name="productDetails[${index}].boqItemId" value="${boqItem.boqItemId}">
												                    <input type="text" class="form-control require disabled" id="boqItemName${index}" name="productDetails[${index}].boqItemName" value="${boqItem.boqItemName}">
												                </td>
												                
												                <td>
												                    <input type="text" class="form-control require disabled" id="description${index}" name="productDetails[${index}].description" value="${boqItem.boqItemName}">
												                </td>
												                
												                <td>
																	<select name="productDetails[${index}].hsnCode" id="hsnCode${index}" data-plugin-selectTwo class="form-control multi-formcontrol require" onchange="getGstTaxBreakupDetails('${contextPath}',${index});" style="width: 250px;"> 
																		<option value=""><spring:message code="COMMON.LABEL.DROPDOWN.SELECT"/></option>														
																		<c:forEach items="${loadData.hsnCodeList}" var="hsnSacCodesList">
																			<option value="${hsnSacCodesList.gstId}">${hsnSacCodesList.hsnSacCode} || ${hsnSacCodesList.description}</option>
																		</c:forEach>
																	</select>
																</td>
																
																<!--discount  -->
																<td>
																<input type="text" class="form-control require"  id="discount${index}" name="productDetails.[${index}].discount"  onchange='total_amount(${index},0);' onkeypress="return validateInputDecimal(event,this);" placeholder="Discount" value="0.00">
																</td>	
																
												                
												                <!-- Particular Name -->
												                <td>
												                    <input type="hidden" id="particularId${index}" name="productDetails[${index}].particularId" value="${particular.particularId}">
												                    ${particular.particularName}
												                </td>
												                
												                <!-- Quantity -->
												                <td>
												                    <input type="text" class="form-control disabled" id="quantity${index}" name="productDetails[${index}].quantity" onkeypress="return validateInputDecimal(event,this);" value="${ApplicationStringUtilsFams.convertDoubleToTwoDecimal(particular.quantity)}" placeholder="Quantity" ">
												                </td>
												                
												                <!-- Unit -->
												                <td>
												                    <input type="hidden" id="unitType${index}" name="productDetails[${index}].unit" value="${particular.unit}">
												                    ${particular.unit}
												                </td>
												                
												                <!-- Rate per Unit -->
												                <td>
												                    <input type="text" class="form-control disabled text-end" id="price${index}" name="productDetails[${index}].price" value="${ApplicationStringUtilsFams.convertDoubleToTwoDecimal(particular.ratePerUnit)}" onkeypress="return validateInputDecimal(event,this);" placeholder="Rate per Unit" ">
												                </td>
												                
												                <!--Amount  -->
												                
												                <td>
												                    <input type="text" class="form-control disabled text-end" id="amount${index}" name="productDetails[${index}].amount" value="${ApplicationStringUtilsFams.convertDoubleToTwoDecimal(particular.totalAmount)}" readonly>
												                </td>
												                
												                <!--Gst  -->
												                
												                
												                <td><input type="text" class="form-control text-end" id="gst${index}" name="productDetails[${index}].gst" onchange='total_amount(${index},${index});' value=""  readonly="readonly" style="width: 100px;" placeholder="Gst"></td>
						                                        <td><input type="text" class="form-control text-end" id="sgst${index}" name="productDetails[${index}].sgst" onchange='total_amount(${index},${index});' value="" readonly="readonly" style="width: 100px;" placeholder="Sgst"></td>
						                                        <td><input type="text" class="form-control text-end" id="cgst${index}" name="productDetails[${index}].cgst" onchange='total_amount(${index},${index});' value="" readonly="readonly" style="width: 100px;" placeholder="Cgst"></td>
						                                        <td><input type="text" class="form-control text-end" id="igst${index}" name="productDetails[${index}].igst" onchange='total_amount(${index},${index});' value="" readonly="readonly" style="width: 100px;" placeholder="Igst"></td>
																
												                
												                
												                <!-- Total Amount -->
												                <td>
												                    <input type="text" class="form-control" id="total${index}" name="productDetails[${index}].total" value="0.00" readonly>
												                </td>
												                
												                <!-- Remove Button -->
												                <!-- <td>
												                    <button type="button" class="btn btn-danger remove-btn" onclick="removeRow(this)">-</button>
												                </td> -->
												            </tr>
												            <!-- Increment index -->
												            <c:set var="index" value="${index + 1}" />
												        </c:forEach>
												    </c:forEach>
												    </c:if>
												    
												    <c:if test="${not empty productDetailsList}">
												    
												    <c:forEach items="${productDetailsList}" var="productDetailsList" varStatus="status">
													 <tr>
												                <!-- Hidden BoQ Item ID and Name for saving -->
												                <td>
												                    <input type="hidden" id="boqItemId${status.index}" name="productDetails[${status.index}].boqItemId" value="${productDetailsList.prtclrId.measurementBookData.boqItem.boqItemId}">
												                    <input type="text" class="form-control disabled" id="boqItemName${status.index}" name="productDetails[${status.index}].boqItemName" value="${productDetailsList.prtclrId.measurementBookData.boqItem.itemName}">
												                </td>
												                
												                <td>
												                    <input type="text" class="form-control require disabled" id="description${status.index}" name="productDetails[${status.index}].description" value="${productDetailsList.descrpition}">
												                </td>
												                
												                <td>
																	<select name="productDetails[${status.index}].hsnCode" id="hsnCode${status.index}" data-plugin-selectTwo class="form-control multi-formcontrol" onchange="getGstTaxBreakupDetails('${contextPath}',${status.index});" style="width: 250px;"> 
																		<option value=""><spring:message code="COMMON.LABEL.DROPDOWN.SELECT"/></option>														
																		<c:forEach items="${loadData.hsnCodeList}" var="hsnSacCodesList">
																			<option value="${hsnSacCodesList.gstId}" ${hsnSacCodesList.gstId eq productDetailsList.hsnCode1.gstId ?'selected':'' }>${hsnSacCodesList.hsnSacCode} || ${hsnSacCodesList.description}</option>
																		</c:forEach>
																	</select>
																</td>
																
																<!--discount  -->
																<td>
																<input type="text" class="form-control require "  id="discount${status.index}" name="productDetails.[${status.index}].discount"  onchange='total_amount(${status.index},0);' placeholder="Discount" onkeypress="return validateInputDecimal(event,this);" value="${productDetailsList.discount}">
																</td>	
																
												                
												                <!-- Particular Name -->
												                <td>
												                    <input type="hidden" id="particularId${status.index}" name="productDetails[${status.index}].particularId" value="${productDetailsList.prtclrId.prtclrId}">
												                    ${productDetailsList.prtclrId.particular}
												                </td>
												                
												                <!-- Quantity -->
												                <td>
												                    <input type="text" class="form-control disabled" id="quantity${status.index}" name="productDetails[${status.index}].quantity" value="${ApplicationStringUtilsFams.convertDoubleToTwoDecimal(productDetailsList.quantity)}" onkeypress="return validateInputDecimal(event,this);" placeholder="Quantity" ">
												                </td>
												                
												                <!-- Unit -->
												                <td>
												                    <input type="hidden" id="unitType${status.index}" name="productDetails[${status.index}].unit" value="${productDetailsList.prtclrId.measurementBookData.boqItem.unitType.unitTypeName}">
												                    ${productDetailsList.prtclrId.measurementBookData.boqItem.unitType.unitTypeName}
												                </td>
												                
												                <!-- Rate per Unit -->
												                <td>
												                    <input type="text" class="form-control text-end disabled" id="price${status.index}" name="productDetails[${status.index}].price" onkeypress="return validateInputDecimal(event,this);" value="${ApplicationStringUtilsFams.convertDoubleToTwoDecimal(productDetailsList.price)}" placeholder="Rate per Unit" ">
												                </td>
												                
												                <!--Amount  -->
												                
												                <td>
												                    <input type="text" class="form-control text-end disabled" id="amount${status.index}" name="productDetails[${status.index}].amount" onkeypress="return validateInputDecimal(event,this);" value="${ApplicationStringUtilsFams.convertDoubleToTwoDecimal(productDetailsList.prtclrId.totalAmt)}" readonly>
												                </td>
												                
												                <!--Gst  -->
												                
												                
												                <td><input type="text" class="form-control text-end" id="gst${status.index}" name="productDetails[${status.index}].gst" onchange='total_amount(${status.index},${status.index});' value="${productDetailsList.gst}"  readonly="readonly" style="width: 100px;" placeholder="Gst"></td>
						                                        <td><input type="text" class="form-control text-end" id="sgst${status.index}" name="productDetails[${status.index}].sgst" onchange='total_amount(${status.index},${status.index});' value="${productDetailsList.sgst}" readonly="readonly" style="width: 100px;" placeholder="Sgst"></td>
						                                        <td><input type="text" class="form-control text-end" id="cgst${status.index}" name="productDetails[${status.index}].cgst" onchange='total_amount(${status.index},${status.index});' value="${productDetailsList.cgst}" readonly="readonly" style="width: 100px;" placeholder="Cgst"></td>
						                                        <td><input type="text" class="form-control text-end" id="igst${status.index}" name="productDetails[${status.index}].igst" onchange='total_amount(${status.index},${status.index});' value="${productDetailsList.igst}" readonly="readonly" style="width: 100px;" placeholder="Igst"></td>
																
												                
												                
												                <!-- Total Amount -->
												                <td>
												                    <input type="text" class="form-control" id="total${status.index}" name="productDetails[${status.index}].total" value="${ApplicationStringUtilsFams.convertDoubleToTwoDecimal(productDetailsList.productTotal)}" readonly>
												                </td>
												                
												                <!-- Remove Button -->
												                <!-- <td>
												                    <button type="button" class="btn btn-danger remove-btn" onclick="removeRow(this)">-</button>
												                </td> -->
												            </tr>
												</c:forEach>
												    
												    
												    
												    </c:if>
												</tbody>
												
												<tfoot style="border:none;">
												<tr>
												<td colspan="14"></td>
												</tr>
												<tr>
													<td colspan="11" rowspan="4"></td>
													<th >Sub total :</th>
													<td colspan="2" style="background-color:  rgba(0, 0, 0, 0.1);">
<%-- 													<span id="ssubTotal">${invoiceMaster.subTotal}</span> --%>
													<input type="text" value="${invoiceMaster.subTotal}" class="form-control"  id="ssubTotal">
									   				<input type="hidden" value="${invoiceMaster.subTotal}" class="form-control" name="subTotal" id="subTotal">
													</td>
												</tr>
												<tr>
													<th >Avail Discount :</th>
													<td colspan="2" style="background-color:  rgba(0, 0, 0, 0.1);">
<%-- 													<span id="savailDiscount">${invoiceMaster.availDiscount}</span> --%>
													<input type="text" value="${invoiceMaster.availDiscount}" class="form-control"  id="savailDiscount">
										            <input type="hidden" value="${invoiceMaster.availDiscount}" class="form-control" id="availDiscount" name="availDiscount">
													
									   				
													</td>
												</tr>
												<tr>
													<th >Gst :</th>
													<td colspan="2" style="background-color:  rgba(0, 0, 0, 0.1);">
<%-- 													<span id="sgstAmount1">${invoiceMaster.gstAmount}</span> --%>
													<input type="text" value="${invoiceMaster.gstAmount}" class="form-control"  id="sgstAmount1">
									   				<input type="hidden" value="${invoiceMaster.gstAmount}" class="form-control" id="gstAmount1" name="gstAmount" />
													</td>
												</tr>
												<tr>
													<th >Total :</th>
													<td colspan="2" style="background-color:  rgba(0, 0, 0, 0.1);">
<%-- 													<span id="stotalAmount">${invoiceMaster.totalAmount}</span> --%>
													<input type="text" value="${invoiceMaster.totalAmount}" class="form-control"  id="stotalAmount">
									   				<input type="hidden" value="${invoiceMaster.totalAmount}" class="form-control" name="totalAmount"  id="totalAmount" >
													</td>
												</tr>
												<tr>
												<td colspan="12"></td>
												</tr>
											</tfoot>

												</table>

                                            </div>

                                            <div class="row">
                                                <div class="col-sm-12" style="margin-top: 30px;">
                                                    <div class="form-group text-center">
                                                           <!--  <input type="button" class="btn btn-success" onclick="submitFormData()" value="Save" /> -->
                                                            <c:set var="dynamicFromId" value="invoiceDetails" scope="request" />
													            <c:set var="wonFunction" value="submitFormData()"/>
							                                    <%@ include file="/WEB-INF/views/stageConfig/stageButton.jsp"%> 
                                                    </div>
                                                </div>
                                            </div> 
                                        </form>
                                    </div>
                                </div>
                            </section>
                            <hr>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--End::row-1 -->
</div>


<script>
var url='${contextPath}';

$(document).ready(function() {
	dueAmount();
	$("input[name^='billingFromPartyName']").autocomplete({	
	    serviceUrl: '${contextPath}/inv/findPartyDetailByAutocomplete.htm',
	    paramName: "clientcode",
	    delimiter: ",",
	    width: '150px',
	    transformResult: function(response) {
	        return {
	            suggestions: $.map($.parseJSON(response), function(item) {
	                return {                      
	                    value: item.clientcode, 
	                    data: item.clientid
	                };
	            })
	        };
	    },
	    onSelect: function (suggestion) {
	        var selectedRow = parseInt(this.parentNode.parentNode.rowIndex) - 1;
	        document.getElementById("partyId").value = suggestion.data;
	        
	        getPartyDetails(suggestion.data,'BILLINGPARTY');
	    } 
	});
	
	
	$("input[name^='billingToPartyName']").autocomplete({	
	    serviceUrl: '${contextPath}/inv/findPartyDetailByAutocomplete.htm',
	    paramName: "clientcode",
	    delimiter: ",",
	    width: '150px',
	    transformResult: function(response) {
	        return {
	            suggestions: $.map($.parseJSON(response), function(item) {
	                return {                      
	                    value: item.clientcode, 
	                    data: item.clientid
	                };
	            })
	        };
	    },
	    onSelect: function (suggestion) {
	        var selectedRow = parseInt(this.parentNode.parentNode.rowIndex) - 1;
	        document.getElementById("billingToPartyId").value = suggestion.data;
	        
	        getPartyDetails(suggestion.data,'BILLINGTOPARTY');
	    } 
	});
	

});

async function getPartyDetails(partyBillingId, fieldVal) {
	//debugger;
   
        try {
            const response = await $.ajax({
                url: `${contextPath}/inv/getPartyDetails.htm`,
                type: 'GET',
                data: { partyId: partyBillingId },
                cache: false
            });

            if (response !== "") {
                if (fieldVal === "BILLINGPARTY") {
                    const details =JSON.parse(response) ;
                    document.getElementById("partyAddress").value = details.address;
                    document.getElementById("partyGst").value = (details.gstNo !== "null" && details.gstNo !== null) ? details.gstNo : "";
                    document.getElementById("partyPan").value = details.panNo;
                    document.getElementById("partyMobileNo").value = (details.phno !== "null" && details.phno !== null) ? details.phno : "";
                    document.getElementById("partyEmail").value = details.email;
                }else{
                	const details =JSON.parse(response) ;
                    document.getElementById("toAddress").value = details.address;
                    document.getElementById("topartyGst").value = (details.gstNo !== "null" && details.gstNo !== null) ? details.gstNo : "";
                    document.getElementById("topartyPan").value = details.panNo;
                    document.getElementById("toMobileNo").value = (details.phno !== "null" && details.phno !== null) ? details.phno : "";
                    document.getElementById("toEmail").value = details.email;
                }
            } else {
                // alert("No Details Found");
            }
        } catch (error) {
            // alert("No Details Found");
        }
    
}




function dueAmount(){
	var rowCount = document.getElementById("tbd").rows.length;
	var total = 0.00;
	for (var i = 0; i < rowCount; i++) {
	    var totalElement = document.getElementById("total" + i);
	    if (totalElement) {
	        var totalValue = parseFloat(totalElement.value) || 0;
	        total += totalValue;
	    }
	}
	var dueAmount = total;  // If dueAmount is meant to be double the total, use total * 2 instead.
   $("#dueAmount").val(dueAmount.toFixed(2));
	
}




function submitFormData() {
	 tableOrTbodyIDS=['product-table'];   
	    tableOrTbodyKeys=['productDetails'];
	if (validateForm()) {
		if (encryptFormData('invoiceDetails', tableOrTbodyIDS, tableOrTbodyKeys)) {
			confirmation('invoiceDetails');
		}
	}
	
}



$(document).ready(function() {

	$("input[name^='searchPartyName']").autocomplete({	
		serviceUrl: '${contextPath}/inv/findPartyDetailByAutocomplete.htm',
		paramName: "clientcode",
		delimiter: ",",
		width: '295px',
		transformResult: function(response) {
			return {
				//must convert json to javascript object before process
				suggestions: $.map($.parseJSON(response), function(item) {
					return {                      
						value: item.clientcode, data: item.clientid
					};
				})
			};
		},
		onSelect: function (suggestion) {
			var selectedRow=0;
			selectedRow=parseInt(this.parentNode.parentNode.rowIndex)-1;
			document.getElementById("searchPartyId").value=suggestion.data;
			
		}
	});
	
	var invoiceId ='${invoiceMaster.invoiceId}';
	if(invoiceId!=''){
		
		
		 var rowCount = document.getElementById("tbd").rows.length;
  	   for(var i=0; i<rowCount;i++){
  		 var productNameHd = $("#productNameHd"+i).val()
  		 
  	   }
	}
	
	
});




function generateInvoiceNum() {
	debugger
	var entityIdLevelCombo=$("#upperEntityId").val();
	//var officeMasterId =$("#officeMasterId").val();
	var finYearId =$("#finYearId").val();
	
 if(entityIdLevelCombo!='' & finYearId!=''){
    $.ajax({
        url: "${contextPath}/creditDebitNote/genInvoiceNoBasedOnParam",
        async: false,
        data: {entityIdLevelCombo: entityIdLevelCombo, finYearId:finYearId},
        success: function(response) {
            if (response && response !== "") {
                document.getElementById("invoiceCode").value = response.generatedInvoiceNo || "";
              //  bootbox.alert(response.generatedInvoiceNo);
            } else {
                bootbox.alert("No Data Found");
            }
        },
        error: function() {
            bootbox.alert("Error fetching data");
        }
    });
  }
}

	

function validateInputDecimal(event, inputElement) {
	  var inputValue = inputElement.value;
	  var isDigitOrDecimal = (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 46;
	  var decimalIndex = inputValue.indexOf('.');
	  if (decimalIndex !== -1) {
	    if (event.charCode == 46) {
	      event.preventDefault();
	      return false;
	    }
	    var decimalPart = inputValue.substr(decimalIndex + 1);
	  }
	  return isDigitOrDecimal;
	}


</script>
