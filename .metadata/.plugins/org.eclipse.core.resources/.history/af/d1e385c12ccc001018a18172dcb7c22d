<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script src="${contextPath}/assets/appJs/validation/common-utils.js"></script>
<sec:authentication var="principal" property="principal" />
<c:set var="roleCode" value="${principal.primaryRole.roleCode}" />





<div class="breadcrumb_conatiner">
              <div class="col-md-6">
                <h4 class="change-color">Facility Buildings</h4>
              </div>
              <div class="col-md-6">
                <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
					<li class="breadcrumb-item"><a href="${contextPath}/home">Home</a></li>
					<li class="breadcrumb-item active" aria-current="page">Add
						facility building</li>
				</ol>
                </nav>
              </div>
            </div>
            
            
            
<div class="card">
<div class="card-header"><h5 class="card-title">Add Facility Buildings</h5></div>

		
	<div class="card-body">
	<form action="${contextPath}/facilityManagement/saveFacilityBuilding"
		method="post" id="saveFormId" class="row">
		<input type="hidden" name="${_csrf.parameterName}"
			value="${_csrf.token}" /> <input type="hidden" name="buildingId"
			value="${editBuilding.buildingId}" id="buildingId" />

		<div class="form-group col-md-2">
			<label class="required">Building Name</label> <input type="text"
				class="form-control form-control-sm" id="buildingNameId"
				name="buildingName" maxlength="20"
				value="${editBuilding.buildingName}">
		</div>

		<div class="form-group col-md-2">
			<label class="required">Building Code</label> <input type="text"
				class="form-control form-control-sm" id="buildingCodeId"
				name="buildingCode" maxLength="20"
				onchange="validateBuildingCode(this.value)"
				value="${editBuilding.buildingCode}">
		</div>

		<div class="form-group col-md-2">
			<label class="required">Description</label> <input type="text"
				class="form-control form-control-sm" id="descriptionId"
				name="description" maxLength="30"
				value="${editBuilding.description}">
		</div>

		<div class="form-group col-md-2">
			<label class="required">Location</label> <input type="text"
				class="form-control form-control-sm" id="locationId" name="location"
				maxLength="30" value="${editBuilding.location}">
		</div>

		<%-- <div class="form-group col-md-2">
            <label class="required">Latitude</label>
            <input type="text" class="form-control form-control-sm" id="latitudeId" name="latitude" maxLength="20" value="${editBuilding.latitude}">
        </div>
        
        <div class="form-group col-md-2">
            <label class="required">Longitude</label>
            <input type="text" class="form-control form-control-sm" id="longitudeId" name="longitude" maxLength="20" value="${editBuilding.longitude}">
        </div> --%>

		<div class="form-group col-md-4 text-left">
			<button type="button" margin-left: 8px;"
				onclick="submitForm('${empty editBuilding.buildingId ? 'SAVE' : 'UPDATE'}')"
				class="btn btn-submit searchdiv">${empty editBuilding.buildingId ? 'Submit' : 'Update'}</button>
			<button type="button" margin-left: 8px;" onclick="history.back()"
				class="btn btn-back searchdiv">Back</button>

		</div>
	</form>
	</div>
</div>



<div class="card">
<div class="card-header"><h5 class="card-title">Building List</h5></div>
	<div class="card-body">
		
		<table
			class="datatable table table-striped table-bordered exportbtn">
			<thead>
				<tr>
					<th>Sl.No</th>
					<th>Building Name</th>
					<th>Building Code</th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody>
				<c:forEach items="${buildingList}" var="building" varStatus="count">
					<tr>
						<td>${count.count}</td>
						<td>${building.buildingName}</td>
						<td>${building.buildingCode}</td>
						<td><a
							href="${contextPath}/facilityManagement/editFacilityBuilding?hdnId=${building.buildingId}"
							class="btn btn-primary" title="edit"> <i
								class=" fa fa-pen " aria-hidden="true"></i></a></td>
					</tr>
				</c:forEach>
			</tbody>
		</table>
	</div>
</div>

<script>
function submitForm(status) {
    if ($("#buildingNameId").val().trim() == "") {
        bootbox.alert("Please provide a Building name");
        $("#buildingNameId").val('');
        return false;
    } else if ($("#buildingCodeId").val().trim() == "") {
        bootbox.alert("Please provide a Building code");
        $("#buildingCodeId").val('');
        return false;
    } else if ($("#descriptionId").val().trim() == "") {
        bootbox.alert("Please provide Description");
        $("#descriptionId").val('');
        return false;
    } else if ($("#locationId").val().trim() === "") {
        bootbox.alert("Please provide a location");
        $("#locationId").val('');
        return false;
    } else { var message = status === 'SAVE' ? 'save' : 'update';
	 bootbox.confirm("Do you want to "+message+" Facility Building Detials ?", function (result) {
            if (result) {
                showLoader();
                $("#saveFormId").submit();
            }
        });
    }
}

function validateBuildingCode(buildingCode) {
    var buildingId = $("#buildingId").val();
    $.ajax({
        type: "get",
        url: "${contextPath}/facilityManagement/duplicateCheckForBuildingCode",
        data: {
            "buildingId": buildingId,
            "buildingCode": buildingCode,
        },
        success: function (response) {
            var data = response;
            if (data === 'Yes') {
                bootbox.alert("Duplicate Building Codes are not Allowed");
                $("#buildingCodeId").val('');
            }
        },
        error: function (xhr, status, error) {
            console.error("AJAX request failed with status: " + status + "\nError: " + error);
        }
    });
}

</script>


