<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script src="${contextPath}/assets/appJs/validation/common-utils.js"></script>
<script src="${contextPath}/assets/appJs/validation/AadharVaidator.js"></script>
<%--<jsp:useBean id="strUtils"
	class="com.aashdit.demography.utils.ApplicationStringUtils" />--%>
<div class="breadcrumb_conatiner">
			<div class="col-md-6">
				<h4 class="change-color">Report</h4>
			</div>
			<div class="col-md-6">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a href="${contextPath}/home"><i class="fa fa-home"></i></a></li>
						<li class="breadcrumb-item active" aria-current="page">Report</li>
					</ol>
				</nav>
			</div>
		</div>
		
		
	
	<c:set value="0" var="sanctionedAmount"></c:set>
    <c:set value="0" var="utilizationAmount"></c:set>
    <c:set value="0" var="balanceAmount"></c:set>
	<%-- <c:set value="0" var="totalfundAvilable"></c:set>  --%>
		<div class="row mt--2">
			<div class="col-md-12">
				<div class="card full-height">
					<div class="card-header">
						<h4 class="card-title">U C Report</h4>
					</div>
					<div class="card-body">
						
						<form class="form-horizontal" action="${contextPath}/uc/filter" method="get" enctype="multipart/form-data" id="actionForm">
							<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
							<div class="row align-items-end">
								<div class="col-md-3">
									<div class="form-group">
										<label class="col-md-12 smallInput required" for="">Financial Year :</label>
										<div class="col-md-12">
											<select class="form-control form-select form-control-sm" id="finyearId" name="finyearId">
												<option value="">--Select--</option>
												 <c:forEach items="${lstFinyear}" var="finyear">
													<option value="${finyear.finyearId}"
														${finyear.finyearId eq finyearId ?'selected':'' }>${finyear.finYear}</option>
												 </c:forEach>
											</select>
										</div>
									</div>
								</div>
								<div class="col-md-3">
									<div class="form-group">
										<label class="col-md-12  required" for="">Scheme :</label>
										<div class="col-md-12">
											<select class="form-control form-select form-control-sm" id="schemeId" name="schemeId">
												<option value="">--Select--</option>
												<c:forEach items="${schemeList}" var="scheme">
													<option value="${scheme.schemeId}"
														${scheme.schemeId eq schemeId ?'selected':'' }>${scheme.schemeName}</option>
												</c:forEach>

											</select>
										</div>
									</div>
								</div>
								<div class="col-md-3">
								    <div class="form-group">
									    <button type="button" class="btn btn-success" id="fndrptId" onclick="getUcReportList();">Filter</button>
								    </div>
								</div>
					         </div>
					         <div class="col-md-12">
					<table class="table table-bordered table-hover mis-table" id="dynamicTable">
						<c:if test="${not empty expenditureReport}">
						<thead>
							<tr>
								<th class="text-center">Sl.No.</th>
								<!-- <th>District</th> -->
								<th>Sanction No</th>
								<th>Sanction Date</th>
								<th>Sanctioned Amount</th>
								<th>Utilization Amount</th>
								<!-- <th>Balance Amount</th> -->
							</tr>
						</thead>
						<tbody>
						
						<c:forEach items="${expenditureReport}" var="data" varStatus="serialNumber">
						<tr>
						<td class="text-center">${serialNumber.count}</td>
						<%-- <td class="text-right">${data.districtName}</td> --%>
						<td class="text-right">${data.sanctionNo}</td>
						<td><fmt:formatDate value="${data.transDate}" pattern="dd-MM-yyyy" /></td>
						<td class="text-right"><fmt:formatNumber type="number" groupingUsed="true" value="${data.amount}"/></td>
						<td class="text-right"><fmt:formatNumber type="number" groupingUsed="true" value="${data.usedAllocationAmount}"/></td>
						<%-- <td class="text-right"><fmt:formatNumber type="number" groupingUsed="true" value="${data.usedAllocationAmount}"/></td> --%>
						
						<c:set value="${totalopeningbalance + data.amount}" var="totalopeningbalance"></c:set>
						<c:set value="${totalfundDisbursed + data.usedAllocationAmount}"  var="totalfundDisbursed"></c:set>
						<%-- <c:set value="${totalfundUtilized + data.fundUtilized}"  var="totalfundUtilized"></c:set>
						<c:set value="${totalfundAvilable + data.fundAvilable}"  var="totalfundAvilable"></c:set>  --%>
						</tr>
						</c:forEach>
						</tbody>
						<tfoot>
						<tr>
						<td colspan="3" class="text-center">Total</td>
						<td class="text-right"><fmt:formatNumber type="number" groupingUsed="true" value="${totalopeningbalance}"/></td>
						<td class="text-right"><fmt:formatNumber type="number" groupingUsed="true" value="${totalfundDisbursed}"/></td>
					<%-- 	<td class="text-right"><fmt:formatNumber type="number" groupingUsed="true" value="${totalfundUtilized}"/></td>
						<td class="text-right"><fmt:formatNumber type="number" groupingUsed="true" value="${totalfundAvilable}"/></td> --%>
						</tr>
						</tfoot>
						</c:if>
						<c:if test="${empty expenditureReport}">
						<tbody>
						<tr>
						<td colspan="5"> No Data Found</td>
						</tr>
						</tbody>
						</c:if>
						</table>
						</div>
					 </form>
				</div>
			</div>
		</div>
	</div>
<script type="text/javascript">
	function getUcReportList() {
		if($("#finyearId").val()==""){
			bootbox.alert("Please select financial year.");
			return false;
		
		}else if($("#schemeId").val()==""){
			bootbox.alert("Please select scheme.");
			return false;
		}else{
			   $("#actionForm").submit();
			}
		}
			
</script>


