<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix = "fn" uri = "http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib uri = "http://java.sun.com/jsp/jstl/functions" prefix = "fn" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script src="${contextPath}/assets/appJs/validation/common-utils.js"></script>
<sec:authentication var="principal" property="principal" />
<c:set var="roleCode" value="${principal.primaryRole.roleCode}"/>


    
    <div class="breadcrumb_conatiner">
              <div class="col-md-6">
                <h4 class="change-color">Block Buildings</h4>
              </div>
              <div class="col-md-6">
                <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="${contextPath}/home">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Add Block building</li>
                </ol>
                </nav>
              </div>
            </div>
            
    
<div class="card">
          
        <div class="card-header"><h5 class="card-title">Add Block Buildings</h5></div>
    <div class="card-body">
    <form action="${contextPath}/facilityManagement/saveBuildingBlock" method="post" id="saveFormId" class="row">
        <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
        <input type="hidden" name="blockId" value="${blockUpdate.blockId}" id="blockId" />

        <div class="form-group col-md-2">
            <label class="required">Block Name</label>
            <input type="text" class="form-control form-control-sm" id="blockNameId" name="blockName" maxlength="20" value="${blockUpdate.blockName}">
        </div>
        
        <div class="form-group col-md-2">
             <label class="required" >Building:</label>
          	<select class="form-select" id="buildingId" name="buildingId.buildingId">
   				 <option value="0">-Select-</option>
				<c:forEach items="${buildingList}" var="building">
				 <option value="${building.buildingId}" ${building.buildingId eq blockUpdate.buildingId.buildingId ? 'selected' : ''  }>${building.buildingName}</option>										
				</c:forEach>
           	</select>
		</div>
										
         <div class="form-group col-md-2">
            <label class="required">No of Floors</label>
            <input type="text" class="form-control form-control-sm NumbersOnly" id="noOfFloorsId" name="noOfFloors" maxLength="3" value="${blockUpdate.noOfFloors}">
        </div>
        
        <div class="form-group col-md-2">
            <label class="required">Description</label>
            <input type="text" class="form-control form-control-sm" id="descriptionId" name="description" maxLength="30" value="${blockUpdate.description}">
        </div>
        
        <div class="form-group col-md-4 text-left">

            <button type="button" class="btn btn-submit searchdiv" style="margin-left: 8px;" onclick="submitForm('${empty blockUpdate.blockId ? 'SAVE' : 'UPDATE'}')">${empty blockUpdate.blockId ? 'Submit' : 'Update'}</button>
            <button type="button" class="btn btn-back searchdiv" style="margin-left: 8px;" onclick="history.back()" >Back</button>

        </div>
    </form>
</div>
</div>


<div class="card cardContainerNotFirst">
  <div class="card-header"><h5 class="card-title">Block List</h5></div>
 
	 <div class="card-body">	 
		<table class="datatable table table-striped table-bordered exportbtn">
	    	<thead>
		        <tr>
		            <th>Sl.No</th>
		            <th>Block Name</th>
		            <th>Building</th>
		            <th>Action</th>
		        </tr>
	    	</thead>
	    	<tbody>
		        <c:forEach items="${blockList}" var="block" varStatus="count">
		            <tr>
		                <td>${count.count}</td>
		                <td>${block.blockName}</td>
		                <td>${block.buildingId.buildingName}</td>
		                <td>
						 <a href="${contextPath}/facilityManagement/editBuildingBlock?hdnId=${block.blockId}"class="btn btn-primary" title="edit">
								 <i class=" fa fa-pen " aria-hidden="true"></i></a> 
					    </td>
		            </tr>
		        </c:forEach>
	    	</tbody>
		</table>
	</div>
</div>

<script>
function submitForm(status) {
    if ($("#blockNameId").val().trim() == "") {
        bootbox.alert("Please provide a Block name");
        $("#blockNameId").val('');
        return false;
    } else if ($("#buildingId").val() == "0" || $("#buildingId").val() == null) {
        bootbox.alert("Please select Building");
        $("#buildingId").val('');
        return false;
    } else if ($("#noOfFloorsId").val().trim() == "") {
        bootbox.alert("Please provide Number of Floors");
        $("#noOfFloorsId").val('');
        return false;
    } else if ($("#descriptionId").val().trim() == "") {
        bootbox.alert("Please provide Description");
        $("#descriptionId").val('');
        return false;
    } else { var message = status === 'SAVE' ? 'save' : 'update';
	 bootbox.confirm("Do you want to "+message+" Blocks details ?", function (result) {
            if (result) {
                showLoader();
                $("#saveFormId").submit();
            }
        });
    }
}
</script>


