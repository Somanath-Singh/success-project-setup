<%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<link href="${contextPath}/assets/css/dashboard.css" rel="stylesheet" type="text/css" />
<script src="${contextPath}/assets/appJs/validation/common-utils.js"></script>

<!-- Breadcrumb -->
<%-- <div class="breadcrumb_conatiner">
    <div class="col-md-6"><h4 class="change-color">Add Asset Details</h4></div>
    <div class="col-md-6">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="${contextPath}/home"><i class="fa fa-home"></i></a>
                </li>
                <li class="breadcrumb-item active">Add Asset Details</li>
            </ol>
        </nav>
    </div>
</div> --%>

<!-- Card Form -->
<div class="card mt-3">
    <div class="card-header">
        <c:choose>
            <c:when test="${not empty assetData}">
                <h5 class="card-title">Update Asset</h5>
            </c:when>
            <c:otherwise>
                <h5 class="card-title">Save Asset</h5>
            </c:otherwise>
        </c:choose>
    </div>
    <div class="card-body">
        <form action="${contextPath}/manageAsset/save" id="assetForm" method="post" enctype="multipart/form-data">
            <input type="hidden" id="cipherText" name="cipherText">
            <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
            <input type="hidden" id="assetManagementId" name="assetManagementId" value="${assetData.assetManagementId}" />

            <div class="row">

				<div class="col-md-3">
					<div class="form-group">
						<label class="required">Building Type :</label> <select
							id="buildingType" name="buildingType"
							class="form-control form-control-sm form-select" onchange="getBuildingNameByBuildingType(this.value,'buildingId');" required>

							<option value="" selected>- Select -</option>

							<c:forEach var="buildType" items="${buildingTypeList}">
								<option value="${buildType.valueEn}"
									${assetData.buildingType == buildType.valueEn ? 'selected' : ''}>
									${buildType.valueEn}</option>
							</c:forEach>
						</select>
					</div>
				</div>
				<div class="col-md-3">
					<div class="form-group">
						<label class="required">Building Name:</label> <select
							id="buildingId" name="buildingId"
							class="form-control form-control-sm form-select" required>
							<option value="" selected>- Select -</option>
							<%-- <c:forEach var="building" items="${buildingList}">
								<option value="${building.buildingName}"
									${assetData.buildingName == building.buildingName ? 'selected' : ''}>
									${building.buildingName}</option>
							</c:forEach> --%>
						</select>
					</div>
				</div>
				<!-- Asset Category -->
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="required">Asset Category :</label>
                        <select
							id="assetId" name="assetId"
							class="form-control form-control-sm form-select" required>

							<option value="" selected>- Select -</option>

							<c:forEach var="assetCategoryType" items="${assetCategoryList}">
								<option value="${assetCategoryType.assetId}"
									${assetCategoryType.assetId == assetData.assetId ? 'selected' : ''}>
									${assetCategoryType.assetName}</option>
							</c:forEach>
						</select>
                    </div>
                </div>



				<div class="form-group col-md-3">
					<label>Asset Image :</label>
					<div class="col-md-12 position-relative">
						<input type="file" id="document" name="assetImage" accept=".jpg,.jpeg,.png"
							class="form-control form-control-sm  ${assetData.assetId ne null ? 'freeze' : ''}" onchange="uploadFileCheck(this)">
						<c:if
							test="${not empty assetData.assetImagePath}">
							<button type="button"
								class="btn btn-sm btn-primary position-absolute"
								style="right: 0px; top: 0px;border: none;padding: 7px 9px;"
								onclick="viewDoc('${assetData.assetImagePath}','ASSET_IMG')"
								title="Download Document">
								<i class="fa-regular fa-eye"></i>
							</button>
							<span style="font-size: 10px; color: #29a8ff; font-weight: 600;">${assetData.assetImagePath}</span>
						</c:if>
						<div id="selectedFileName" class="mt-1 text-muted"
							style="font-size: 0.9em;"></div>
					</div>
				</div>				 
                
                <div class="col-md-3">
					<div class="form-group">
						<label class="required">Asset Condition :</label> <select
							id="assetCondition" name="assetCondition"
							class="form-control form-control-sm form-select" required>

							<option value="" selected>- Select -</option>

							<c:forEach var="assetConditionType" items="${assetConditions}">
								<option value="${assetConditionType.valueEn}"
									${assetData.assetCondition == assetConditionType.valueEn ? 'selected' : ''}>
									${assetConditionType.valueEn}</option>
							</c:forEach>
						</select>
					</div>
				</div>
				 <div class="col-md-3">
                    <div class="form-group">
                        <label class="required">Hostel Furnished :</label>
                        <select
							id="hostelFurnished" name="hostelFurnished"
							class="form-control form-control-sm form-select" required>

							<option value="" selected>- Select -</option>
							<option value="Yes" ${assetData.hostelFurnished =='Yes'  ? 'selected' : ''}>Yes</option>
							<option value="No" ${assetData.hostelFurnished =='No'  ? 'selected' : ''}>No</option>														
							
						</select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="required">No of Classrooms :</label>
                        <input type="number"  id="numberOfClassrooms" name="numberOfClassrooms"
                               value="${assetData.numberOfClassrooms}" class="form-control form-control-sm" oninput="validateInput(this);"  required />
                           <span id="classroomError" class="text-danger" style="font-size:12px;"></span>
                       
                    </div>
                </div>
                               
                
              <%--   <div class="col-md-3">
                    <div class="form-group">
                        <label class="required">ClassRoom Size(Sq. Ft.) :</label>
                        <input type="number"  id="classroomSize" name="classroomSize" placeholder="e.g. 450"
                               value="${assetData.classroomSize}" class="form-control form-control-sm" oninput="validateInput(this);" required />
                    </div>
                </div> --%>
               <%--  <div class="col-md-3">
					<div class="form-group">
						<label class="required" for="capacity"> Strength/Capacity
							:</label> <input type="text" id="capacity" name="capacity"
							class="form-control form-control-sm NumbersOnly" required
							maxlength="15" value="${assetData.capacity}">
					</div>
				</div> --%>
              
				<%-- Functional Date --%>
				<div class="form-group col-md-3">
					<label class="required"> Functional Date :</label>
					<div class="datepicker-box">
						<input type="text" id="functionalDate" name="functionalDate"
							class="form-control form-control-sm datepicker" required
							value="${assetData.functionalDate}" readonly>
					</div>
				</div>

				<%-- Handover Date --%>
				<div class="form-group col-md-3">
					<label class="required">HandOver date :</label>
					<div class="datepicker-box">
						<input type="text" id="handoverDate" name="handoverDate"
							class="form-control form-control-sm datepicker" required
							value="${assetData.handoverDate}" readonly>
					</div>
				</div>


				<!-- Classroom Dynamic Table -->
				<div class="col-md-12 mt-3">
					<div class="card-header mb-3" style="padding-left: 0;">
						<h5 class="card-title">Room Details</h5>
					</div>
					<table class="table table-bordered table-hover classroom-table" id="classroomTable">
						<thead class="table-light">
							<tr>
								<th class="">Room Name<span class="text-danger">*</span></th>
								<th>Width (ft)<span class="text-danger">*</span></th>
								<th>Length (ft)<span class="text-danger">*</span></th>
								<th>Room Size(Sq. Ft.)<span class="text-danger">*</span></th>
								<th>Capacity/Strength<span class="text-danger">*</span></th>																								
								<th>Upload Document<span class="text-danger">*</span></th>
							</tr>
						</thead>
						<tbody id="classroomBody">
							<c:if test="${not empty assetData.classroomList}">
								<c:forEach var="room" items="${assetData.classroomList}" varStatus="i">
									<tr
										class="${not empty room.documentPath ? 'old-row' : 'new-row'}">

										<!-- Hidden classroomId -->
										<td><input type="hidden"
											name="classroomList[${i.index}].classroomId"
											value="${room.classroomId}"> <input type="text"
											name="classroomList[${i.index}].classroomName"
											value="${room.classroomName}" maxlength="50"
											class="form-control form-control-sm" required></td>

										<td><input type="number"
											name="classroomList[${i.index}].width" value="${room.width}"
											class="form-control form-control-sm" required></td>

										<td><input type="number"
											name="classroomList[${i.index}].length"
											value="${room.length}" class="form-control form-control-sm" 
											required></td>


										<td><input type="number"
											name="classroomList[${i.index}].classroomSize"
											value="${room.classroomSize}"
											class="form-control form-control-sm" readonly required></td>
											
										<td><input type="number"
											name="classroomList[${i.index}].capacity"
											value="${room.capacity}"
											class="form-control form-control-sm" required></td>	

										<td>
											<div class="position-relative">
												<input type="file"
													name="classroomList[${i.index}].documentUpload"
													class="form-control form-control-sm">

												<c:if test="${not empty room.documentPath}">
													<button type="button"
														class="btn btn-sm btn-primary position-absolute"
														style="right: 0px; top: 0px;border: none;padding: 6px 9px;"
														onclick="viewDoc('${room.documentPath}','CLASSROOM_DOC')">
														<i class="fa-regular fa-eye"></i>
													</button>

													<div
														style="font-size: 10px;color: #0097ff;font-weight: 600;">
														${room.documentPath}</div>
												</c:if>
											</div>
										</td>

									</tr>

								</c:forEach>
							</c:if>
						</tbody>

					</table>
				</div>


			</div>

            <!-- Buttons -->
            <div class="text-end mt-4">
                <c:choose>
                    <c:when test="${not empty assetData}">
<!--                         <input type="button" value="Update Asset" class="btn btn-success btn-sm" onclick="submitAssetData()"> -->
                        <button type="button" class="btn btn-success btn-sm" onclick="submitAssetData()"><i class="fa fa-save me-1"></i> Update</button>
                        <a href="javascript:void()" onclick="history.back();" class="btn btn-warning btn-sm"><i class="fa fa-rotate-left"></i> Back</a>
                    </c:when>
                    <c:otherwise>
<!--                         <input type="button" value="Save Asset" class="btn btn-success btn-sm" onclick="submitAssetData()"> -->
                        <button type="button" class="btn btn-success btn-sm" onclick="submitAssetData()"><i class="fa fa-save me-1"></i> Save</button>
                        <a href="javascript:void()" onclick="history.back();" class="btn btn-warning btn-sm"><i class="fa-solid fa-rotate-left"></i> Back</a>
                    </c:otherwise>
                </c:choose>
            </div>
        </form>
    </div>
</div>

<form action="${contextPath}/manageAsset/viewFile" method="get" id="documentFormView" target="_blank">
    <input type="hidden" name="cipherText" id="cipherTextView">
    <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
    <input type="hidden" name="fileName" id="fileName" />
    <input type="hidden" name="moduleName" id="moduleName" />
</form>


<!-- Scripts -->
<script>

function submitAssetData() {
	debugger;
    var buildingType = $("#buildingType").val();
    var buildingId = $("#buildingId").val();
    var assetId = $("#assetId").val();
    var numberOfClassrooms = $("#numberOfClassrooms").val();
    var hostelFurnished = $("#hostelFurnished").val();
    var assetCondition = $("#assetCondition").val();
    var functionalDate = $("#functionalDate").val();
    var handoverDate = $("#handoverDate").val();
    var capacity = $("#capacity").val();


    if (!buildingType || buildingType.trim() === "") {
        bootbox.alert("Please select Building Type");
        $("#buildingType").focus();
        return false;
    }

    else if (!buildingId || buildingId.trim() === "") {
        bootbox.alert("Please select Building Name");
        $("#buildingId").focus();
        return false;
    }

    else if (!assetId || assetId.trim() === "") {
        bootbox.alert("Please select Asset Category");
        $("#assetId").focus();
        return false;
    }

    else if (!assetCondition || assetCondition.trim() === "") {
        bootbox.alert("Please select Asset Condition");
        $("#assetCondition").focus();
        return false;
    }

    else if (!hostelFurnished || hostelFurnished.trim() === "") {
        bootbox.alert("Please select whether the hostel is furnished");
        $("#hostelFurnished").focus();
        return false;
    }
    
    else if (!numberOfClassrooms || isNaN(numberOfClassrooms) || parseInt(numberOfClassrooms) <= 0) {
        bootbox.alert("Please enter a valid number of rooms");
        $("#numberOfClassrooms").focus();
        return false;
    }
   /*  else if (!capacity || capacity==null ||isNaN(capacity)) {
        bootbox.alert("Please enter the capacity");
        $("#capacity").focus();
        return false;
    }
     */

   
    else if (!functionalDate || functionalDate.trim() === "") {
        bootbox.alert("Please select Functional Date");
        $("#functionalDate").focus();
        return false;
    }

    else if (!handoverDate || handoverDate.trim() === "") {
        bootbox.alert("Please select HandOver Date");
        $("#handoverDate").focus();
        return false;
    }else{
    	
    	if(validateClassroomForm()){
    		 submitAssetForm();
    	}
    	
    }
           
}





function submitAssetForm() {

    let classroomList = [];
    $("#classroomBody tr").each(function () {
        classroomList.push({
        	classroomId: $(this).find('input[name*=".classroomId"]').val(),
            classroomName: $(this).find('input[name*=".classroomName"]').val(),
            classroomSize: $(this).find('input[name*=".classroomSize"]').val(),
            width: $(this).find('input[name*=".width"]').val(),
            length: $(this).find('input[name*=".length"]').val(),
            capacity: $(this).find('input[name*=".capacity"]').val()

        });
    });

    let assetData = {
        buildingType: $("#buildingType").val(),
        buildingId: $("#buildingId").val(),
        assetId: $("#assetId").val(),
        numberOfClassrooms: $("#numberOfClassrooms").val(),
        classroomSize: $("#classroomSize").val(),
        hostelFurnished: $("#hostelFurnished").val(),
        assetCondition: $("#assetCondition").val(),
        functionalDate: $("#functionalDate").val(),
        handoverDate: $("#handoverDate").val(),
        //capacity: $("#capacity").val(),
        assetManagementId: $("#assetManagementId").val(),
        classroomList: classroomList
    };

    $("#cipherText").val(enc_password(JSON.stringify(assetData)));
    bootbox.confirm("Do You Want To Continue?", function(result) {
        if (result) {
            $("#assetForm").submit();
        }
    });
}
    
    <%-- Datepicker Initialization for Functional & Handover Dates --%>
    $(document).ready(function () {
        $(".datepicker").datepick({
            onShow: $.datepick.monthOnly,
            dateFormat: "dd-mm-yyyy",
            yearRange: "c-20:c+10",
            showOnFocus: true,
            showTrigger: '<button type="button" class="trigger"><i class="fa fa-calendar"></i></button>',
            onSelect: function () {
                applyDateLimits();
            }
        });

        function parseDate(str) {
            if (!str) return null;
            var parts = str.split("-");
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }

        function formatDate(date) {
            let dd = String(date.getDate()).padStart(2, '0');
            let mm = String(date.getMonth() + 1).padStart(2, '0');
            let yyyy = date.getFullYear();
            return dd + '-' + mm + '-' + yyyy;
        }

        function applyDateLimits() {
            const functionalDate = parseDate($('#functionalDate').val());
            const handoverDate = parseDate($('#handoverDate').val());

            if (functionalDate) {
                $('#handoverDate').datepick('option', 'minDate', functionalDate);
            }
        }

        applyDateLimits();

        $('#functionalDate').on('change', function () {
            applyDateLimits();
        });
    });
    
    
      var selectedBuildingId = "${assetData.buildingId}";
     function getBuildingNameByBuildingType(buildingType, targetId) {
        $.ajax({
            type: "GET",
            url: "${contextPath}/manageAsset/getBuildingDetails",
            data: { buildingType: buildingType },
            success: function (buildingData) {
                var $buildingSelect = $("#" + targetId);
                $buildingSelect.empty();
                $buildingSelect.append('<option value="" selected disabled>- Select -</option>');
                
                $.each(buildingData, function (index, building) {
                    $buildingSelect.append('<option value="' + building.buildingId + '">' + building.buildingName + '</option>');
                });
                
                if (selectedBuildingId) {
                    $buildingSelect.val(selectedBuildingId);
                }
            },
            error: function () {
                alert("Error loading building details!");
            }
        });
    } 
    
    $(document).ready(function() {
        var buildingType = $("#buildingType").val(); 
        if (buildingType) {
            getBuildingNameByBuildingType(buildingType, "buildingId");
        }
    });

    function viewDoc(fileName, moduleName) {

        $("#fileName").val(fileName);
        $("#moduleName").val(moduleName);

        let jsonData = {
            fileName: fileName,
            moduleName: moduleName,
            _csrf: $("input[name='_csrf']").val()  
        };

        let encrypted = enc_password(JSON.stringify(jsonData));

        $("#cipherTextView").val(encrypted);
        $("#documentFormView").submit();
    }


   
    
    function uploadFileCheck(input) {
        if (!input.files || input.files.length === 0) return;

        const file = input.files[0];
        const fileName = file.name.toLowerCase();
        const fileSize = file.size;
        const maxSize = 512000; // 500 KB
        
        const extension = fileName.substring(fileName.lastIndexOf('.') + 1);

        const allowedExtensions = ['jpg', 'jpeg', 'png'];

        if (!allowedExtensions.includes(extension)) {
            alert("Only image files (.jpg, .jpeg, .png) are allowed.");
            input.value = "";  
            return false;
        }

        if (fileSize > maxSize) {
            alert("Image size must not exceed 500 KB.");
            input.value = "";
            return false;
        }

        return true;
    }


   /*      
    function validateInput(that) {
        let val = $(that).val().replace(/\D/g, "");  

        if (val.length > 2) {
            val = val.slice(0, 2);
        }

        $(that).val(val);
    } */

    function validateInput(that) {
        let val = $(that).val().replace(/\D/g, "");
        let errorSpan = $("#classroomError");

        errorSpan.text("");

        if (val.length > 2) {
            val = val.slice(0, 2);
        }

        $(that).val(val);

        if (val === "") {
            errorSpan.text("Value must be between 1 and 99.");
        }
        else if (val < 1 || val > 99) {
            errorSpan.text("Value must be between 1 and 99.");
        }

    }

     
 
 var isEdit = ${assetData != null};

 $(document).ready(function () {

     $("#numberOfClassrooms").on("input", function () {
         let desired = parseInt($(this).val()) || 0;
         let current = $("#classroomBody tr").length;

         if (desired > current) {
             for (let i = current; i < desired; i++) {
                 createClassroomRow(i);
             }
             reindexClassroomRows();
         }
        
         if (isEdit) {
        	 if (desired < current) {
                 bootbox.alert("Number of classrooms must be greater than or equal to current rows (" + current + ").");
                 
             }
             return;
         }

         
         if (!isEdit && desired < current) {
             for (let i = current; i > desired; i--) {
                 $("#classroomBody tr:last-child").remove();
             }
             reindexClassroomRows();
         }
     });

 });

    /* var isEdit = ${assetData != null}; 
    $(document).ready(function () {

        if (!isEdit) {
            $("#numberOfClassrooms").trigger("input");
        }

    }); */

  function createClassroomRow(i) {
    let html = `
        <tr>
            <td>
                <input type="hidden" name="classroomList[${i}].classroomId" value="">

                <input type="text"
                       name="classroomList[${i}].classroomName"
                       class="form-control form-control-sm"
                       placeholder="Name" maxlength="50" required>
            </td>

            <td>
                <input type="number" 
                       name="classroomList[${i}].width"
                       class="form-control form-control-sm"
                       min="1" placeholder="Width" required>
            </td>

            <td>
                <input type="number" 
                       name="classroomList[${i}].length"
                       class="form-control form-control-sm"
                       min="1" placeholder="Length" required>
            </td>
            <td>
            <input type="number" 
                   name="classroomList[${i}].classroomSize"
                   class="form-control form-control-sm"
                   min="1" placeholder="Room Size(Sq. Ft.)" readonly required>
           </td>
           <td><input type="number"
				name="classroomList[${i}].capacity"				
				class="form-control form-control-sm" placeholder="Strength/Capacity" required>
           </td>	
           
            <td>
                <input type="file" 
                       name="classroomList[${i}].documentUpload"
                       class="form-control form-control-sm">
            </td>
        </tr>
    `;
    $("#classroomBody").append(html);
}

    $(document).ready(function () {
    	
        $('#classroomBody').on('input', 'input[name*=".width"], input[name*=".length"]', function () {

            let row = $(this).closest('tr');
            let width = parseFloat(row.find('input[name*=".width"]').val()) || 0;
            let length = parseFloat(row.find('input[name*=".length"]').val()) || 0;

            let size = width * length;
            row.find('input[name*=".classroomSize"]').val(size > 0 ? size : "");
        });
    	
    	
    });
    
    
    function reindexClassroomRows() {
        $('#classroomBody tr').each(function (index) {
        	$(this).find('input[name*=".classroomId"]').attr("name", "classroomList[" + index + "].classroomId");
            $(this).find('input[name*=".classroomName"]').attr("name", "classroomList[" + index + "].classroomName");
            $(this).find('input[name*=".classroomSize"]').attr("name", "classroomList[" + index + "].classroomSize");
            $(this).find('input[name*=".width"]').attr("name", "classroomList[" + index + "].width");
            $(this).find('input[name*=".length"]').attr("name", "classroomList[" + index + "].length");
            $(this).find('input[name*=".capacity"]').attr("name", "classroomList[" + index + "].capacity");
            $(this).find('input[name*=".documentUpload"]').attr("name", "classroomList[" + index + "].documentUpload");
        });
    }

       $('#classroomBody').on('change', 'input', function () {
        let row = $(this).closest('tr');
        let index = row.index() + 1;

        let nameField   = row.find('input[name*=".classroomName"]');
        let roomSizefield   = row.find('input[name*=".classroomSize"]');
        let widthField  = row.find('input[name*=".width"]');
        let lengthField = row.find('input[name*=".length"]');
        let capacityField = row.find('input[name*=".capacity"]');
        let docField    = row.find('input[name*=".documentUpload"]');
 			
         if ($(this).is(widthField)) {
            if (!nameField.val()) {
                bootbox.alert("Please enter room Name in Row " + index);
                nameField.focus();
                return false;
            }
        }

        if ($(this).is(lengthField)) {
            if (!nameField.val()) {
                bootbox.alert("Please enter room Name in Row " + index);
                nameField.focus();
                return false;
            }
            if (!widthField.val()) {
                bootbox.alert("Please enter Width in Row " + index);
               widthField.focus();
                return false;
            }
        }
        
        if ($(this).is(roomSizefield)) {
            if (!nameField.val()) {
                bootbox.alert("Please enter room Name in Row " + index);
                nameField.focus();
                return false;
            }
            if (!widthField.val()) {
                bootbox.alert("Please enter Width in Row " + index);
                widthField.focus();
                return false;
            }
            if (!lengthField.val()) {
                bootbox.alert("Please enter Length in Row " + index);
                lengthField.focus();
                return false;
            }
        }

        if ($(this).is(docField)) {
            if (!nameField.val()) {
                bootbox.alert("Please enter room Name in Row " + index);
                nameField.focus();
                return false;
            }
            if (!widthField.val()) {
                bootbox.alert("Please enter Width in Row " + index);
                widthField.focus();
                return false;
            }
            if (!lengthField.val()) {
                bootbox.alert("Please enter Length in Row " + index);
                lengthField.focus();
                return false;
            }
            
            if (!roomSizefield.val()) {
                bootbox.alert("Please enter Room Size in Row " + index);
                roomSizefield.focus();
                return false;
            }
            
            if (!capacityField.val()) {
                bootbox.alert("Please enter Capacity/Strength in Row " + index);
                roomSizefield.focus();
                return false;
            }
        } 
        
    });  
    
        
    
       function validateClassroomForm() {
    	    let isValid = true;
    	    let errorMessage = "";

    	    $("#classroomBody tr").each(function (index) {

    	        let nameField   = $(this).find('input[name="classroomList[' + index + '].classroomName"]');
    	        let widthField  = $(this).find('input[name="classroomList[' + index + '].width"]');
    	        let lengthField = $(this).find('input[name="classroomList[' + index + '].length"]');
    	        let sizeField   = $(this).find('input[name="classroomList[' + index + '].classroomSize"]');
    	        let capacityField   = $(this).find('input[name="classroomList[' + index + '].capacity"]');
    	        let docField    = $(this).find('input[name="classroomList[' + index + '].documentUpload"]');

    	        if (!nameField.val()) {
    	            errorMessage = "Please enter room Name in row " + (index + 1);
    	            isValid = false;
    	            return false;
    	        }
    	        else if (!widthField.val()) {
    	            errorMessage = "Please enter Width in row " + (index + 1);
    	            isValid = false;
    	            return false;
    	        }
    	        else if (!lengthField.val()) {
    	            errorMessage = "Please enter Length in row " + (index + 1);
    	            isValid = false;
    	            return false;
    	        }
    	        else if (!sizeField.val()) {
    	            errorMessage = "Please enter Classroom Size in row " + (index + 1);
    	            isValid = false;
    	            return false;
    	        }
    	        else if (!capacityField.val()) {
    	            errorMessage = "Please enter Capacity/Strength in row " + (index + 1);
    	            isValid = false;
    	            return false;
    	        }

    	        else if (!docField.val()) {
    	            errorMessage = "Please upload document for row " + (index + 1);
    	            isValid = false;
    	            return false;
    	        }

    	    });

    	    if (!isValid) {
    	        bootbox.alert(errorMessage);
    	        return false;
    	    }

    	    return true;
    	}

    
       	       	
      $('#classroomBody').on('focus', 'input', function () {

        let currentRow = $(this).closest('tr');
        let prevRow = currentRow.prev('tr');

        if (prevRow.length === 0) return; 

        let index = prevRow.index() + 1;

        let nameVal     = prevRow.find('input[name*=".classroomName"]').val();
        let roomSizeval     = prevRow.find('input[name*=".classroomSize"]').val();
        let widthVal    = prevRow.find('input[name*=".width"]').val();
        let lengthVal   = prevRow.find('input[name*=".length"]').val();
        let capacityVal   = prevRow.find('input[name*=".capacity"]').val();
        let docVal      = prevRow.find('input[name*=".documentUpload"]').val();

        if (!nameVal || !widthVal || !lengthVal || !docVal) {
            bootbox.alert("Please complete all fields in Row " + index);

            if (!nameVal)      prevRow.find('input[name*=".classroomName"]').focus();
            else if (!widthVal)    prevRow.find('input[name*=".width"]').focus();
            else if (!lengthVal)   prevRow.find('input[name*=".length"]').focus();
            else if (!roomSizeval)   prevRow.find('input[name*=".classroomSize"]').focus();
            else if (!roomSizeval)   prevRow.find('input[name*=".capacityField"]').focus();
            else if (!docVal)      prevRow.find('input[name*=".documentUpload"]').focus();

            return false;
        }

    }); 

    
</script>




