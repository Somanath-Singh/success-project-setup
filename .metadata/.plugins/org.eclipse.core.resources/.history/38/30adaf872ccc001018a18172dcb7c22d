<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script src="${contextPath}/assets/js/commonFunctions.js"></script>

<style>
	.position-relative{
        width: 120px;
        height: 120px;
        overflow: hidden;
        margin-bottom: 10px;
        margin-top: 10px;
        background: #e7eaf2;
        padding: 10px;
        position: relative;
    }
    .zoom-gallery .inputFile .inputMedia{
        width: 100px;
        height: 100px;
    }
    .position-relative button{
        position: absolute;
        right: 0;
        top: 0;
        color: #ff0000;
        padding: 5px;
        background: #000;
        border-radius: 50%;
        height: 20px;
        width: 20px;
        z-index:1;
    }
    .position-relative button.float-end i{
        font-size: 14px;
        line-height: normal;
        position: absolute;
        top: 50%;
        right: 2px;
        transform: translatey(-50%);
    }
    .mfp-zoom-out-cur aside{
        z-index: 111 !important;
    }
    button.mfp-arrow {
        display: none;
    }
</style>
<c:set var="rowcount" value="0" />
<div class="breadcrumb_conatiner">
	<div class="col-md-6">
		<h4 class="change-color">Add Item</h4>
	</div>
	<div class="col-md-6">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="${contextPath}/home"><i class="fa fa-home"></i></a></li>
				<li class="breadcrumb-item"><a href="#">Procurement</a></li>
				<li class="breadcrumb-item active" aria-current="page">Add Item</li>
			</ol>
		</nav>
	</div>
</div>

<div class="row">
	<div class="col-md-12">

		<div class="card">
			<div class="card-header">
				<h5 class="card-title">Add Item</h5>
			</div>
			<div class="card-body">
				<form method="POST"
					action="${contextPath}/inventory/store/item/save" id="addItemFrm"
					enctype="multipart/form-data">
					<input type="hidden" name="${_csrf.parameterName}"
						value="${_csrf.token}" /> <input type="hidden" id="itemId"
						name="itemId" value="${item.itemId }">
					<div class="row">
						<div class="col-md-12">
							<div class="row">
								<div class="form-group col-md-3">
									<label for="inputEmail4" class="required">Stock Type: </label>
									<c:choose>
										<c:when test="${lstStkTyp.size() > 1}">
											<select class="form-select requiredField"
												aria-label="Default select example" id="stockType"
												name="stockType.stockTypeId" readonly>
												<option value="">-Select-</option>
												<c:forEach items="${lstStkTyp}" var="stkTyp">
													<option value="${stkTyp.stockTypeId}"
														${stkTyp.stockTypeCode eq 'ITEM' ? 'selected' :''}>${stkTyp.stockTypeName}</option>
												</c:forEach>
											</select>
										</c:when>
										<c:otherwise>
											<input type="hidden" name="stockType.stockTypeId"
												value="${lstStkTyp[0].stockTypeId}" />
											<input type="text"
												class="form-control form-control-sm requiredField"
												id="stockType" value="${lstStkTyp[0].stockTypeName}"
												readonly="readonly" />
										</c:otherwise>
									</c:choose>
								</div>
								<div class="form-group col-md-3">
									<label for="inputEmail4" class="required">Category: </label> <select
										class="form-select form-control form-control-sm  requiredField"
										aria-label="Default select example" id="category"
										name="category.categoryId"
										onchange="getSubCategoryDetailsByCategoryiD(this.value)">
										<option value="">-Select-</option>
										<c:forEach items="${lstCat}" var="cat">
											<option value="${cat.categoryId}"
												${cat.categoryId eq item.category.categoryId ? 'selected' :''}>${cat.categoryName}</option>
										</c:forEach>
									</select>
								</div>
								<div class="form-group col-md-3">
									<label for="inputEmail4" class="required">Sub Category:
									</label> <select
										class="form-select form-control form-control-sm requiredField"
										aria-label="Default select example" id="subcategory"
										name="subCategory.subCategoryId">
										<option value="">-Select-</option>
										<c:if test="${not empty item}">
											<c:forEach items="${lstSubCat}" var="subcat">
												<option value="${subcat.subCategoryId}"
													${subcat.subCategoryId eq item.subCategory.subCategoryId ? 'selected' :''}>${subcat.subCategoryName}</option>
											</c:forEach>
										</c:if>
									</select>
								</div>
								<div class="form-group col-md-3">
									<label class="col-md-12 required" for="text">Item Name:
									</label> <input
										class="form-control form-control form-control-sm requiredField"
										type="text" id="itemName" name="itemName"
										placeholder="Enter Item name" value="${item.itemName}"
										maxlength="30">
								</div>
								<div class="form-group col-md-3">
									<label class="col-md-12 required" for="text">Item Code:
									</label> <input
										class="form-control form-control form-control-sm  requiredField"
										type="text" name="itemCode" id="itemCode"
										placeholder="Enter Item code" value="${item.itemCode}"
										maxlength="30">
								</div>
								<div class="form-group ${not empty item.itemId ? 'col-md-2' : 'col-md-3' }">
									<label for="inputEmail4" class="required">Item Type: </label>
									<c:choose>
										<c:when test="${lstItmTyp.size() > 1}">
											<select class="form-select"
												aria-label="Default select example" id="itemType"
												name="itemType.itemTypeId">
												<option value="">-Select-</option>
												<c:forEach items="${lstItmTyp}" var="itemType">
													<option value="${itemType.itemTypeId}"
														${itemType.itemTypeId eq item.itemType.itemTypeId ? 'selected' :''}>${itemType.itemTypeName}</option>
												</c:forEach>
											</select>
										</c:when>
										<c:otherwise>
											<input type="hidden" name="itemType.itemTypeId"
												value="${lstItmTyp[0].itemTypeId}" />
											<input type="text" class="form-control form-control-sm"
												id="itemType" value="${lstItmTyp[0].itemTypeName}"
												readonly="readonly" />
										</c:otherwise>
									</c:choose>
								</div>
								<div class="form-group ${not empty item.itemId ? 'col-md-2' : 'col-md-3' }">
									<label for="inputEmail4" class="required">UOM : </label> <select
										class="form-select form-control form-control-sm  requiredField"
										aria-label="Default select example" id="uom" name="uom.uomId">
										<option value="">-Select-</option>
										<c:forEach items="${lstUom}" var="uom">
											<option value="${uom.uomId}"
												${uom.uomId eq item.uom.uomId ? 'selected' :''}>${uom.uom}</option>
										</c:forEach>
									</select>
								</div>
								<div class="form-group col-md-3">
									<label class="col-md-12" for="text">Description:</label>
									<textarea rows="1" class="textArea  form-control form-control-sm "
										name="description" id="description"
										placeholder="Enter Description" style="" maxlength="100">${item.description} </textarea>
								</div>

								<c:if test="${not empty item.itemId}">
									<div class="form-group col-md-2 toggleTrueFalse" style="margin-left:15px;margin-top: 20px !important;"
										data-label-on="True" data-label-off="False"
										data-toggle-width="90">
										<input type="checkbox" value="${item.active}"
											class="toggleCheckBox"
											${item.active == 'true' ? 'checked' : ''}
											id="parametros_MOSTRAPEDIDOS" name="active" /> <label
											class="clickToggle" for="parametros_MOSTRAPEDIDOS"></label>
									</div>
								</c:if>

							</div>
							<div class="row">
								<div class="img-t-gal d-flex gap-4 zoom-gallery">
									<c:forEach items="${itemImgList}" var="urls" >
										<div class="position-relative">
											<button title="" type="button" class="float-end" onclick="removeImg(this,${urls.attachmentId})"><i class="fa-solid fa-xmark"></i></button>
			
											<a href="data:image/png;base64 ,${urls.attachmentPath}" class="inputFile">
													<img class="inputMedia" alt="doc" src="data:image/png;base64 ,${urls.attachmentPath}">
												</a>
										</div>
									</c:forEach>
								</div>
							</div>
							<div class="row" id="img">
								<div class="form-group col-md-3 " style="position: relative;" id="imgRow0">
									<label class="col-md-12 " for="text">Attachment File:</label>
									<input class="form-control form-control-sm " type="file" id="image0" name="itemImages[0].attachmentFile" placeholder="Enter Attachment Name" value="" maxlength="100" onchange="checkFileValidate(this)">
									<button type="button" class="btn-pluse position-absolute"
										id="btn_add_multiShop" onclick="addNewImage()" data-toggle="tooltip" data-placement="top" style="bottom: 3px;right: 15px;padding: 3px 8px;" title="Add More Image">
										<i class='fa fa-plus'></i>
									</button>
								</div>
							</div>

							<!-- 				tab section -->

							<nav>
								<div class="nav nav-tabs mb-2 tabnav" id="nav-tab"
									role="tablist">
									<button class="nav-link active" id="nav-profile-tab"
										data-bs-toggle="tab" data-bs-target="#nav-stock" type="button"
										role="tab" aria-controls="nav-profile" aria-selected="false">Stock</button>
									<button class="nav-link" id="nav-contact-tab"
										data-bs-toggle="tab" data-bs-target="#nav-attch" type="button"
										role="tab" aria-controls="nav-contact" aria-selected="false">Attachment</button>
								</div>
							</nav>
							<div class="tab-content p-3 border bg-light" id="nav-tabContent">
								<div class="tab-pane fade active show" id="nav-stock"
									role="tabpanel" aria-labelledby="nav-profile-tab">
									<c:if test="${lstStore.size() > 1}">
										<div class="row">
											<div class="col-md-12">
												<button type="button" class="btn btn-submit"
													style="float: right;width: auto;" onclick="addStockRow()"><i class="fa fa-plus" aria-hidden="true"></i>Add Stock</button>
											</div>
										</div>
									</c:if>
									<c:choose>
										<c:when test="${not empty stockLst}">
											<c:forEach items="${stockLst}" var="stock" varStatus="count">
												<div class="row" id="row${count.index}">
													<input type="hidden" name="stock[${count.index}].stockId"
														value="${stock.stockId}">
													<div class="form-group col-md-2">
														<label for="inputEmail4" class="required">Store: </label>
														<select class="form-select requiredField" aria-label="Default select example" id="storeId${count.index}" name="stock[${count.index}].store.storeId" onchange="checkDuplicate(this.value,${count.index})">
                                                            <option value="">-Select-</option>
                                                            <c:forEach items="${lstStore}" var="store">
                                                                <option value="${store.storeId}" ${store.storeId eq stock.store.storeId ? 'selected' : ''}>${store.storeName}</option>
                                                            </c:forEach>
                                                        </select>
														<!-- <c:choose>
															<c:when test="${lstStore.size() > 1}">
																<select class="form-select requiredField" aria-label="Default select example" id="storeId${count.index}" name="stock[${count.index}].store.storeId" onchange="checkDuplicate(this.value,${count.index})">
																	<option value="">-Select-</option>
																	<c:forEach items="${lstStore}" var="store">
																		<option value="${store.storeId}" ${store.storeId eq stock.store.storeId ? 'selected' : ''}>${store.storeName}</option>
																	</c:forEach>
																</select>
															</c:when>
															<c:otherwise>
																<input type="hidden" name="stock[${count.index}].store.storeId" value="${lstStore[0].storeId}" />
																<input type="text requiredField" class="form-control form-control-sm" value="${lstStore[0].storeName}" readonly="readonly" />
															</c:otherwise>
														</c:choose> -->
													</div>
													<div class="form-group col-md-2">
                                                        <label class="col-md-12 " for="text">Reorder
                                                            Level:</label> <input
                                                            class="form-control form-control-sm NumbersOnlyWithoutDot onClickInput"
                                                            type="text" id="reorderLevel${count.index}"
                                                            name="stock[${count.index}].reorderLevel"
                                                            placeholder="Enter Reorder Level"
                                                            value="${not empty stock ? stock.reorderLevel :0}"
                                                            maxlength="100">
                                                    </div>
													<div class="form-group col-md-2">
														<label class="col-md-12 " for="text">Reorder Quantity:</label>
														<input class="form-control form-control-sm NumbersOnlyWithoutDot onClickInput" type="text" id="restockLevel${count.index}" name="stock[${count.index}].restockLevel" placeholder="Enter Restock Level"
															value="${not empty stock ? stock.restockLevel :0}" maxlength="100">
													</div>


													<div class="form-group col-md-1">
														<label class="col-md-12 " for="text">W.A.Cost:</label> <input
															class="form-control form-control-sm NumbersOnly onClickInput"
															type="text" id="weightAvgPrice${count.index}"
															name="stock[${count.index}].weightAvgPrice"
															placeholder="Enter Opening Wtg Avg Cost"
															value="${not empty stock ? stock.weightAvgPrice :0.00}"
															maxlength="100">
													</div>
													<div class="form-group col-md-1">
														<label class="col-md-12 " for="text">L.P. Cost:</label> <input
															class="form-control form-control-sm NumbersOnly"
															type="hidden" id="lastPurchasePrice${count.index}"
															readonly name="stock[${count.index}].lastPurchasePrice"
															placeholder="Enter Last Purchased Cost"
															value="${not empty stock ? stock.lastPurchasePrice :0.00}"
															maxlength="100"> <input
															class="form-control form-control-sm NumbersOnly"
															type="text" readonly
															placeholder="Enter Last Purchased Cost"
															value="<fmt:formatNumber value="${not empty stock ? stock.lastPurchasePrice :0.00}" minFractionDigits="2" maxFractionDigits="2" />"
															maxlength="100">
													</div>
													<div class="form-group col-md-1">
														<label class="col-md-12 " for="text">Avl Qty:</label> <input
															class="form-control form-control-sm NumbersOnlyWithoutDot"
															type="text" id="quantity${count.index}"
															name="stock[${count.index}].quantity"
															placeholder="Enter Available Quantity"
															value="${not empty stock ? stock.quantity :0}"
															maxlength="100" readonly>
													</div>
													<div class="form-group col-md-2">
														<label class="col-md-12 " for="text">Last
															Purchased Date:</label>
														<div class="datepicker_con ">
															<input type="text"
																class="form-control form-control-sm"
																id="lastPurchaseDate${count.index}"
																name="stock[${count.index}].lastPurchaseDate"
																value="${stock.lastPurchaseDateStr}" disabled />
														</div>
													</div>
													<div class="form-group col-md-1 minus-div">
														<button type="button" class="btn-minus"
															onclick="removeRow(${count.index})"
															style="margin-top: 12px !important;">
															<i class='fa fa-trash' style='color: #ffffff; line-height: inherit;'></i>
														</button>
													</div>
													<c:set var="rowcount" value="${count.count}" />
												</div>
											</c:forEach>
										</c:when>
										<c:otherwise>
											<div class="row" id="row0">
												<div class="form-group col-md-2">
													<label for="inputEmail4" class="required">Store: </label>
													<select class="form-select requiredField" aria-label="Default select example" id="storeId0" name="stock[0].store.storeId" onchange="checkDuplicate(this.value,0)">
														<option value="">-Select-</option>
														<c:forEach items="${activeStores}" var="store">
															<option value="${store.storeId}" ${store.storeId eq stock.store.storeId ? 'selected' : ''}>${store.storeName}</option>
														</c:forEach>
													</select>
													<!-- <c:choose>
														<c:when test="${lstStore.size() > 1}">
															<select class="form-select requiredField" aria-label="Default select example" id="storeId0" name="stock[0].store.storeId" onchange="checkDuplicate(this.value,0)">
																<option value="">-Select-</option>
																<c:forEach items="${lstStore}" var="store">
																	<option value="${store.storeId}" ${store.storeId eq stock.store.storeId ? 'selected' : ''}>${store.storeName}</option>
																</c:forEach>
															</select>
														</c:when>
														<c:otherwise>
															<input type="hidden" name="stock[0].store.storeId"
																value="${lstStore[0].storeId}" />
															<input type="text requiredField"
																class="form-control form-control-sm"
																value="${lstStore[0].storeName}" readonly="readonly" />
														</c:otherwise>
													</c:choose> -->
												</div>
												<div class="form-group col-md-2">
                                                    <label class="col-md-12 " for="text">Reorder Level:</label>
                                                    <input
                                                        class="form-control form-control-sm NumbersOnlyWithoutDot onClickInput text-end"
                                                        type="text" id="reorderLevel0"
                                                        name="stock[0].reorderLevel"
                                                        placeholder="Enter Reorder Level"
                                                        value="${not empty stock ? stock.reorderLevel :0}"
                                                        maxlength="100">
                                                </div>
												<div class="form-group col-md-2">
													<label class="col-md-12 " for="text">Reorder Quantity:</label>
													<input
														class="form-control form-control-sm NumbersOnlyWithoutDot onClickInput text-end"
														type="text" id="restockLevel0"
														name="stock[0].restockLevel"
														placeholder="Enter Restock Level"
														value="${not empty stock ? stock.restockLevel :0}"
														maxlength="100">
												</div>


												<div class="form-group col-md-1">
													<label class="col-md-12 " for="text">W.A.Cost:</label> <input
														class="form-control form-control-sm NumbersOnly onClickInput text-end"
														type="text" id="weightAvgPrice0"
														name="stock[0].weightAvgPrice"
														placeholder="Enter Opening Wtg Avg Cost"
														value="${not empty stock ? stock.weightAvgPrice :0.00}"
														maxlength="100">
												</div>
												<div class="form-group col-md-1">
													<label class="col-md-12 " for="text">L.P. Cost:</label> <input
														class="form-control form-control-sm NumbersOnly text-end"
														type="text" id="lastPurchasePrice0" readonly
														name="stock[0].lastPurchasePrice"
														placeholder="Enter Last Purchased Cost"
														value="${not empty stock ? stock.lastPurchasePrice :0.00}"
														maxlength="100">
												</div>
												<div class="form-group col-md-1">
													<label class="col-md-12 " for="text">Avl Qty:</label> <input
														class="form-control form-control-sm NumbersOnlyWithoutDot text-end"
														type="text" id="quantity0" name="stock[0].quantity"
														placeholder="Enter Available Quantity"
														value="${not empty stock ? stock.quantity :0}"
														maxlength="100" readonly>
												</div>
												<div class="form-group col-md-2">
													<label class="col-md-12 " for="text">Last Purchased
														Date:</label>
													<div class="datepicker_con ">
														<input type="text"
															class="form-control form-control-sm"
															id="lastPurchaseDate0" name="stock[0].lastPurchaseDate"
															value="${date}" disabled />
													</div>
												</div>
												<div class="form-group col-md-1 minus-div">
													<button type="button" class="btn-minus"
														onclick="removeRow(0)"
														style="margin-top: 12px !important;">
														<i class='fa fa-trash' style='color: #ffffff; line-height: inherit'></i>
													</button>
												</div>
												<c:set var="rowcount" value="1" />
											</div>
										</c:otherwise>
									</c:choose>
								</div>
								<div class="tab-pane fade" id="nav-attch" role="tabpanel"
									aria-labelledby="nav-contact-tab">
									<div class="row">
										<c:if test="${not empty item.itemAttachments}">
											<c:forEach items="${item.itemAttachments}" var="attch"
												varStatus="status">
												<div class="form-group col-md-3" id="docLine${status.count}">
													<div class="iconsetter">
														<a onclick="downloadDoc('${attch.attachmentPath}')"><i
															class="fa-regular fa-file-lines"></i></a><a class="clsBtn"
															onclick="removeDoc(${attch.attachmentId},${status.count})"><i
															class="fa-solid fa-x"></i></a>

													</div>
													${attch.attachmentName}
												</div>
											</c:forEach>
										</c:if>

									</div>
									<div class="row">
										<div class="form-group col-md-3">
											<label class="col-md-12 " for="text">Attachment Name:</label>
											<input class="form-control form-control-sm " type="text"
												id="attachmentName0"
												name="itemAttachments[0].attachmentName"
												placeholder="Enter Attachment Name" value="" maxlength="25">
										</div>
										<div class="form-group col-md-3">
											<label class="col-md-12 " for="text">Attachment File:</label>
											<input class="form-control form-control-sm " type="file"
												id="attachmentFile0"
												name="itemAttachments[0].attachmentFile"
												placeholder="Enter Attachment Name" value="" maxlength="100">
										</div>
										<div class="form-group col-md-2 pluse-div">
											<button type="button" class="btn-pluse"
												id="btn_add_multiShop" onclick="addNewRow()"
												data-toggle="tooltip" data-placement="top" style="margin-top:4px;"
												title="Add More Attachment">
												<i class='fa fa-plus'></i>
											</button>
										</div>
									</div>
									<div id="attachment"></div>
								</div>
							</div>

							<!-- tab section -->


							<div class="col-md-12  text-center mt-3">
								<input type="button" class="btn btn-submit" style="width: auto;" value="${not empty item.itemId ? (not empty stockLst ? 'Update' : 'Update Store') : 'Save' } " onclick="validateForms()">
								<a type="button" class="btn btn-sm btn-danger " onclick="backToModule()">Cancel</a>
								<c:if test="${not empty item.itemId}">
									<a type="button" href="${contextPath}/inventory/store/item/add" class="btn btn-submit">Add New</a>
								</c:if>
							</div>




						</div>
					</div>
				</form>

			</div>
		</div>
		<c:if test="${empty item}">
			<div class="col-md-12 mt-3">
				<div class="card">
					<div class="card-header">
						<h5 class="card-title">Item list</h5>
					</div>
					<div class="card-body">
						<form method="GET" action="${contextPath}/inventory/store/item/add" id="itmLstFrm" >
							<div class="row">
							    <div class="form-group col-md-3">
                                    <label for="inputEmail4" class="required">Store: </label>
                                    <select class="form-select requiredField" aria-label="Default select example" id="storeIdd" name="storeId" onchange="getItemList()">
                                        <option value="">-Select-</option>
                                        <c:forEach items="${lstStore}" var="store">
                                            <option value="${store.storeId}" ${store.storeId eq storeId ? 'selected' : ''}>${store.storeName}</option>
                                        </c:forEach>
                                    </select>
								</div>
							</div>
						</form>
						<div class="table-responsive">
							<table
								class="datatable table table-striped table-bordered exportbtn mt-3">
								<thead>
									<tr>
										<th>Sl No</th>
										<th>Item Name</th>
										<th>Item Code</th>
										<th>Item Type</th>
										<th>Category</th>
										<th>Sub Category</th>
										<th>Uom</th>
										<th>Available Quantity</th>
										<th>Active/InActive</th>
										<th>Action</th>
									</tr>
								</thead>
								<tbody id="tbody">
									<c:forEach items="${lstItems}" var="item" varStatus="status">
										<tr>
											<td>${status.count}</td>
											<td>${item.itemName}</td>
											<td>${item.itemCode}</td>
											<td>${item.itemType.itemTypeName}</td>
											<td>${item.category.categoryName}</td>
											<td>${item.subCategory.subCategoryName}</td>
											<td>${item.uom.uom}</td>
											<td>${item.avlQty}</td>
											<td>
												<div class="form-group col-md-2 mt-0 mb-0 toggleTrueFalse"
													data-label-on="True" data-label-off="False"
													data-toggle-width="90">
													<input type="checkbox" value="${item.active}"
														class="toggleCheckBox"
														${item.active == 'true' ? 'checked' : ''}
														id="parametros_MOSTRAPEDIDOS" name="active" disabled /> <label
														class="clickToggle" for="parametros_MOSTRAPEDIDOS"></label>
												</div>
											</td>
											<td><a href="#" onclick="edit(${item.itemId})"
												class="btn btn-primary" data-toggle="tooltip"
												title="Edit Item"><i class='fa fa-pencil'></i></a> <a
												href="#" onclick="adjust(${item.itemId})"
												class="btn btn-success" data-toggle="tooltip"
												title="Stock Adjustment"><i class='fa-solid fa-store'></i></a>
											</td>
										</tr>
									</c:forEach>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</c:if>
	</div>
</div>
<form method="get"
	action="${contextPath}/inventory/store/item/stockAdjustment"
	id="adjust">
	<input type="hidden" id="itemIdddd" name="itemId" value=""> <input
		type="hidden" class="" id="encodedDataadjust" name="encodedDataadjust"
		value="" />
</form>
<form method="get" action="${contextPath}/inventory/store/item/add"
	id="edit">
	<input type="hidden" id="itemIddd" name="itemId" value=""> <input
		type="hidden" class="" id="encodedDataedit" name="encodedDataedit"
		value="" />
</form>
<form method="post" action="${contextPath}/inventory/store/item/delete"
	id="deleteItems">
	<input type="hidden" name="${_csrf.parameterName}"
		value="${_csrf.token}" /> <input type="hidden" id="itemIdd"
		name="itemId" value="">
</form>
<form method="post" action="${contextPath}/document/download" id="download" target="_blank">
	<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" /> 
	<input type="hidden" id="docPath" name="docPath" value=""> 
	<input type="hidden" id="module" name="module" value="Master/Item">
</form>

<script>


function adjust(id) {
    $("#itemIdddd").val(id);
    encryptFormData("adjust", tableOrTbodyIDS, tableOrTbodyKeys);
    $("#adjust").submit();
}
function edit(id){
    $("#itemIddd").val(id);
    encryptFormData("edit", tableOrTbodyIDS, tableOrTbodyKeys);
    $("#edit").submit();
}
function downloadDoc(path){
	$("#docPath").val(path);
	var a=$("#docPath").val();
	$("#download").submit();
}
function deleteItem(id){
	$("#itemIdd").val(id);
	$("#deleteItems").submit();
}

var rowLine=0;
function addNewRow(){
	var html='';
	if(rowLine!=0){
		$("#minus"+rowLine).attr('disabled', true);	
	}
	rowLine++;
	html=html+'<div class="row" id="attRow'+rowLine+'"><div class="form-group col-md-3"><label class="col-md-12 " for="text">Attachment Name:</label><input class="form-control form-control-sm" type="text" id="attachmentName'+rowLine+'" name="itemAttachments['+rowLine+'].attachmentName" placeholder="Enter Attachment Name" value="" maxlength="100"></div><div class="form-group col-md-3"><label class="col-md-12 " for="text">Attachment File:</label><input class="form-control form-control-sm " type="file" id="attachmentFile'+rowLine+'" name="itemAttachments['+rowLine+'].attachmentFile" placeholder="Enter Attachment Name" value="" maxlength="100"></div><div class="form-group col-md-2 minus-div2"><button type="button" class="btn-minus" style="margin-top: 2px !important;"  id="minus'+rowLine+'"  onclick="removeAttRow('+rowLine+')" data-toggle="tooltip" data-placement="top" title="Add More Attachment"> <i class="fa fa-trash" style="line-height: inherit;"></i></button></div></div>';
	$("#attachment").append(html);
}

function removeAttRow(id){
	var preVal = id-1;
	$($("#attRow"+id).closest("div")).remove();
	$("#minus"+preVal).attr('disabled', false);
	rowLine--;
}

var imageLine=0;
function addNewImage(){
	var html='';
	if(imageLine!=0){
		$("#imgminus"+imageLine).attr('disabled', true);	
	}
	imageLine++;
	html=html+'<div class="form-group col-md-3" id="imgRow'+imageLine+'" style="position:relative;margin-top:19px;"><input class="form-control form-control-sm " type="file" id="image'+imageLine+'" name="itemImages['+imageLine+'].attachmentFile" placeholder="Enter Attachment Name" value="" maxlength="100" onchange="checkFileValidate(this)"><button type="button" class="btn-minus position-absolute" style="bottom: 3px;right: 15px;padding: 3px 8px;"  id="imgminus'+imageLine+'"  onclick="removeImage('+imageLine+')" data-toggle="tooltip" data-placement="top" title="Add More Attachment"> <i class="fa fa-trash" style="line-height: inherit;"></i></button></div>';
	$("#img").append(html);
}
function removeImage(id){
	var preVal = id-1;
	$($("#imgRow"+id).closest("div")).remove();
	$("#imgminus"+preVal).attr('disabled', false);
	imageLine--;
}


// function removeRow(id){
// 	var preVal = id-1;
// 	$($("#attRow"+id).closest("div")).remove();
// 	$("#minus"+preVal).attr('disabled', false);
// 	rowLine--;
// }

function validateForms(){
	// validate form thoes fields have requiredField class
	var form = $("#addItemFrm");
	let requiredFields = form[0].querySelectorAll(".requiredField");
	isValid = requiredFieldValidation(requiredFields);

	if(isValid){
		bootbox.confirm({
			message: "Are you sure you want to submit?",
			buttons: {
				confirm: {
					label: 'Yes',
					className: 'btn-success'
				},
				cancel: {
					label: 'No',
					className: 'btn-danger'
				}
			},
			callback: function (result) {
				if(result){
					$("#addItemFrm").submit();
				}
			}
		});
	}


}
function removeDoc(id,line) {
	
	$.ajax({
		url : '${contextPath}/inventory/store/removeDoc?docId='+id,
		success : function(response) {
			if(response){
				$("#docLine"+line).hide();
			}
		}
	});	
	
}

var rowNo=0+${rowcount};
function addStockRow(){
	
	var html='<div class="row" id="row'+rowNo+'">'+
					'<div class="form-group col-md-2">'+
					'<label for="inputEmail4" class="required">Store: </label> '+
					'<c:choose><c:when test="${lstStore.size() > 1}"><select class="form-select requiredField" aria-label="Default select example" id="storeId'+rowNo+'" name="stock['+rowNo+'].store.storeId" onchange="checkDuplicate(this.value,'+rowNo+')"><option value="">-Select-</option><c:forEach items="${activeStores}" var="store"><option value="${store.storeId}" ${store.storeId eq stock.store.storeId ? 'selected' : ''}>${store.storeName}</option></c:forEach></select></c:when><c:otherwise><input type="hidden" name="stock['+rowNo+'].store.storeId" value="${lstStore[0].storeId}" /><input type="text requiredField" class="form-control form-control-sm" value="${lstStore[0].storeName}" readonly="readonly"  /></c:otherwise></c:choose>'+
				'</div>'+
				'<div class="form-group col-md-2">'+
                    '<label class="col-md-12 " for="text">Reorder Level:</label>'+
                    '<input class="form-control form-control-sm NumbersOnlyWithoutDot onClickInput" type="text" id="reorderLevel'+rowNo+'" name="stock['+rowNo+'].reorderLevel" placeholder="Enter Reorder Level" value="${not empty stock ? stock.reorderLevel :0}" maxlength="100">'+
                '</div>'+
				'<div class="form-group col-md-2">'+
					'<label class="col-md-12 " for="text">Reorder Quantity:</label>'+
					'<input class="form-control form-control-sm NumbersOnlyWithoutDot onClickInput" type="text" id="restockLevel'+rowNo+'" name="stock['+rowNo+'].restockLevel" placeholder="Enter Restock Level" value="${not empty stock ? stock.restockLevel :0}" maxlength="100">'+
				'</div>'+
				'<div class="form-group col-md-1">'+
					'<label class="col-md-12 " for="text">W.A.Cost:</label>'+
					'<input class="form-control form-control-sm NumbersOnly onClickInput" type="text" id="weightAvgPrice'+rowNo+'" name="stock['+rowNo+'].weightAvgPrice" placeholder="Enter Opening Wtg Avg Cost" value="${not empty stock ? stock.weightAvgPrice :0.00}" maxlength="100">'+
				'</div>'+
				'<div class="form-group col-md-1">'+
					'<label class="col-md-12 " for="text">L.P. Cost:</label>'+ 
					'<input class="form-control form-control-sm NumbersOnly" type="text" id="lastPurchasePrice'+rowNo+'" readonly name="stock['+rowNo+'].lastPurchasePrice" placeholder="Enter Last Purchased Cost" value="${not empty stock ? stock.lastPurchasePrice :0.00}" maxlength="100">'+
				'</div>'+
				'<div class="form-group col-md-1">'+
					'<label class="col-md-12 " for="text">Avl Qty:</label>'+ 
					'<input class="form-control form-control-sm NumbersOnlyWithoutDot" type="text" id="quantity'+rowNo+'" name="stock['+rowNo+'].quantity" placeholder="Enter Available Quantity" value="${not empty stock ? stock.quantity :0}" maxlength="100" readonly>'+
				'</div>'+
				'<div class="form-group col-md-2">'+
					'<label class="col-md-12 " for="text">Last Purchased Date:</label>'+
					'<div class="datepicker_con ">'+
							'<input type="text" class="form-control form-control-sm datepicker_con"  id="lastPurchaseDate'+rowNo+'" name="stock['+rowNo+'].lastPurchaseDate" value="${date}" disabled /> <i class="fa fa-calendar" style="position: absolute; top: 7px; right: 6px;font-size: 18px;color: #0f67b1;"></i>'+
					'</div>'+
				'</div>'+
				'<div class="form-group col-md-1 minus-div">'+
					'<button type="button" class="btn-minus" onclick="removeRow('+rowNo+')" style="margin-top: 12px !important;"><i class="fa fa-trash" style="color:#ffffff; line-height:inherit;"  ></i></button>'+
				'</div>'+
				'</div>';
		$("#nav-stock").append(html);
		rowNo++;
}
function removeRow(id) {
	if(id==rowNo-1){
		if(rowNo==1){
			bootbox.alert("atleast one store compulsory");
			return false;
		}
		$("#row"+id).remove();
		rowNo--;
	}
	
}

function checkDuplicate(id,row) {
	for(var i=0;i<rowNo;i++){
		if(i!=row){
			var value=$("#storeId"+i).val();
			if(id==value){
				$("#storeId"+row).val("");
				bootbox.alert("this store already selected");
				return false;
			}
		}
	}
	
}

function checkFileValidate(that) {
	const file = that.files[0];
	if (file) {
		const validImageTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
		if (!validImageTypes.includes(file.type)) {
			alert('Only image files (JPEG, PNG, GIF, WEBP) are allowed.');
			that.value = ''; // Clear the input if the file is not valid
		}
	}
}
function removeImg(button,attId) {
	const inputFileElement = button.closest(".position-relative");
	if (inputFileElement) {
		bootbox.confirm("Are you sure to remove this image permanantly ?", function(result){
			if(result){
				$.ajax({
					url : '${contextPath}/inventory/store/removeDoc?docId='+attId,
					success : function(response) {
						if(response){
							inputFileElement.remove();
						}
					}
				});						
			}
		});
		
	}
}

function getItemList(){
	var storeId=$("#storeIdd").val();
	$("#tbody").empty();
	if(storeId==0){
		bootbox.alert("Please select store");
		return false;
	}
	$("#itmLstFrm").submit();
}
</script>

<script>
    $(document).ready(function() {
	$('.zoom-gallery').magnificPopup({
		delegate: 'a',
		type: 'image',
		closeOnContentClick: false,
		closeBtnInside: false,
		mainClass: 'mfp-with-zoom mfp-img-mobile',

		// If you enable allowHTMLInTemplate - 
		// make sure your HTML attributes are sanitized if they can be created by a non-admin user
		allowHTMLInTemplate: true,
		image: {
			verticalFit: true,
			titleSrc: function(item) {
				return item.el.attr('title') + ' &middot; <a class="image-source-link" href="'+item.el.attr('data-source')+'" target="_blank">image source</a>';
			}
		},

		gallery: {
			enabled: true
		},
		zoom: {
			enabled: true,
			duration: 300, // don't foget to change the duration also in CSS
			opener: function(element) {
				return element.find('img');
			}
		}
		
	});
});

function backToModule(){
       let currentModuleCode =  localStorage.getItem('currentModuleCode');
       $('#moduleId').val(enc_password(currentModuleCode));
       $('#moduleForm').submit();
    }
</script>