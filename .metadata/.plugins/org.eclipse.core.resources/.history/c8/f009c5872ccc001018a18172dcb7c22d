<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}"/>
<c:set var="userDetails" value="${serviceOutcome.data}"/>
<script type="text/javascript" src="${contextPath}/assets/utilsJs/common-utils.js"></script>
<script src="${contextPath}/assets/appJs/validation/commonMaster.js"></script>
<style>
.freeze{
		pointer-events: none;
}
</style>
<div class="breadcrumb_conatiner">
    <div class="col-md-6">
        <h4 class="change-color">Facility Wise Amenities</h4>
    </div>
    <div class="col-md-6">
        <nav aria-label="breadcrumb">
	        <ol class="breadcrumb">
				<li class="breadcrumb-item">
				    <a href="${contextPath}/home"><i class="fa fa-home"></i></a>
				</li>
				<li class="breadcrumb-item active" aria-current="page">Facility Wise Amenities</li>
			</ol>
        </nav>
     </div>
</div>

    <div class="container-fluid">
    	<div class="row mt-2">

            <div class="card">
                <div class="card-header">
                    <h6 class="card-title">Facility Wise Amenities</h6>
                </div>
                <div class="card-body">
<%--    <form class="form-horizontal" action="${contextPath}/facility/saveFacilityDetails" method="POST" id="facilityMstForm"  enctype="multipart/form-data">--%>
<%--        <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>--%>
<%--        <input type="hidden" name="facilitiesMapId" value="${facilityMstData.facilitiesMapId}" id="facilitiesMapId"/>--%>
        <div class="row">

    <div class="row mb-3">
        <div class="col-md-4">
            <div class="form-group">
                <label class="col-sm-12 required" for="objectIdAndTypeId">Organization :</label>
                <div class="col-sm-12">
<%-- 			<input type="hidden" value="${classObjectValue}" id="classObjectValueId" /> --%>
                    <select name="employmentList[${status.index}].objectIdAndType"  class="form-control form-select" id="objectIdAndTypeId"  onchange="getLevelListByOrganization(this);">
                        <option value="0">Select Organization<%-- [${String.valueOf(departRole.objectId).concat('##').concat(departRole.userLevel)}] --%></option>
                        <c:forEach items="${organizationList}" var="organization">
                            <option value="${organization.combineTwo}" ${currentOrgLvl eq organization.combineTwo ? 'selected' : ''} <%--  <c:if test="${organization.combineTwo eq String.valueOf(departRole.objectId).concat('##').concat(departRole.objectType)}">selected</c:if> --%>>${organization.organizationName}</option>
                        </c:forEach>
                    </select>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label class="col-sm-12 required" for="levelSelect">Level :</label>
                <div class="col-sm-12">
<%-- 			<div class="col-sm-4" ${empeBasicDetails.staffCollegeDeptRoleMap.levelId ne null ? 'style="pointer-events:none;"' : ''}> --%>
                    <select class="form-control form-select" name="employmentList[${status.index}].levelData" id="levelSelect" onchange="getActualLevelNameListByLevelCodeAndOrgId(this);" data-plugin-selectTwo>
                        <option value="0"><spring:message code="label.common.select"></spring:message></option>
                        <c:forEach var="level" items="${levelList}">
                            <option value="${level.organizationStructure.objectId}##${level.levelCode}##${level.organizationStructure.objectType}"  ${String.valueOf(level.organizationStructure.objectId).concat('##').concat(level.levelCode).concat('##').concat(level.organizationStructure.objectType) eq selLevel ? 'selected':''}>${level.levelCode}</option>
                        </c:forEach>
                    </select>
<!-- 								</div> -->
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label class="col-sm-12 required" for="levelNameSelect">Level Name :</label>
                <div class="col-sm-12">
<%-- 								<input type="hidden" class="validId7" id="staffDeptMapId${status.index}" name="employmentList[${status.index}].staffDeptMapId" value="${departRole.staffDeptMapId}"> --%>
<%-- 								<div class="col-sm-4" ${empeBasicDetails.staffCollegeDeptRoleMap.departmentId.levelName ne null ? 'style="pointer-events:none;"' : ''}> --%>
                    <select class="form-control form-select empcls" name="employmentList[${status.index}].actualLeveldata" id="levelNameSelect" onchange="" data-plugin-selectTwo>
                        <option value="0"><spring:message code="label.common.select"></spring:message></option>
                        <c:forEach var="actualLevel" items="${actualLevelList}">
                            <option value="${actualLevel.combineTwo}" ${actualLevel.combineTwo eq selLevelName ? 'selected' : ''}>${actualLevel.organizationName}</option>
                        </c:forEach>
                    </select>
<!-- 								</div> -->
                </div>
            </div>
        </div>
    </div>

        </div>

        <div class="col-md-12 mt-2 text-center">
            <button type="button" class="btn btn-submit" onclick="fetchList()">Filter</button>
            <a href="javascript:void(0)" onclick="history.back()" type="button" class="btn btn-warning btn-sm">Back</a>
        </div>
    </form>
</div>
</div>
</div>
</div>


<div class="cardcontainer cardContainerNotFirst">
	<div class="row mt-3">
		<div class="col-md-12">
			<div class="card full-height">
				<div class="card-header">
					<h4 class="card-title">Facility Wise Amenities</h4>
				</div>
				<div class="card-body">
					<div class="table-responsive">
						<table class="display table table-bordered table-hover exportbtn" style="width: 100%;table-layout: fixed;" id="tableId1">
								<thead>
									<tr>
										<th class="text-center" style="width:60px;">Sl.No</th>
<%--										<th>Organization</th>--%>
										<th>Level</th>
										<th>Level Name</th>
										<th>Facility</th>
										<th style="text-align: center">Amenities</th>
									</tr>
								</thead>
								<tbody>
									<c:forEach items="${facilityList}" var="facility" varStatus="count">
										<tr>
										  	<td class="text-center">${count.count}</td>
<%--											<td>Org</td>--%>
                            				<td>${facility.objectType}</td>
                            				<td>${facility.levelName}</td>
										 	<td>${facility.facilityName}</td>
										 	<td><button class="btn btn-sm"><i class="fa-solid fa-list-ul"></i></button></td>
										</tr>
								  	</c:forEach>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<form id="fetchList" action="${contextPath}/facility-report/get-facilities-wise-amenities-details">
    <input type="hidden" name="filterData" id="filterData" value="">
</form>
<script>

var arr = [];
function fetchList(){
    debugger
    if($('#objectIdAndTypeId').val() === '' || $('#objectIdAndTypeId').val() === '0'){
        bootbox.alert('Please select an Organization');
        return false;
    }
    else if($('#levelSelect').val() === '' || $('#levelSelect').val() === '0') {
            bootbox.alert('Please select Level');
            return false;
    }
    else if($('#levelNameSelect').val() === '' || $('#levelNameSelect').val() === '0') {
            bootbox.alert('Please select Level Name');
            return false;
    }
    else {
        if($('#objectIdAndTypeId').val() != '0'){
            arr.push($('#objectIdAndTypeId').val());
            arr.push($('#levelSelect').val());
            arr.push($('#levelNameSelect').val());
            $('#filterData').val(btoa(arr.toString()));
            $('#fetchList').submit();
        }else {
            $('#levelSelect').val(0);
            $('#levelNameSelect').val(0);
        }
    }
}

function getLevelListByOrganization(that){
    if(that.value != 0){
        $.ajax({
            url: "${contextPath}/api/allow/getLevelListByOrganization",
            method: "GET",
            data: { orgData: that.value },
            success: function(response) {
                var data = JSON.parse(response);
                var html = '<option value="0">- Select -</option>';
                $.each(data, function(index, value){
                    html += '<option value="'+value.orgIdNlevelCode+'">'+value.levelCode+'</option>';
                });
                $('#levelSelect').empty().append(html);
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Something Went Wrong: " + errorThrown);
            }
        });
    } else {
        $('#levelSelect').empty().append('<option value="0">- Select -</option>');
        $('#levelNameSelect').empty().append('<option value="0">- Select -</option>');
    }
}

function getActualLevelNameListByLevelCodeAndOrgId(that){
    if(that.value != 0){
        $.ajax({
            url: "${contextPath}/api/allow/getActualLevelNameListByLevelCodeAndOrgId",
            method: "GET",
            data: { levelData: that.value },
            success: function(response) {
                var data = JSON.parse(response);
                var html = '<option value="0">- Select -</option>';
                $.each(data, function(index, value){
                    html += '<option value="'+value.entityIdNEntityName+'">'+value.entityName+'</option>';
                });
                $('#levelNameSelect').empty().append(html);
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Something Went Wrong: " + errorThrown);
            }
        });
    } else {
        $('#levelNameSelect').empty().append('<option value="0">- Select -</option>');
    }
}
</script>
