<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />


<div class="breadcrumb_conatiner">
	<div class="col-md-6">
		<h4 class="change-color">Generate Purchase Order</h4>
	</div>
	<div class="col-md-6">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="${contextPath}/home"><i class="fa fa-home"></i></a></li>
				<li class="breadcrumb-item active" aria-current="page">Generate
					Purchase Order</li>
			</ol>
		</nav>
	</div>
</div>

<div class="row">
	<div class="col-md-12">

		<div class="card">
			<div class="card-header">
				<h5 class="card-title">Generate Purchase Order</h5>
			</div>
			<div class="card-body">
				<form
					action="${contextPath}/procurement/purchaseOrder/generatePurchaseOrder"
					method="post" id="poform">
					<input type="hidden" name="${_csrf.parameterName}"
						value="${_csrf.token}" /> <input type="hidden"
						name="requisitionId" id="requisitionId"
						value="${req.requisitionId}" /> <input type="hidden"
						name="rfqQuoteId" value="${not empty quote ?quote.rfqQuoteId :''}" />
					<input type="hidden" name="poId"
						value="${not empty po ? po.poId:'' }" /> <input type="hidden"
						id="reqDate"
						value="<fmt:formatDate value='${po.rfqQuote.rfqApprovedDate}' pattern='dd/MM/yyyy'/>" />
					<input type="hidden" class="" id="encodedDatapoform"
						name="encodedDatapoform" value="" />

					<div class="row">
						<div class="col-md-12">
							<div class="row">
								<div class="col-md-12 table-responsive">
									<caption class="table-cap">Requisition Details :</caption>
									<table class="table table-bordered">
										<tr>
											<td class="bgtr"><spring:message code="PROC.REQ.REQNO" /></td>
											<td>${po.directPo ? 'N/A' : po.rfqQuote.requisition.requisitionNo}</td>
											<td class="bgtr"><spring:message code="PROC.REQ.FINYEAR" /></td>
											<td>${po.finYear.finYear}</td>
										</tr>

										<tr>
											<td class="bgtr"><spring:message code="PROC.REQ.TYPE" /></td>
											<td>${po.requisitionType.requisitionTypeName}</td>
											<td class="bgtr"><spring:message code="PROC.REQ.DATE" /></td>
											<td><c:choose>
													<c:when test="${!po.directPo}">
														<fmt:formatDate
															value='${po.rfqQuote.requisition.requisitionDate }'
															pattern='dd/MM/yyyy' />
													</c:when>
													<c:otherwise>
													N/A
												</c:otherwise>
												</c:choose></td>
										</tr>
										<tr>
											<td class="bgtr">Stock Type</td>
											<td>${po.stockType.stockTypeName}</td>
											<td class="bgtr">Cost Center</td>
											<td>${po.costCenter.costCenterName}</td>
										</tr>
										<tr>
											<td class="bgtr"><spring:message
													code="PROC.REQ.PRIORITY" /></td>
											<td>${po.priorityLevel.priorityLevelName}</td>
											<td class="bgtr"><spring:message
													code="PROC.REQ.BUDGET.GENERAL.PURPOSE" /></td>
											<td>${po.rfqQuote.requisition.purpose}</td>
										</tr>
									</table>
								</div>

							</div>
							<caption class="table-cap">Purchase Order Details :</caption>
							<div class="row">
								<div class="col-md-3">
									<div class="form-group">
										<label class="col-md-12 required" for="text"><spring:message
												code="PROC.QNNO" /></label>
										<div class="col-md-12">
											<input type="text" class="form-control requiredField"
												id="supplierName"
												value="${po.directPo ? 'N/A' :po.rfqQuote.quoteNo}"
												readonly="readonly" />
										</div>
									</div>
								</div>
								<div class="col-md-3">
									<div class="form-group">
										<label class="col-md-12 required" for="text">Supplier
											Name</label>
										<div class="col-md-12">
											<input type="text" class="form-control requiredField"
												id="supplierName" value="${po.assetVendor.vendorName}"
												readonly="readonly" />
										</div>
									</div>
								</div>
								<div class="col-md-3">
									<div class="form-group">
										<label class="col-md-12 required" for="text"><spring:message
												code="PROC.REQ.CURRENCY" /></label>
										<div class="col-md-12">
											<input type="text" class="form-control requiredField"
												id="currrency" value="${po.currency.currencyShortName}"
												readonly="readonly" />
										</div>
									</div>
								</div>
								<div class="col-md-3">
									<div class="form-group">
										<label class="col-md-12 required" for="text">Purchase
											Generate Date</label>
										<div class="col-md-12">
											<div class="datepicker-box date-generate">
												<input type="text"
													class="form-control form-control-sm requiredField generateDate ${canTakeAction eq 'true' ? '' :'frezz' }"
													id="poGenerateDate"
													value="<fmt:formatDate value='${po.poCreateDate}' pattern='dd/MM/yyyy'/>"
													name="poCreatedDate" readonly/> <i
													class='fa-solid fa-calendar-week'></i>
											</div>
										</div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-group">
										<label class="col-md-12" for="text"><spring:message
												code="COMMON.REMARKS" /></label>
										<div class="col-md-12">
											<textarea
												class="form-control AlphaNumericForText textArea unfreezeField"
												id="remarks" name="remarks"
												maxlength="200" placeholder="Please give remarks"
												${canTakeAction eq false ? 'readonly' : ''}>${po.remarks}</textarea>
										</div>
									</div>
								</div>
								<c:if
									test="${not empty po && not empty po.stageForwardedRule && not empty po.stageForwardedRule.actionType && po.stageForwardedRule.actionType.actionCode eq 'APPROVE' && po.revise eq false && po.poClosed eq false}">
									<div class="col-md-3 align-self-end text-end"
										style="margin-bottom: 17px;">
										<input type="hidden" value="${po.poId}" id="poIdForAmendMent" />
										<button type="button" class="btn-submit unfreezeField"
											onclick="generateAmentMent()">Po Amendment</button>
									</div>
								</c:if>
								<c:if
									test="${po.stageForwardedRule.actionType.actionCode eq 'APPROVE'}">
									<!-- <c:if test="${role eq 'ROLE_HOD'}">
									<c:choose>
										<c:when test="${po.poClosed eq false && po.revise eq false}">
											<div class="col-md-3 align-self-end" style="margin-bottom: 17px;">
												<button type="button" class="btn btn-primary unfreezeField" data-bs-toggle="modal" data-bs-target="#myModal" style="margin-top:-10px" onclick="getModal(${po.poId},'${po.poNo}','<fmt:formatDate value='${po.poReceiptGeneratedDate }' pattern='dd/MM/yyyy'/>')">Close The Po </button>
											</div>
										</c:when>
										<c:otherwise> -->
									<c:if test="${po.poClosed && not empty po.closeDoc}">
										<div class="col-md-3 align-self-end"
											style="margin-bottom: 17px;">
											<i class='fa-regular fa-file-lines'
												style="font-size: 19px; color: #cc0000; top: -3px; position: relative;"
												onclick="downloadDoc('${po.closeDoc}')"> </i>
										</div>
									</c:if>
									<!-- </c:otherwise>
									</c:choose>
								</c:if>						 -->
								</c:if>

							</div>
							<div class="row">
								<div class="col-md-12">
									<table class="table table-striped table-bordered  mt-3">
										<thead class="bagGroundColor">
											<tr>
												<th>Item Type</th>
												<th style="width: 250px">Item Name</th>
												<th>Requisition Qty</th>
												<th>Vendor Qty</th>
												<th>Order Qty</th>
												<th>Unit Price</th>
												<th>Discount(%)</th>
												<th>Tax(%)</th>
												<th style="text-align: right">Total Price</th>
												<c:if test="${canTakeAction eq 'true'}">
													<th>Action</th>
												</c:if>
											</tr>
										</thead>
										<tbody id="itemBody">
											<c:forEach items="${po.poLines}" var="line" varStatus="count">
												<tr id="rowId${count.index}"
													${line.unitPrice eq 0 ? 'class="disable-row"' : '' }>
													<td>${line.entityType}<input type="hidden"
														id="po${count.index}"
														name="poLines[${count.index}].poLineId"
														value="${line.poLineId}"></td>
													<td>${line.item.itemName}</td>
													<td>${line.requisitionQuantity}</td>
													<td>${line.vendorQuantity}<input type="hidden"
														id="vndQty${count.index}" value="${line.vendorQuantity}"></td>
													<td><input type="number" style="width: 85px;"
														class="quantity ${line.unitPrice eq 0 ? '' : 'greaterThanZero' } ${line.item.isFractional ? 'numberWithTwoDesimal' : 'numberWithTwoDesimalButOnlyAllowZero' } maximunLengthIs10WithDot  onClickInput"
														id="orderQty${count.index}"
														name="poLines[${count.index}].supplierQuantity"
														value="${line.supplierQuantity}"
														${canTakeAction eq 'true' ? '' :'readonly="readonly"' }></td>
													<td><input type="number"
														class="unitPrice ${line.unitPrice eq 0 ? '' : 'greaterThanZero' } numberWithTwoDesimal onClickInput text-end"
														id="unitPrice${count.index}"
														name="poLines[${count.index}].unitPrice"
														value="${line.unitPrice}" style="width: 85px"
														${canTakeAction eq 'true' ? '' :'readonly="readonly"' }>
														<input type="hidden" class="totsub"
														id="subTot${count.index}" value="${line.subTotal}"></td>
													<td><input type="number"
														class="discnt numberWithTwoDesimal onClickInput "
														id="dis${count.index}" value="${line.discountRate}"
														name="poLines[${count.index}].discountRate"
														style="width: 85px"
														${canTakeAction eq 'true' ? '' :'readonly="readonly"' }>
														<input type="hidden" class="totdis"
														id="disAmt${count.index}" value="${line.discountAmount}"></td>
													<td><input type="number"
														class="taxx numberWithTwoDesimal onClickInput"
														id="tax${count.index}" value="${line.taxRate}"
														name="poLines[${count.index}].taxRate" style="width: 85px"
														${canTakeAction eq 'true' ? '' :'readonly="readonly"' }>
														<input type="hidden" class="tottax"
														id="taxAmt${count.index}" value="${line.taxAmount}"></td>
													<td style="text-align: right"><input type="number"
														id="totPrc${count.index}"
														value="<fmt:formatNumber value="${line.totalAmount}" pattern="###0.00" />"
														style="width: 85px" readonly="readonly"></td>
													<c:if test="${canTakeAction eq 'true'}">
														<td><i class='fa-solid fa-trash'
															style="font-size: 20px;"
															onclick="removeRow(${count.index})"></i></td>
													</c:if>
												</tr>
											</c:forEach>
										</tbody>
										<tbody id="chargefoot">
											<tr class="trowbrdr">
												<td colspan="7"></td>
												<td><label>Sub Total</label></td>
												<td><input type="text" id="subTotal"
													readonly="readonly" class="trowbrdr boldfnt"
													style="text-align: right; padding-right: 8px; width: 80px; text-align: right"
													value="0.00"></td>
											</tr>
											<tr class="trowbrdr ">
												<td colspan="7" class="tdatabg"></td>
												<td class="tdatabg"><label>Discount</label></td>
												<td class="tdatabg"><input type="text"
													id="totalDiscount" readonly="readonly"
													class="trowbrdr boldfnt"
													style="text-align: right; padding-right: 8px; width: 80px; text-align: right"
													value="0.00"></td>
											</tr>
											<tr class="trowbrdr">
												<td colspan="7"></td>
												<td><label>Tax</label></td>
												<td><input type="text" id="totalTax"
													readonly="readonly" class="trowbrdr boldfnt"
													style="text-align: right; padding-right: 8px; width: 80px; text-align: right"
													value="0.00"></td>
											</tr>
											<c:if test="${not empty po.lstAddCost}">
												<c:forEach items="${po.lstAddCost}" var="addCst"
													varStatus="count">
													<tr id="chargeRow${count.index}" class="trowbrdr">
														<td class="tdatabg" colspan="7" style="text-align: right"><input
															type="hidden" name="lstAddCost[${count.index}].addCostId"
															value="${addCst.addCostId}"></td>
														<td class="tdatabg"><label>${addCst.addCostName}
																<input type="hidden"
																name="lstAddCost[${count.index}].addCostName"
																value="${addCst.addCostName}">
														</label></td>
														<td class="tdatabg"><input type="number"
															class="addCost trowbrdr boldfnt numberWithTwoDesimal onClickInput"
															id="charge${count.index}" value="${addCst.addCost}"
															name="lstAddCost[${count.index}].addCost"
															${canTakeAction eq 'true' ? '' :'readonly="readonly"' }
															style="text-align: right; padding-right: 8px; width: 80px; text-align: right"></td>
													</tr>
												</c:forEach>
												<tr id="totalAddCostRow" class="trowbrdr">
													<td colspan="7"></td>
													<td><label>Total AdditionalCost </label></td>
													<td><input type="number" id="totalAddCost"
														readonly="readonly" class="trowbrdr boldfnt"
														style="text-align: right; padding-right: 8px; width: 80px; text-align: right"
														value="${po.totAddCost}"></td>
												</tr>
											</c:if>
											<tr class="trowbrdr">

												<td class="tdatabg" colspan="7"
													style="font-weight: 600; font-size: 16px; font-style: italic; text-align: left;">In
													words: <span id="totalInWords"></span>
												</td>
												<td class="tdatabg"><label>Grand Total </label></td>
												<td class="tdatabg"><input type="text" id="grandTotal"
													readonly="readonly" class="trowbrdr boldfnt"
													style="text-align: right; padding-right: 8px; width: 80px; text-align: right"
													value="${quote.totAddCost}"></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					<c:set var="dynamicFromId" value="poform" scope="request" />
					<%@ include file="/WEB-INF/views/stageConfig/stageButton.jsp"%>
				</form>
			</div>
		</div>
	</div>
</div>

<div class="modal" id="myModal">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">

			<!-- Modal Header -->
			<div class="modal-header">
				<h4 class="modal-title">Purchase Order Close</h4>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<form action="${contextPath}/procurement/purchaseOrder/closePurchase"
				method="post" id="closeform" enctype="multipart/form-data">
				<input type="hidden" name="${_csrf.parameterName}"
					value="${_csrf.token}" /> <input type="hidden" name="poId"
					id="poId" value="" /> <input type="hidden" class=""
					id="encodedDatacloseform" name="encodedDatacloseform" value="" />

				<!-- Modal body -->
				<div class="modal-body">
					<div class="row">
						<div class="col-md-3">
							<div class="form-group">
								<label class="col-md-12 required" for="text">PO No.</label>
								<div class="col-md-12">
									<input type="text" class="form-control" id="poNo"
										readonly="readonly">
								</div>
							</div>
						</div>
						<div class="col-md-3">
							<div class="form-group">
								<label class="col-md-12 required" for="text">Purchase
									Closing Date</label>
								<div class="col-md-12">
									<div class="datepicker-box date-generate">
										<input type="text"
											class="form-control form-control-sm requiredField closeDate"
											id="closeDate" value="" name="closeDate" /> <i
											class='fa-solid fa-calendar-week'></i>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-3">
							<div class="form-group">
								<label class="col-md-12 required" for="text">Closing
									Document</label>
								<div class="col-md-12">
									<input type="file" class="form-control" id="closeDoc"
										placeholder="Enter email" name="closeDoc">
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
			<!-- Modal footer -->
			<div class="modal-footer">
				<button type="button" class="btn btn-danger"
					onclick="closePurchase()">Submit</button>
			</div>

		</div>
	</div>
</div>

<form action="${contextPath}/procurement/purchaseOrder/revisePo"
	method="GET" id="poAmentMentForm">
	<input type="hidden" name="${_csrf.parameterName}"
		value="${_csrf.token}" /> <input type="hidden" name="poId"
		id="poIdForAmendMentFl" value="" /> <input type="hidden" class=""
		id="encodedDatapoAmentMentForm" name="encodedDatapoAmentMentForm"
		value="" />
</form>

<form method="post" action="${contextPath}/document/download"
	id="download" target="empty">
	<input type="hidden" name="${_csrf.parameterName}"
		value="${_csrf.token}" /> <input type="hidden" id="docPath"
		name="docPath" value=""> <input type="hidden" id="module"
		name="module" value="Purchase/Close">
</form>
<script>
    tableIds=['itemBody','chargefoot'];
    jsonKeys=['poLines','lstAddCost'];
	var poDate='';
	function getModal(id,no,date) {
		$("#poNo").val(no);
		$("#poId").val(id);
		poDate=date;
	}
	$(function() {
		$('.closeDate').datepick({
			dateFormat: 'dd/mm/yyyy',maxDate:0, showOnFocus: true,
			 onSelect: function(selected) {
				 var alltDate=poDate.split("/");
				 var modAllotDate=new Date(alltDate[1]+"/"+alltDate[0]+"/"+alltDate[2]);
				 if(modAllotDate > new Date(selected)){
					bootbox.alert('PO Closing date sholud not be less than PO creation date.');
					$('.closeDate').val("");
				 }
			 }
		});
	});
	function closePurchase() {
		var closeDate=$("#closeDate").val();
		var closeDoc=$("#closeDoc").val();
		if(closeDate==""){
			displayErrorMsg("closeDate","Please select closing date");
			return false;
		}else{
			clearError("closeDate")
		}
		if(closeDoc==""){
			displayErrorMsg("closeDoc","Please upload closing document");
			return false;
		}else{
			clearError("closeDoc")
		}

		bootbox.confirm({
			message: "Are you sure you want to close the PO?",
			buttons: {
				confirm: {
					label: 'Yes',
					className: 'btn-success'
				},
				cancel: {
					label: 'No',
					className: 'btn-danger'
				}
			},
			callback: function (result) {
				if(result){
				    var closeTable = [];
				    var closeJson =[];
				    encryptFormData("closeform", closeTable, closeJson);
					$('#closeform').submit();
				}
			}
		});

	}
	
	function downloadDoc(path,module){
		$("#docPath").val(path);
		$("#download").submit();
	}

	function generateAmentMent(){
		var poId=$('#poIdForAmendMent').val();
		$('#poIdForAmendMentFl').val(poId);
		bootbox.confirm({
			message: "Are you sure you want to generate amendment?",
			buttons: {
				confirm: {
					label: 'Yes',
					className: 'btn-success'
				},
				cancel: {
					label: 'No',
					className: 'btn-danger'
				}
			},
			callback: function (result) {
				if(result){
				    var amdTable = [];
				    var amdJson =[];
				    encryptFormData("poAmentMentForm", amdTable, amdJson);
					$('#poAmentMentForm').submit();
				}
			}
		});
	}
	
	$(function() {
		$('.generateDate').datepick({
			dateFormat: 'dd/mm/yyyy',maxDate:0, showOnFocus: true,
			 onSelect: function(selected) {
				 var alltDate=$('#reqDate').val().split("/");
				 var modAllotDate=new Date(alltDate[1]+"/"+alltDate[0]+"/"+alltDate[2]);
				 if(modAllotDate > new Date(selected)){
					bootbox.alert('PO Generate date sholud not be less than Requisition creation date.');
					$('.generateDate').val("");
				 }
			 }
		});
	});
	$(document).ready(function(){
		totalCalculation();
	});

	function convertToFloat(value){
		if(value === "" || value === undefined){
			value = 0;
		}
		return parseFloat(value);
	}
	function removeRow(id) {
		if(!$("#rowId"+id).hasClass('disable-row')){
			// one row should be there get thoes row which have id="rowId" and check length
			var rowCount = $('#itemBody tr[id^="rowId"]').length;
			var disablerow = $('#itemBody tr[class^="disable-row"]').length;
			
			var activerow=parseInt(rowCount)-parseInt(disablerow);
			
			if(activerow<=1){
				bootbox.alert("Atleast one row should be there.");
				return false;
			}
			$("#rowId"+id).remove();
			totalCalculation();
		}
	}
	
	$(document).on('keyup', '.quantity', function(){
		// get rowNo from id="rowNo"
		var rowNo = $(this).attr('id').split('orderQty')[1];
		var unitPrice=$("#unitPrice"+rowNo).val();
		var taxRate=$("#tax"+rowNo).val();
		var discountRate=$("#dis"+rowNo).val();
		var qty=$("#orderQty"+rowNo).val();
		calculateRow(unitPrice,taxRate,discountRate,qty,rowNo);
	});
	
	$(document).on('keyup', '.unitPrice', function(){
		// get rowNo from id="rowNo"
		var rowNo = $(this).attr('id').split('unitPrice')[1];
		var unitPrice=$("#unitPrice"+rowNo).val();
		var taxRate=$("#tax"+rowNo).val();
		var discountRate=$("#dis"+rowNo).val();
		var qty=$("#orderQty"+rowNo).val();
		calculateRow(unitPrice,taxRate,discountRate,qty,rowNo);
	});
	
	$(document).on('keyup', '.discnt', function(){
		// get rowNo from id="rowNo"
		var rowNo = $(this).attr('id').split('dis')[1];
		var unitPrice=$("#unitPrice"+rowNo).val();
		var taxRate=$("#tax"+rowNo).val();
		var discountRate=$("#dis"+rowNo).val();
		var qty=$("#orderQty"+rowNo).val();
		calculateRow(unitPrice,taxRate,discountRate,qty,rowNo);
	});
	
	$(document).on('keyup', '.taxx', function(){
		// get rowNo from id="rowNo"
		var rowNo = $(this).attr('id').split('tax')[1];
		var unitPrice=$("#unitPrice"+rowNo).val();
		var taxRate=$("#tax"+rowNo).val();
		var discountRate=$("#dis"+rowNo).val();
		var qty=$("#orderQty"+rowNo).val();
		calculateRow(unitPrice,taxRate,discountRate,qty,rowNo);
	});
	
	function calculateRow(unitPrice,taxRate,discountRate,qty,id){
	
		unitPrice=convertToFloat(unitPrice);
		taxRate=convertToFloat(taxRate);
		discountRate=convertToFloat(discountRate);
		qty=convertToFloat(qty);
		if(discountRate>100){
			discountRate=100;
		}
		if(taxRate>100){
			taxRate=100;
		}
		var subtotal=qty*unitPrice;
		var disAmt=subtotal*(discountRate/100);
		var taxAmt=((subtotal-disAmt)*taxRate)/100;
		$('#subTot'+id).val(subtotal);
		$('#taxAmt'+id).val(taxAmt);
		$('#disAmt'+id).val(disAmt);
		var tot=subtotal-disAmt+taxAmt;
		tot=tot.toFixed(2);
		$("#totPrc"+id).val(tot);
		totalCalculation();
	}
	
	function totalCalculation() {
		var subTotal=0.00;
		var disAmt=0.00;
		var taxAmt=0.00;
		
		$('.tottax').each(function(){
			let val = $(this).val() == '' || $(this).val() == undefined ? 0 : $(this).val();
			taxAmt += parseFloat(val);
		});
		
		$('.totsub').each(function(){
			let val = $(this).val() == '' || $(this).val() == undefined ? 0 : $(this).val();
			subTotal += parseFloat(val);
		});
		
		$('.totdis').each(function(){
			let val = $(this).val() == '' || $(this).val() == undefined ? 0 : $(this).val();
			disAmt += parseFloat(val);
		});
		
		var grandtotal=subTotal-disAmt+taxAmt;
		var totalAddCost=$('#totalAddCost').val() == '' || $('#totalAddCost').val() == undefined ? 0 : $('#totalAddCost').val();
		totalAddCost=parseFloat(totalAddCost);
		grandtotal=grandtotal+totalAddCost;
		
		$('#subTotal').val(subTotal.toFixed(2));
		$('#totalDiscount').val(disAmt.toFixed(2));
		$('#totalTax').val(taxAmt.toFixed(2));
		$('#grandTotal').val(grandtotal.toFixed(2));
		var grandTotal = $("#grandTotal").val();

		let fstVal = grandTotal.split(".")[0];
        let secVal = grandTotal.split(".")[1];
        let finalWord = '';
        if(secVal == undefined || secVal == '' || secVal == '00' || secVal == '0'){
            finalWord = NumInWords(fstVal) + " only";
        }else{
            finalWord = NumInWords(fstVal) + " and " + NumInWords(secVal) + " cents only";
        }

		$("#totalInWords").text(finalWord);
	}
	
	$(document).on('keyup', '.addCost', function(){
		var totAddCst=0.00;
		$('.addCost').each(function(){
			let val = $(this).val() == '' || $(this).val() == undefined ? 0 : $(this).val();
			totAddCst += parseFloat(val);
		});
		$('#totalAddCost').val(totAddCst.toFixed(2));
		totalCalculation();
	});
</script>