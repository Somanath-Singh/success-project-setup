package com.aashdit.prod.heads.common.controller;


import java.util.List;

import org.jboss.logging.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.MessageSource;
import org.springframework.context.i18n.LocaleContextHolder;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import com.aashdit.common.model.State;
import com.aashdit.common.service.StateService;
import com.aashdit.framework.core.ServiceOutcome;

@Controller
@RequestMapping(value = "/admin/state")
public class StateController {

    final static Logger logger = Logger.getLogger(StateController.class);

    @Autowired
    private StateService stateService;
    
	@Autowired
	private MessageSource messageSource;

    @GetMapping(path = "/list", name = "List State")
    public String list(Model model, @RequestParam(value = "showDeleted", required = false) Boolean showDeleted) {
		try {
			ServiceOutcome<List<State>> serviceOutcome=stateService.getAllState(false);
			if(serviceOutcome.getOutcome()) {
				model.addAttribute("stateList", serviceOutcome.getData());
			}else {
				model.addAttribute("error_msg", serviceOutcome.getMessage());
			}
		}catch(Exception ex) {
			logger.error(ex);
			model.addAttribute("error_msg", messageSource.getMessage("msg.error", null, LocaleContextHolder.getLocale()));
		}
        return "admin.state.list";
    }

    @GetMapping(path = "/add", name = "Add State")
    public String add(Model model) {
    	
    	
        return "admin.state.add";
    }

    @GetMapping(path = "/edit/{stateId}", name = "Edit State")
    public String edit(Model model, @PathVariable("stateId") Long stateId, RedirectAttributes redirectAttributes) {
    	 try {
 			ServiceOutcome<State> serviceOutcome=stateService.getById(stateId);
 			if(serviceOutcome.getOutcome()) {
 				model.addAttribute("stateData", serviceOutcome.getData());
 			}else {
 				model.addAttribute("error_msg", serviceOutcome.getMessage());
 			}
         } catch (Exception ex) {
             logger.error(ex);
 			model.addAttribute("error_msg", messageSource.getMessage("msg.error", null, LocaleContextHolder.getLocale()));
         }
    	 return "admin.state.add";
    }

    @PostMapping(value = "/save", name = "Save State")
    public String saveState(@ModelAttribute("state") State state, RedirectAttributes attributes) {

        try {
			ServiceOutcome<State> serviceOutcome=stateService.saveState(state);
			if(serviceOutcome.getOutcome()) {
				attributes.addFlashAttribute("success_msg", serviceOutcome.getMessage());
			}else {
				attributes.addFlashAttribute("error_msg", serviceOutcome.getMessage());
			}
		
        } catch (Exception ex) {
            logger.error(ex);
            attributes.addFlashAttribute("error_msg", messageSource.getMessage("msg.error", null, LocaleContextHolder.getLocale()));

        }
    	return "redirect:/admin/state/list";
    }

   
}
