<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script src="${contextPath}/assets/appJs/validation/common-utils.js"></script>
<div class="content">
	<div class="breadcrumb_conatiner">
		<div class="col-md-6">
			<h4 class="change-color">Add & Manage Scheme Component</h4>
		</div>
		<div class="col-md-6">
			<nav aria-label="breadcrumb">
				<ol class="breadcrumb">
					<li class="breadcrumb-item"><a href="${contextPath}/home"><i class="fa fa-home"></i></a></li>
					<li class="breadcrumb-item active" aria-current="page">Add & Manage Scheme Component</li>
				</ol>
			</nav>
		</div>
	</div>
	<div class="page-inner">
		<div class="row mt-2">

			<div class="col-md-12">
				<div class="card full-height">
					<div class="card-header">
						<c:choose>
							<c:when test="${not empty scheme.schemeId}">
								<h4 class="card-title">Update Scheme Component</h4>
							</c:when>
							<c:otherwise>
								<h4 class="card-title">Add Scheme Component</h4>
							</c:otherwise>
						</c:choose>
					</div>
					<div class="card-body">
						
							<form action="${contextPath}/admin/master/scheme/save"
								id="addschemeFrm" method="post">
								<input type="hidden" name="${_csrf.parameterName}"
									value="${_csrf.token}" /> <input type="hidden" name="schemeId"
									value="${scheme.schemeId}" id="schemeId" />
								<div class="row">
									<div class="col-md-3">
										<div class="form-group">
											<label class="col-md-12 required" for="fundtypename">Fund Type :</label>
											<div class="col-md-12">
												<select class="form-control form-select"
													name="fundType.fundTypeId" id="fundTypeId"
													onchange="fundtypechange(this.value)">
													<option value="">--Select--</option>
													<c:forEach items="${fundtypelist}" var="fundtyprlist">
														<option value="${fundtyprlist.fundTypeId}"
															${fundtyprlist.fundTypeId eq scheme.subFundType.fundType.fundTypeId ? 'selected':''}>${fundtyprlist.fundTypeName}</option>
													</c:forEach>
												</select>
											</div>
										</div>
									</div>

									<div class="col-md-3">
										<div class="form-group">
											<label class="col-md-12 required" for="componentName">Sub Fund Type :</label>
											<div class="col-md-12">
												<select class="form-control form-select"
													name="subFundType.subfundTypeId" id="subfundTypeId">
													<option value="">--Select--</option>
													<c:forEach items="${subfundlist}" var="subfundtypelist">
														<option value="${subfundtypelist.subfundTypeId}"
															${subfundtypelist.subfundTypeId eq scheme.subFundType.subfundTypeId? 'selected':''}>${subfundtypelist.subfundTypeName}</option>
													</c:forEach>
												</select>
											</div>
										</div>
									</div>

									<!--<div class="form-group col-md-3">
										<label class="col-md-12 " for="objectIdAndType">Organization Name :</label>
										<div class="col-md-12">
											<select class="form-control form-control-sm selectpicker" name="objectIdAndType" id="objectIdAndType" required="required" <c:if test="${officeDetails.objectIdAndType ne null}">disabled</c:if> multiple data-live-search="true">
												<option value="">Select Organization</option>
												<c:forEach items="${organizationList}" var="organization">
													<option value="${organization.combineTwo}" <c:forEach items="${scheme.schemeOrgMap}" var="scmOrgMap">${scmOrgMap.entityId eq organization.entityId && scmOrgMap.entityLevel eq organization.userLevel ? 'selected' : ''} </c:forEach> >${organization.organizationName}</option>
												</c:forEach>
											</select>
										</div>
									</div>-->

									<div class="col-md-3">
										<div class="form-group">
											<label class="col-md-12 required" for="schemeName">Scheme Component Name :</label>
											<div class="col-md-12">
												<input type="text"
													class="form-control form-control-sm AlphaNumericOnly"
													id="schemeName" name="schemeName"
													value="${scheme.schemeName}" required="required"
													maxlength="150">
											</div>
										</div>
									</div>
									<div class="col-md-3">
									<div class="form-group">
											<label class="col-md-12" for="mobile">Scheme Component Code :</label>
											<div class="col-md-12">
												<input type="text" name="schemeCode"
													id="schemeCode"
													value="${scheme.schemeCode}" 
													class="form-control form-control-sm" maxlength="10"
													readonly>
											</div>
										</div>
										
									</div>
									<!-- <div class="col-md-3">
										<div class="form-group">
											<label class="col-md-10 required" for="isActive">Status</label>
											<div class="col-md-12">
												<input type="radio" value="true" id="isActive1" name="isActive" ${scheme.isActive eq true ?'checked':''} checked> Active &nbsp;&nbsp;
												<input type="radio" value="false" id="isActive2"  name="isActive"  ${scheme.isActive eq false ?'checked':''}> Inactive 
											</div> 
										</div>
									</div>  -->
									<div class="col-md-3">
											<div class="form-group">
											<label class="col-md-12 " for="Description">Description :</label>
											<div class="col-md-12">
												<textarea type="text"
													class="form-control form-control-sm AlphaNumericOnly"
													id="description" name="description"
													value="" maxlength="150">${scheme.description}</textarea>
											</div>
										</div>
									</div>
								</div>
									
								<div class="text-center" >
									<c:choose>
										<c:when test="${not empty scheme}">
											<input type="button" name="add&ManageApplicationScheme"
												value="Update" id="add&ManageApplicationSchemes"
												class="btn btn-success btn-sm" onclick="submitFormData()">
														<a href="${contextPath}/admin/master/scheme/list"
												type="button" class="btn btn-warning btn-sm">Back</a>
										</c:when>
										<c:otherwise>
											<input type="button" name="add&ManageApplicationScheme"
												value="Submit" id="add&ManageApplicationSchemes"
												class="btn btn-success btn-sm" onclick="submitFormData()">
														<a  type="button" class="btn btn-warning btn-sm" onclick="backToModule()">Back</a>
										</c:otherwise>
									</c:choose>

								</div>
							</form>
						
					</div>
				</div>
			</div>

		</div>
		<div class="row mt-3">
			<div class="col-md-12">
				<div class="card full-height">
					<div class="card-header">
						<h4 class="card-title">Scheme Component List</h4>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table id="basic-datatables"
								class="display table table-bordered table-hover exportbtn">
								<thead>
									<tr>
										<th class="text-center">Sl.No.</th>
										<th>Fund Type</th>
										<th>Sub Fund Type</th>
										<th>Scheme Component Name</th>
										<th>Scheme Component Code</th>
										<th>Description</th>
										<th>Status</th>
										<th>Action</th>
									</tr>
								</thead>
								<tbody id="tbd">
									<c:forEach items="${schemeList}" var="scheme" varStatus="count">
										<tr>
											<td class="text-center">${count.count}</td>
											<td>${scheme.subFundType.fundType.fundTypeName}</td>
											<td>${scheme.subFundType.subfundTypeName}</td>
											<td>${scheme.schemeName}</td>
											<td>${scheme.schemeCode}</td>
											<td>${scheme.description}</td>
											<c:if test="${scheme.isActive eq true }">
												<td>Active</td>
											</c:if>
											<c:if test="${scheme.isActive eq false }">
												<td>InActive</td>
											</c:if>
											<td><c:if test="${scheme.isActive eq true}">
													<button class="btn btn-warning btn-sm"
														onclick="editFundTypeById('${scheme.schemeId}')" title="Edit Scheme Component ">
														<i class="fas fa-edit"></i>
													</button>
													<button class="btn btn-danger btn-sm"
														onclick="activeInactiveScheme('INACTIVE', '${scheme.schemeId}')"
														title="Deactivate Scheme Component ">
														<i class="fa fa-lock" aria-hidden="true"></i>
													</button>
												</c:if> <c:if test="${scheme.isActive eq false}">
													<button class="btn btn-success btn-sm"
														onclick="activeInactiveScheme('ACTIVE', '${scheme.schemeId}')"
														title="Activate Scheme Component ">
														<i class="fa fa-unlock-alt" aria-hidden="true"></i>
													</button>
												</c:if></td>
										</tr>
									</c:forEach>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<form method="GET" id="formId"></form>

<form action="${contextPath}/admin/master/scheme/changeSchemeStatus.htm"
	id="changefundTypeStatus" method="post">
	<input type="hidden" name="${_csrf.parameterName}"
		value="${_csrf.token}" /> <input type="hidden" name="actionType"
		id="actionType" /> <input type="hidden" name="schemeId" id="schId" />
</form>
<script type="text/javascript">
	function editFundTypeById(id) {
		$("#formId").attr('action',
				'${contextPath}/admin/master/scheme/edit/' + id + '');
		$("#formId").submit();
	}

	function submitFormData() {

		if($("#fundTypeId").val()==""){
			bootbox.alert("Please select Fund Type");
			return false;
			
		}
		else if($("#subfundTypeId").val()==""){
			bootbox.alert("Please select Sub Fund Type");
			return false;
			
		}

		else if ($("#schemeName").val() == "") {
			bootbox.alert("Please Enter Scheme Component Name");
			return false;
		}
		// else if($("#schemeCode").val()==""){
		// 	bootbox.alert("Please Enter Component code");
		// 	return false;
		// }
		// else if($("#description").val()==""){
		// 	bootbox.alert("Please Enter Description");
		// 	return false;
		// }
		
		
		else {

			var flag = window.confirm("Do you want to continue ?");
			if (flag == true) {

				$("#addschemeFrm").submit();

			} else {

				//e.preventDefault();
			}

			//$("#addschemeFrm").submit();
		}

	}
	function activeInactiveScheme(actionType, schemeId) {
		$("#actionType").val(actionType);
		$("#schId").val(schemeId);
		if (actionType == 'INACTIVE') {
			bootbox.confirm({
				message : "Do you want to deactivate the Component?",
				buttons : {
					confirm : {
						label : 'Yes',
						className : 'btn-success'
					},
					cancel : {
						label : 'No',
						className : 'btn-danger'
					}
				},
				callback : function(result) {
					if (result == true) {
						$("#changefundTypeStatus").submit();
					}
				}
			});
		}
		if (actionType == 'ACTIVE') {
			bootbox.confirm({
				message : "Do you want to activate the Component?",
				buttons : {
					confirm : {
						label : 'Yes',
						className : 'btn-success'
					},
					cancel : {
						label : 'No',
						className : 'btn-danger'
					}
				},
				callback : function(result) {
					if (result == true) {
						$("#changefundTypeStatus").submit();
					}
				}
			});
		}
	}

	$('#schemeName').keypress(function(e) {
		var regex = new RegExp - 9(/^[a-zA-Z0-9\s]+$/);
		var str = String.fromCharCode(!e.charCode ? e.which : e.charCode);
		if (regex.test(str)) {
			return true;
		} else {
			e.preventDefault();
			bootbox.alert('Special Chataters are not allowed');
			return false;
		}
	});
</script>
<script>
	function fundtypechange() {
		findEntityListByfundId(null);
	}

	function findEntityListByfundId(id) {
		var fundTypeId = $("#fundTypeId").val();
		console.log(fundTypeId);
		$.ajax({
			type : "GET",
			url : '${contextPath}/admin/master/findByFundTypeId',
			dataType : "json",
			data : {
				"fundTypeId" : fundTypeId,
			},
			success : function(response) {
				var html = "<option value='' selected>-Select-</option>";
				var data = response;
				if (data != "" && data != null && data.length > 0) {
					$.each(data, function(index, value) {
						html = html + "<option value="+value.subfundTypeId+">"
								+ value.subfundTypeName + "</option>";
					});
				} else {
					$('#subfundTypeId').empty().append(html);
				}
				$('#subfundTypeId').empty().append(html);
				if (id != null) {
					$('#subfundTypeId').val(id);
				}
			},
			error : function(error) {
				bootbox.alert("Something went wrong !!!");
			}

		});

	}
</script>
<script>
	function duplicateCodeCheck() {
		var schemeData = $("#schemeCode").val();
		console.log(schemeData);
		if (schemeData != "") {
			$.ajax({
				type :"GET",
				url : "${contextPath}/admin/master/validCodeScheme",
				data : {
					"schemeData" : schemeData,
				},
				success : function(response) {
					if (response.isDuplicate == 'true') {
						bootbox.alert("Duplicate code not allowed");
						$("#schemeCode").val("");
						return false;
					}

				},
				error : function(error) {
					alert("failure");
				}
			});
		}
	}
</script>