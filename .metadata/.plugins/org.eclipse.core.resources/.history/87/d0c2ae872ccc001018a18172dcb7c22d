<style>
.modal-content {
   
    margin-top: 93px;}
    
    .modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    z-index: -1;
    width: 100vw;
    height: 100vh;
    background-color: #000;
}
.loading-spinner{
  width:50px;
  height:50px;
  border:2px solid indigo;
  border-radius:50%;
  border-top-color:#0001;
  display:inline-block;
  animation:loadingspinner .7s linear infinite;
}
@keyframes loadingspinner{
  0%{
    transform:rotate(0deg)
  }
  100%{
    transform:rotate(360deg)
  }
}
</style>
<div class="modal fade hide" id="addOtherItemModal" data-bs-backdrop="static" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static" aria-hidden="true">
	<div class="modal-dialog modal-third  modal-lg" role="document">
	  <div class="modal-content">
		<div class="modal-header">
			
			<h4 class="modal-title">Add New Item <i class="fa fa-cart-arrow-down" aria-hidden="true"></i> </h4>
			<button type="button" class="close modalclose" id="closemodal" style="color: red;font-size: 24px;opacity: 1;border-radius: 5px;" data-dismiss="modal">&times;</button>
			<!-- Cart Icon bootstrap -->
<!-- 			<div class="cart-icon"> -->

<!-- 			</div> -->
		</div>
		<div class="modal-body" id="modalHrdDiv">
			<div class="row">
				<div class="col-md-3">
					<div class="form-group">
						<label for="sel1">Select Category:</label>
						<select class="form-control" id="category" onchange="getSubCategoryDetailsByCategoryiD(this.value)">
							<option value="">Select Category</option>
							<c:forEach var="category" items="${categoryList}">
								<option value="${category.categoryId}">${category.categoryName}</option>
							</c:forEach>
						</select>
					</div>
				</div>
				<div class="col-md-3">
					<div class="form-group">
						<label for="sel1">Select Sub Category:</label>
						<select class="form-control" id="subcategory" onchange="">
							<option value="">Select Sub Category</option>
						</select>
					</div>
				</div>
				<div class="col-md-3">
					<div class="form-group">
						<label for="sel1">Search Item</label>
						<input type="text" class="form-control" id="searchKey" placeholder="Enter Item"
						onkeyup="getItemsByItemName(this.value)">
					</div>
				</div>
				<div class="col-md-3">
					<div class="form-group ">
						<button type="button" class="btn btn-submit" style="margin-top: 20px;"
						 onclick="getItemsByItemName($('#item').val())">Search</button>
					</div>
				</div>
			</div>
			<div class="row" id="itemSearchDivId">

			</div>
		</div>
		<div class="modal-footer">
			<!-- Two Previous And Next button -->
			<div class="row">
				<!-- Right side -->
				<div class="col-md-12 " style="text-align: right;">
					<input type="hidden" id="pageNo" value="0">
					<button type="button" id="pvrBtn" class="btn btn-orange pull-left">Previous</button>
					<button type="button" id="nextBtn" class="btn btn-sky pull-left">Next</button>
					<button type="button" class="btn btn-submit" data-dismiss="modal" onclick="addItemsToRow()">Add</button>
				</div>
			</div>
		</div>
	  </div>
	</div>
</div>

<script type="text/javascript">
$(document).ready(function(){
	getDataFromTrAndPushIntoArrList();
	calculateTotalAddCost();
});
$('#closemodal').click(function() {
    $('#addOtherItemModal').modal('hide');
});
$(function(){
  $('#modal-loading').modal('show');
});
</script>
<script>
function getItemsPaggination() {
    var stockType = $('#stockType').val();
    var storeId = $('#store').val();
    if (stockType == "") {
        bootbox.alert("Please select stock type.");
        return false;
    }
    $.ajax({
        url: "${contextPath}/ajax/inventory/items",
        type: 'GET',
        data: {
            page: $('#pageNo').val() == '' ? 0 : $('#pageNo').val(),
            size: 8,
            search: $('#searchKey').val() == '' ? '' : $('#searchKey').val(),
            category: $('#category').val() == 0 ? '' : $('#category').val(),
            subCategory: $('#subCateIds0').val() == 0 ? '' : $('#subCateIds0').val(),
            stockType: $('#stockType').val() == 0 ? '' : $('#stockType').val(),
            storeId: storeId
        },
        success: function (response) {
            var data = response;
            var html = '';
            data.map((item, index) => {
                html += '<div class="col-lg-3 col-xs-12 mb-2">';
                var itemStyle = checkItemAdded(item.itemId) ? 'background-color: #AAC0CB;' : '';
                html += '<div class="m-img-box" id="itemDiv' + item.itemId + '" style="' + itemStyle + '">';
					html += '<section>';
                    if (item.itemImgs && item.itemImgs.length > 0) {
                        html += '<div class="imageSlider owl-carousel">';
                        item.itemImgs.map((img, index) => {
                            html += '<div class="item">';
                            html += '<img class="inputMedia" alt="doc" src="data:image/png;base64 ,' + img.attachmentPath + '">';
                            html += '</div>';
                        });
                        html += '</div>';
                    } else {
                        html += '<img class="img-responsive itemImg" src="${contextPath}/assets/images/noImage.png" alt="No Image Found">';
                    }
                    html += '</section>';
                // if (item.stockType == 'ITEM') {
                //     html += '<section>';
                //     if (item.itemImgs && item.itemImgs.length > 0) {
                //         html += '<div class="imageSlider owl-carousel">';
                //         item.itemImgs.map((img, index) => {
                //             html += '<div class="item">';
                //             html += '<img class="inputMedia" alt="doc" src="data:image/png;base64 ,' + img.attachmentPath + '">';
                //             html += '</div>';
                //         });
                //         html += '</div>';
                //     } else {
                //         html += '<img class="img-responsive itemImg" src="${contextPath}/assets/images/noImage.png" alt="No Image Found">';
                //     }
                //     html += '</section>';
                // } else {
                //     html += '<img src="${contextPath}/assets/images/img-default.png" alt="image" class="img-responsive itemImg">';
                // }

                html += '<h4>' + item.itemName + '</h4>';
                html += '<input type="hidden" id="itemName" value="' + item.itemName + '">';
                html += '<input type="hidden" id="itemId" value="' + item.itemId + '">';
                html += '<input type="hidden" id="itemCode" value="' + item.itemCode + '">';
                html += '<input type="hidden" id="uom" value="' + item.uom + '">';
                html += '<input type="hidden" id="isFractional" value="' + item.isFractional + '">';
                html += '<input type="hidden" id="avlQty" value="' + item.avlQty + '">';
                html += '<input type="hidden" id="purchasePrice" value="' + item.purchasePrice + '">';
                html += '</div>';
                html += '</div>';
            });

            // Inject the HTML into the container
            $('#itemSearchDivId').html(html);

            // Reinitialize Owl Carousel for the dynamically added items
            setTimeout(function() {
                $(".imageSlider").owlCarousel({
                    items: 1,
                    loop: true,
                    nav: false,
                    dots: true,
                    autoplay: true,
                    autoplayTimeout: 3000,
                    autoplayHoverPause: false,
                    responsive: {
                        0: {
                            items: 1
                        },
                        600: {
                            items: 1
                        },
                        1000: {
                            items: 1
                        }
                    }
                });
            }, 300); // Adding a small delay to ensure the DOM has finished updating

        },
        error: function (e) {

        }
    });

    // Show the modal after content is injected and carousel is initialized
    $('#addOtherItemModal').modal('show');
}

// checek item is already added or not
function checkItemAdded(itemId){
	var isAdded = false;
	// check item is already added or not in itemLists
	itemLists.map((item, index) => {
		if(item.itemId == itemId){
			$('#itemDiv'+itemId).css('background-color', '#AAC0CB');
			isAdded = true;
		}
	});
	return isAdded;
}
$(document).on('click', '.m-img-box', function(){
	var itemId = $(this).find('#itemId').val();
	var itemName = $(this).find('#itemName').val();
	var itemCode=$(this).find('#itemCode').val();
	var uom=$(this).find('#uom').val();
	var avlQty = $(this).find('#avlQty').val();
	var lastPprice = $(this).find('#purchasePrice').val();
	var isFractional=$(this).find('#isFractional').val();
	let selectItem = {
			'reqId': '',
			'itemId': itemId,
			'itemName': itemName,
			'itemCode':itemCode,
			'reqQty':0,
			'avlQty': avlQty,
			'lastPprice': lastPprice,
			'uom':uom,
			'isFractional':isFractional,
			'unitPrice':0,
			'dis':0,
			'disAmt':0,
			'tax':0,
			'taxAmt':0,
			'subTotal':0,
			'total':0,
	};
	var isAllredyInList = false;
	itemLists.map((item, index) => {
		if(item.itemId == itemId){
			itemLists.splice(index, 1);
			isAllredyInList = true;
		}
	});
	if(!isAllredyInList){
		itemLists.push(selectItem);
	}
	if(isAllredyInList){
		$(this).css('background-color', '');
	}else{
		$(this).css('background-color', '#AAC0CB');
	}
});
//call function on change of category
$(document).on('change', '#category', function(){
	getItemsPaggination();
});
// call function on change of subCateIds1
$(document).on('change', '#subCateIds0', function(){
	getItemsPaggination();
});
// call function on keyup of searchKey
$(document).on('keyup', '#searchKey', function(){
	getItemsPaggination();
});
// call function on click of next button
$(document).on('click', '#nextBtn', function(){
	$('#pageNo').val(parseInt($('#pageNo').val()) + 1);
	getItemsPaggination();
});
// call function on click of previous button
$(document).on('click', '#pvrBtn', function(){
	$('#pageNo').val(parseInt($('#pageNo').val()) - 1);
	if($('#pageNo').val() < 1){
		$('#pageNo').val(0);
	}
	getItemsPaggination();
});

</script>