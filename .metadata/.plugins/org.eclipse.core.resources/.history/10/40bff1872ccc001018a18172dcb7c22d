
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<script src="${contextPath}/assets/applicationSpecific/encrypt/aes.js"></script>
<script src="${contextPath}/assets/applicationSpecific/encrypt/AesUtil.js"></script>
<script src="${contextPath}/assets/applicationSpecific/encrypt/lbase.js"></script>
<script src="${contextPath}/assets/applicationSpecific/encrypt/pbkdf2.js"></script>
<script src="${contextPath}/assets/appJs/validation/common-utils.js"></script>
<script src="${contextPath}/assets/appJs/validation/commonMaster.js"></script>
<script src="${contextPath}/assets/js/moment.js"></script>


<div class="breadcrumb_conatiner">
    <div class="col-md-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item"><a href="#">Recruitment</a></li>
                <li class="breadcrumb-item active" aria-current="page">Registration Form Status</li>
            </ol>
        </nav>
    </div>
</div>
	<div class="row mb-5">
	    <div class="col-md-12">
	        <div class="card">
	            <div class="card-header">
	                <h5 class="card-title">Registration Details :</h5>
	            </div>
	            <div class="card-body">
	                <%@ include file="/WEB-INF/views/message.jsp" %>
	                <form action="${contextPath}/public/processRegistrationStatus" method="post" id="processStatus">
	                     <input type="hidden" id="statusCipherText" name="cipherText">
	                    <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
	                    <input type="hidden" name="registrationId" id="regId" value="${registrationDetails.regForm.registrationId}" />
	                    <div class="row">
	                        <div class="col-md-2">
	                            <label class="required">First Name:</label>
	                            <input type="text" class="form-control" value="${registrationDetails.regForm.firstName}" readonly>
	                        </div>
	                        <div class="col-md-2">
	                            <label class="required">Last Name:</label>
	                            <input type="text" class="form-control" value="${registrationDetails.regForm.lastName}" readonly>
	                        </div>
	                        <div class="col-md-2">
	                            <label class="required">Email:</label>
	                            <input type="email" class="form-control" value="${registrationDetails.regForm.email}" readonly>
	                        </div>
	                        <div class="col-md-2">
	                            <label class="required">Mobile:</label>
	                            <input type="text" class="form-control" value="${registrationDetails.regForm.contact}" readonly>
	                        </div>
	                        <div class="col-md-2">
	                            <label class="required">Gender:</label>
	                            <input type="text" class="form-control" value="${registrationDetails.regForm.genderId.genderNameEN}" readonly>
	                        </div>
	                        <div class="col-md-2">
	                            <label class="required">D.O.B:</label>
	                            <fmt:formatDate value="${registrationDetails.regForm.dob}" pattern="dd/MM/yyyy" var="formattedDob"/>
	                            <input type="text" class="form-control" value="${formattedDob}" readonly>
	                        </div>
	                    </div>
	                    <div class="col-md-12" style="margin-top: 20px;display: flex; justify-content: center; align-items: center;">
	                        <c:choose>
	                            <c:when test="${registrationDetails.status eq 'APPROVED'}">
	                                <a href="${contextPath}/public/getRegistrationList" class="btn btn-back">Back</a>
	                            </c:when>
	                            <c:when test="${registrationDetails.status eq 'REJECTED'}">
	                            <div class="form-group col-md-12 text-center mt-4">
	                                <button type="button" class="btn btn-submit" onclick="processRegistrationStatus('APPROVED', ${registrationDetails.regForm.registrationId})">Approve</button>
	                                <a href="${contextPath}/public/getRegistrationList" class="btn btn-back">Back</a>
	                            </div>
	                            </c:when>
	                            <c:otherwise>
	                            <div class="form-group col-md-12 text-center mt-4">
	                                <button type="button" class="btn btn-submit" onclick="processRegistrationStatus('APPROVED', ${registrationDetails.regForm.registrationId})">Approve</button>
	                                <button type="button" class="btn btn-danger" onclick="processRegistrationStatus('REJECTED', ${registrationDetails.regForm.registrationId})">Reject</button>
	                                <a href="${contextPath}/public/getRegistrationList" class="btn btn-back">Back</a>
	                            </div>
	                            </c:otherwise>
	                        </c:choose>
	                    </div>
	                </form>
	            </div>
	        </div>
	    </div>
	</div>
</div>
<script>
 function processRegistrationStatus(status, registrationId) {
    const payload = {
        status: status,
        registrationId: registrationId
    };

    const encrypted = enc_password(JSON.stringify(payload));
    $("#statusCipherText").val(encrypted);
    bootbox.confirm("Do you want to " + status.toLowerCase() + " this registration?", function (result) {
        if (result) {
            showLoader();
            $("#processStatus").submit();
        }
    });
} 

</script>
